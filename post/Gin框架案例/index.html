<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Gin框架案例 | abin の 成长之路</title>
    <meta property="og:title" content="Gin框架案例 - abin の 成长之路">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2022-03-08T22:47:51&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2022-03-08T22:47:51&#43;08:00'>
        
    <meta name="Keywords" content="golang,go语言,go语言笔记,博客,项目管理,软件架构">
    <meta name="description" content="Gin框架案例">
        
    <meta name="author" content="abin">
    <meta property="og:url" content="https://kevinbin123.github.io/post/Gin%E6%A1%86%E6%9E%B6%E6%A1%88%E4%BE%8B/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
        <link rel="stylesheet" href='/css/sidebar_menu.css'>
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://kevinbin123.github.io/">
                        abin の 成长之路
                    </a>
                
                <p class="description">冉冉升起的码神</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://kevinbin123.github.io/">首页</a>
                    
                    <a  href="https://kevinbin123.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://kevinbin123.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Gin框架案例</h1>
        </header>
        
  <time datetime="2022-03-08T14:47:51Z" class="post-meta meta-date dt-published">
    2022年3月8日
  </time>


<div class="post-meta meta-category">
  <span>&nbsp;|</span>
  
    <a href='/categories/Golang' target="_blank">Golang</a>
  
</div>


        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">&nbsp;|
                <span id="busuanzi_value_page_pv"></span> <span>阅读</span>
            </span>
        </div>
        
        
        <div class="post-content">
            <h1 id="gin框架案例">Gin框架案例</h1>
<p>案例实现目标：使用Gin框架开发一个api项目，实现外卖应用的后端的api，前端通过调用这些api；本案例不涉及到前端。</p>
<h2 id="前端启动">前端启动</h2>
<p>项目包含前端、后端两部分，实现前后端分离。</p>
<p>前端地址：https://github.com/Teanix/shop_client</p>
<p>需要安装有nodejs；</p>
<p>运行命令：<code>npm start</code></p>
<p>运行后效果如下：</p>
<p>
        <img class="mx-auto" alt="image-20220308154439322" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220308154439322.png" />   
    </p>
<h2 id="项目初始化">项目初始化</h2>
<p>创建CloudRestaurant项目。</p>
<p>引入gin包:<code>go get github.com/gin-gonic/gin</code></p>
<p>使用配置文件，将项目的一些需要配置的地方进行配置，然后解析到项目中</p>
<p><strong>采用分层思想</strong>；</p>
<p>config文件夹：存放一些配置文件</p>
<p>controller文件夹：实现路由控制器等流程控制功能</p>
<p>dao文件夹：实现具体操作数据库的方法</p>
<p>model文件夹：是各个对象的定义</p>
<p>param文件夹：是传递参数的解析</p>
<p>services文件夹：是对象的功能实现</p>
<p>tools文件夹：一些工具方法的实现</p>
<p>1、建立config/app.json文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;app_name&#34;</span>: <span style="color:#e6db74">&#34;cloudrestaurant&#34;</span>,
  <span style="color:#f92672">&#34;app_mode&#34;</span>: <span style="color:#e6db74">&#34;dev&#34;</span>,
  <span style="color:#f92672">&#34;app_host&#34;</span>: <span style="color:#e6db74">&#34;localhost&#34;</span>,
  <span style="color:#f92672">&#34;app_port&#34;</span>: <span style="color:#e6db74">&#34;8090&#34;</span>
}
</code></pre></div><p>2、创建tools/Config.go解析配置文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;bufio&#34;</span>
	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Config</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">AppName</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_name&#34;`</span>
	<span style="color:#a6e22e">AppMode</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_mode&#34;`</span>
	<span style="color:#a6e22e">AppHost</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_host&#34;`</span>
	<span style="color:#a6e22e">AppPort</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_port&#34;`</span>
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_Cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span> = <span style="color:#66d9ef">nil</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetConfig</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_Cfg</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">ParseConfig</span>(<span style="color:#a6e22e">path</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">path</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">Close</span>()

	<span style="color:#a6e22e">reader</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">file</span>)
	<span style="color:#a6e22e">decoder</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewDecoder</span>(<span style="color:#a6e22e">reader</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">_Cfg</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_Cfg</span>, <span style="color:#66d9ef">nil</span>
}

</code></pre></div><p>3、定义一个tools/Commmon.go通用的工具</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
	<span style="color:#e6db74">&#34;net/http&#34;</span>
)

<span style="color:#66d9ef">const</span> (
	<span style="color:#a6e22e">SUCCESS</span> <span style="color:#66d9ef">int</span> = <span style="color:#ae81ff">0</span>
	<span style="color:#a6e22e">FAIL</span>    <span style="color:#66d9ef">int</span> = <span style="color:#ae81ff">1</span>
)

<span style="color:#75715e">//返回成功
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">v</span> <span style="color:#66d9ef">interface</span>{}) {
	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">H</span>{
		<span style="color:#e6db74">&#34;code&#34;</span>: <span style="color:#a6e22e">SUCCESS</span>,
		<span style="color:#e6db74">&#34;msg&#34;</span>:  <span style="color:#e6db74">&#34;成功&#34;</span>,
		<span style="color:#e6db74">&#34;data&#34;</span>: <span style="color:#a6e22e">v</span>,
	})
}

<span style="color:#75715e">//返回失败
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">v</span> <span style="color:#66d9ef">interface</span>{}) {
	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">H</span>{
		<span style="color:#e6db74">&#34;code&#34;</span>: <span style="color:#a6e22e">FAIL</span>,
		<span style="color:#e6db74">&#34;msg&#34;</span>:  <span style="color:#a6e22e">v</span>,
	})
}

</code></pre></div><p>4、使用gin运行一个web服务</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/controller&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">cfg</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">ParseConfig</span>(<span style="color:#e6db74">&#34;./config/app.json&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#a6e22e">app</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
	<span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">app</span>)
	<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppHost</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppPort</span>)

}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">HelloController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
}

</code></pre></div><p>5、将路由控制器都抽离出来</p>
<p>controller/HelloController.go</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">controller</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">HelloController</span> <span style="color:#66d9ef">struct</span>{}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">hello</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HelloController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/hello&#34;</span>, <span style="color:#a6e22e">hello</span>.<span style="color:#a6e22e">hello</span>)
}
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">hello</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HelloController</span>) <span style="color:#a6e22e">hello</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#ae81ff">200</span>, <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">H</span>{<span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;hello gin!&#34;</span>})
}

</code></pre></div><p>6、设置热加载</p>
<p>
        <img class="mx-auto" alt="image-20220306154642416" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220306154642416.png" />   
    </p>
<p>运行效果：</p>
<p>
        <img class="mx-auto" alt="image-20220308155455997" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220308155455997.png" />   
    </p>
<h2 id="集成第三方短信">集成第三方短信</h2>
<p>实现<code>/api/sendcode</code>功能</p>
<p>1、创建controller/MemberController.go路由控制器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">controller</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/services&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MemberController</span> <span style="color:#66d9ef">struct</span> {
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/sendcode&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">sendSmsCode</span>)
}

<span style="color:#75715e">// http://localhost:8090/api/sendcode?phone=xxxxx
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">sendSmsCode</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//发送验证码
</span><span style="color:#75715e"></span>	<span style="color:#75715e">//获取手机号
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">phone</span>, <span style="color:#a6e22e">exist</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">GetQuery</span>(<span style="color:#e6db74">&#34;phone&#34;</span>)
	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">exist</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;手机号解析失败&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//发送短信的调用
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ms</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">MemberService</span>{}
	<span style="color:#a6e22e">isSend</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">SendCode</span>(<span style="color:#a6e22e">phone</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">isSend</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;发送成功&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;发送失败&#34;</span>)
}
</code></pre></div><p>2、在配置文件config/app.json中添加sms相关内容;相关内容根据实际情况，自己填写。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;app_name&#34;</span>: <span style="color:#e6db74">&#34;cloudrestaurant&#34;</span>,
  <span style="color:#f92672">&#34;app_mode&#34;</span>: <span style="color:#e6db74">&#34;dev&#34;</span>,
  <span style="color:#f92672">&#34;app_host&#34;</span>: <span style="color:#e6db74">&#34;localhost&#34;</span>,
  <span style="color:#f92672">&#34;app_port&#34;</span>: <span style="color:#e6db74">&#34;8090&#34;</span>,
  <span style="color:#f92672">&#34;sms&#34;</span>: {
    <span style="color:#f92672">&#34;sign_name&#34;</span>: <span style="color:#e6db74">&#34;阿里云短信测试&#34;</span>,
    <span style="color:#f92672">&#34;template_code&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;app_key&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;app_secret&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;region_id&#34;</span>: <span style="color:#e6db74">&#34;cn-qingdao&#34;</span>

  }
}
</code></pre></div><p>并在tools/Config.go中进行解析</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;bufio&#34;</span>
	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Config</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">AppName</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_name&#34;`</span>
	<span style="color:#a6e22e">AppMode</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_mode&#34;`</span>
	<span style="color:#a6e22e">AppHost</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_host&#34;`</span>
	<span style="color:#a6e22e">AppPort</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_port&#34;`</span>
	<span style="color:#a6e22e">Sms</span>         <span style="color:#a6e22e">SmsConfig</span>      <span style="color:#e6db74">`json:&#34;sms&#34;`</span>
	<span style="color:#a6e22e">Database</span>    <span style="color:#a6e22e">DatabaseConfig</span> <span style="color:#e6db74">`json:&#34;database&#34;`</span>
	<span style="color:#a6e22e">RedisConfig</span> <span style="color:#a6e22e">RedisConfig</span>    <span style="color:#e6db74">`json:&#34;redis_config&#34;`</span>
}
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SmsConfig</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">SignName</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;sign_name&#34;`</span>
	<span style="color:#a6e22e">TemplateCode</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;template_code&#34;`</span>
	<span style="color:#a6e22e">RegionId</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;region_id&#34;`</span>
	<span style="color:#a6e22e">AppKey</span>       <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;app_key&#34;`</span>
	<span style="color:#a6e22e">AppSecret</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;app_secret&#34;`</span>
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_Cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span> = <span style="color:#66d9ef">nil</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetConfig</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_Cfg</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">ParseConfig</span>(<span style="color:#a6e22e">path</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">path</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">Close</span>()

	<span style="color:#a6e22e">reader</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">file</span>)
	<span style="color:#a6e22e">decoder</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewDecoder</span>(<span style="color:#a6e22e">reader</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">_Cfg</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_Cfg</span>, <span style="color:#66d9ef">nil</span>
}

</code></pre></div><p>3、在services/MemberService.go中实现发送短信的功能</p>
<p>这里集成的是阿里云的第三方短信功能；并且使用的是旧版的SDK</p>
<p>具体使用可以登录阿里云后，参考阿里云短信api接口</p>
<p>需要获取sdk <code>go get github.com/aliyun/alibaba-cloud-sdk-go</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">services</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/dao&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/model&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/param&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#a6e22e">dysmsapi</span> <span style="color:#e6db74">&#34;github.com/aliyun/alibaba-cloud-sdk-go/services/dysmsapi&#34;</span>
	<span style="color:#e6db74">&#34;math/rand&#34;</span>
	<span style="color:#e6db74">&#34;strconv&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
)
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MemberService</span> <span style="color:#66d9ef">struct</span> {
}
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ms</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberService</span>) <span style="color:#a6e22e">SendCode</span>(<span style="color:#a6e22e">phone</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">bool</span> {
	<span style="color:#75715e">//1、产生验证码
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">code</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%06v&#34;</span>, <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">NewSource</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>())).<span style="color:#a6e22e">Int31n</span>(<span style="color:#ae81ff">1000000</span>))
	<span style="color:#75715e">//2、调用阿里云sdk 完成发送
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">config</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">GetConfig</span>().<span style="color:#a6e22e">Sms</span>
	<span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dysmsapi</span>.<span style="color:#a6e22e">NewClientWithAccessKey</span>(<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">RegionId</span>, <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">AppKey</span>, <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">AppSecret</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
	}

	<span style="color:#a6e22e">request</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dysmsapi</span>.<span style="color:#a6e22e">CreateSendSmsRequest</span>()
	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">Scheme</span> = <span style="color:#e6db74">&#34;https&#34;</span>

	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">SignName</span> = <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">SignName</span>
	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">TemplateCode</span> = <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">TemplateCode</span>
	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">PhoneNumbers</span> = <span style="color:#a6e22e">phone</span>
	<span style="color:#a6e22e">par</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
		<span style="color:#e6db74">&#34;code&#34;</span>: <span style="color:#a6e22e">code</span>,
	})
	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">TemplateParam</span> = string(<span style="color:#a6e22e">par</span>)

	<span style="color:#a6e22e">response</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">SendSms</span>(<span style="color:#a6e22e">request</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;response:&#34;</span>, <span style="color:#a6e22e">response</span>)
	<span style="color:#75715e">//3、接收返回结果，并判断发送状态
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Code</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;OK&#34;</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
    }
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
}
</code></pre></div><p>4、将api注册到路由中,修改main方法中的registerRouter</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">HelloController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">MemberController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
}
</code></pre></div><h2 id="使用xorm创建数据库表以及插入数据">使用xorm创建数据库表以及插入数据</h2>
<p>安装xorm:<code>go get github.com/go-xorm/xorm</code></p>
<p>安装mysql：<code>go get github.com/go-sql-driver/mysql</code></p>
<p>1、使用的mysql数据库，先创建数据库</p>
<p>
        <img class="mx-auto" alt="image-20220307150535635" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220307150535635.png" />   
    </p>
<p>2、在配置文件config/中添加database相关内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;app_name&#34;</span>: <span style="color:#e6db74">&#34;cloudrestaurant&#34;</span>,
  <span style="color:#f92672">&#34;app_mode&#34;</span>: <span style="color:#e6db74">&#34;dev&#34;</span>,
  <span style="color:#f92672">&#34;app_host&#34;</span>: <span style="color:#e6db74">&#34;localhost&#34;</span>,
  <span style="color:#f92672">&#34;app_port&#34;</span>: <span style="color:#e6db74">&#34;8090&#34;</span>,
  <span style="color:#f92672">&#34;sms&#34;</span>: {
    <span style="color:#f92672">&#34;sign_name&#34;</span>: <span style="color:#e6db74">&#34;阿里云短信测试&#34;</span>,
    <span style="color:#f92672">&#34;template_code&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;app_key&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;app_secret&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;region_id&#34;</span>: <span style="color:#e6db74">&#34;cn-qingdao&#34;</span>

  },
  <span style="color:#f92672">&#34;database&#34;</span>: {
    <span style="color:#f92672">&#34;driver&#34;</span>: <span style="color:#e6db74">&#34;mysql&#34;</span>,
    <span style="color:#f92672">&#34;user&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>,
    <span style="color:#f92672">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;123456&#34;</span>,
    <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
    <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#e6db74">&#34;3306&#34;</span>,
    <span style="color:#f92672">&#34;db_name&#34;</span>: <span style="color:#e6db74">&#34;cloudrestaurant&#34;</span>,
    <span style="color:#f92672">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;utf8&#34;</span>,
    <span style="color:#f92672">&#34;show_sql&#34;</span>: <span style="color:#66d9ef">true</span>
  }
}
</code></pre></div><p>并在tools/Config.go中解析</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;bufio&#34;</span>
	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Config</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">AppName</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_name&#34;`</span>
	<span style="color:#a6e22e">AppMode</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_mode&#34;`</span>
	<span style="color:#a6e22e">AppHost</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_host&#34;`</span>
	<span style="color:#a6e22e">AppPort</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_port&#34;`</span>
	<span style="color:#a6e22e">Sms</span>         <span style="color:#a6e22e">SmsConfig</span>      <span style="color:#e6db74">`json:&#34;sms&#34;`</span>
	<span style="color:#a6e22e">Database</span>    <span style="color:#a6e22e">DatabaseConfig</span> <span style="color:#e6db74">`json:&#34;database&#34;`</span>
	<span style="color:#a6e22e">RedisConfig</span> <span style="color:#a6e22e">RedisConfig</span>    <span style="color:#e6db74">`json:&#34;redis_config&#34;`</span>
}
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SmsConfig</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">SignName</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;sign_name&#34;`</span>
	<span style="color:#a6e22e">TemplateCode</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;template_code&#34;`</span>
	<span style="color:#a6e22e">RegionId</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;region_id&#34;`</span>
	<span style="color:#a6e22e">AppKey</span>       <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;app_key&#34;`</span>
	<span style="color:#a6e22e">AppSecret</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;app_secret&#34;`</span>
}
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DatabaseConfig</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Driver</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;driver&#34;`</span>
	<span style="color:#a6e22e">User</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;user&#34;`</span>
	<span style="color:#a6e22e">Password</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;password&#34;`</span>
	<span style="color:#a6e22e">Host</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;host&#34;`</span>
	<span style="color:#a6e22e">Port</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;port&#34;`</span>
	<span style="color:#a6e22e">DbName</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;db_name&#34;`</span>
	<span style="color:#a6e22e">Charset</span>  <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;charset&#34;`</span>
	<span style="color:#a6e22e">ShowSql</span>  <span style="color:#66d9ef">bool</span>   <span style="color:#e6db74">`json:&#34;show_sql&#34;`</span>
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_Cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span> = <span style="color:#66d9ef">nil</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetConfig</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_Cfg</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">ParseConfig</span>(<span style="color:#a6e22e">path</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">path</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">Close</span>()

	<span style="color:#a6e22e">reader</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">file</span>)
	<span style="color:#a6e22e">decoder</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewDecoder</span>(<span style="color:#a6e22e">reader</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">_Cfg</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_Cfg</span>, <span style="color:#66d9ef">nil</span>
}

</code></pre></div><p>3、创建model/SmsCode.go文件，初始化发送短信验证码的对象</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">model</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SmsCode</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Id</span>         <span style="color:#66d9ef">int64</span>  <span style="color:#e6db74">`xorm:&#34;pk autoincr&#34; json:&#34;id&#34;`</span>
	<span style="color:#a6e22e">Phone</span>      <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(11)&#34; json:&#34;phone&#34;`</span>
	<span style="color:#a6e22e">BizId</span>      <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(30)&#34; json:&#34;biz_id&#34;`</span>
	<span style="color:#a6e22e">Code</span>       <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(6)&#34; json:&#34;code&#34;`</span>
	<span style="color:#a6e22e">CreateTime</span> <span style="color:#66d9ef">int64</span>  <span style="color:#e6db74">`xorm:&#34;bigint&#34; json:&#34;create_time&#34;`</span>
}

</code></pre></div><p>4、创建tools/OrmEngine.go初始化数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/model&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;github.com/go-sql-driver/mysql&#34;</span>
	<span style="color:#e6db74">&#34;github.com/go-xorm/xorm&#34;</span>
)

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">DbEngie</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Orm</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Orm</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#f92672">*</span><span style="color:#a6e22e">xorm</span>.<span style="color:#a6e22e">Engine</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Orm</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">database</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Database</span>
	<span style="color:#a6e22e">conn</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">User</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Password</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;@tcp(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Port</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">DbName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?charset=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Charset</span>
	<span style="color:#a6e22e">engine</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">xorm</span>.<span style="color:#a6e22e">NewEngine</span>(<span style="color:#e6db74">&#34;mysql&#34;</span>, <span style="color:#a6e22e">conn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">ShowSQL</span>(<span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">ShowSql</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Sync2</span>(new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">orm</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Orm</span>)
	<span style="color:#a6e22e">orm</span>.<span style="color:#a6e22e">Engine</span> = <span style="color:#a6e22e">engine</span>
	<span style="color:#a6e22e">DbEngie</span> = <span style="color:#a6e22e">orm</span>
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">orm</span>, <span style="color:#66d9ef">nil</span>
}

</code></pre></div><p>5、在main中实例化数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/controller&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
	<span style="color:#e6db74">&#34;strings&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">cfg</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">ParseConfig</span>(<span style="color:#e6db74">&#34;./config/app.json&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#75715e">//实例化数据库
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#a6e22e">app</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
	<span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">app</span>)

	<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppHost</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppPort</span>)

}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">HelloController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">MemberController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
}


</code></pre></div><p>6、修改services/MemberService.go，将发送成功的验证码保存到数据库中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ms</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberService</span>) <span style="color:#a6e22e">SendCode</span>(<span style="color:#a6e22e">phone</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">bool</span> {
	<span style="color:#75715e">//1、产生验证码
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">code</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%06v&#34;</span>, <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">NewSource</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>())).<span style="color:#a6e22e">Int31n</span>(<span style="color:#ae81ff">1000000</span>))
	<span style="color:#75715e">//2、调用阿里云sdk 完成发送
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">config</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">GetConfig</span>().<span style="color:#a6e22e">Sms</span>
	<span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dysmsapi</span>.<span style="color:#a6e22e">NewClientWithAccessKey</span>(<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">RegionId</span>, <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">AppKey</span>, <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">AppSecret</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
	}

	<span style="color:#a6e22e">request</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dysmsapi</span>.<span style="color:#a6e22e">CreateSendSmsRequest</span>()
	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">Scheme</span> = <span style="color:#e6db74">&#34;https&#34;</span>

	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">SignName</span> = <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">SignName</span>
	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">TemplateCode</span> = <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">TemplateCode</span>
	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">PhoneNumbers</span> = <span style="color:#a6e22e">phone</span>
	<span style="color:#a6e22e">par</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
		<span style="color:#e6db74">&#34;code&#34;</span>: <span style="color:#a6e22e">code</span>,
	})
	<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">TemplateParam</span> = string(<span style="color:#a6e22e">par</span>)

	<span style="color:#a6e22e">response</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">SendSms</span>(<span style="color:#a6e22e">request</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;response:&#34;</span>, <span style="color:#a6e22e">response</span>)
	<span style="color:#75715e">//3、接收返回结果，并判断发送状态
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Code</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;OK&#34;</span> {
		<span style="color:#75715e">// 将验证码保存到数据库中
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">smsCode</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>{<span style="color:#a6e22e">Phone</span>: <span style="color:#a6e22e">phone</span>, <span style="color:#a6e22e">Code</span>: <span style="color:#a6e22e">code</span>, <span style="color:#a6e22e">BizId</span>: <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">BizId</span>, <span style="color:#a6e22e">CreateTime</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Unix</span>()}
		<span style="color:#a6e22e">memberDao</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">MemberDao</span>{<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">DbEngie</span>}
		<span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">memberDao</span>.<span style="color:#a6e22e">InsertCode</span>(<span style="color:#a6e22e">smsCode</span>)

		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span> &gt; <span style="color:#ae81ff">0</span>
	}

	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
}
</code></pre></div><p>7、创建dao/MemberDao.go来操作数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">dao</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/model&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MemberDao</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#f92672">*</span><span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Orm</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">md</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberDao</span>) <span style="color:#a6e22e">InsertCode</span>(<span style="color:#a6e22e">sms</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>) <span style="color:#66d9ef">int64</span> {
	<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">InsertOne</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sms</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>
}
</code></pre></div><p>效果演示：</p>
<p>
        <img class="mx-auto" alt="image-20220308162604112" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220308162604112.png" />   
    </p>
<h2 id="手机号码登录">手机号码登录</h2>
<p>实现<code>/api/login_sms</code>路由</p>
<p>1、在model/Member.go中定义会员数据结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">model</span>

<span style="color:#75715e">//定义会员数据结构
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Member</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Id</span>           <span style="color:#66d9ef">int64</span>   <span style="color:#e6db74">`xorm:&#34;pk autoincr&#34; json:&#34;id&#34;`</span>
	<span style="color:#a6e22e">UserName</span>     <span style="color:#66d9ef">string</span>  <span style="color:#e6db74">`xorm:&#34;varchar(20)&#34; json:&#34;user_name&#34;`</span>
	<span style="color:#a6e22e">Mobile</span>       <span style="color:#66d9ef">string</span>  <span style="color:#e6db74">`xorm:&#34;varchar(11)&#34; json:&#34;mobile&#34;`</span>
	<span style="color:#a6e22e">Password</span>     <span style="color:#66d9ef">string</span>  <span style="color:#e6db74">`xorm:&#34;varchar(255)&#34; json:&#34;password&#34;`</span>
	<span style="color:#a6e22e">RegisterTime</span> <span style="color:#66d9ef">int64</span>   <span style="color:#e6db74">`xorm:&#34;bigint&#34; json:&#34;register_time&#34;`</span>
	<span style="color:#a6e22e">Avatar</span>       <span style="color:#66d9ef">string</span>  <span style="color:#e6db74">`xorm:&#34;varchar(255)&#34; json:&#34;avatar&#34;`</span>
	<span style="color:#a6e22e">Balance</span>      <span style="color:#66d9ef">float64</span> <span style="color:#e6db74">`xorm:&#34;double&#34; json:&#34;balance&#34;`</span>
	<span style="color:#a6e22e">IsActive</span>     <span style="color:#66d9ef">int8</span>    <span style="color:#e6db74">`xorm:&#34;tinyint&#34; json:&#34;is_active&#34;`</span>
	<span style="color:#a6e22e">City</span>         <span style="color:#66d9ef">string</span>  <span style="color:#e6db74">`xorm:&#34;varchar(10)&#34; json:&#34;city&#34;`</span>
}
</code></pre></div><p>2、在tools/OrmEngine.go中同步Member结构到数据库中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Orm</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">database</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Database</span>
	<span style="color:#a6e22e">conn</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">User</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Password</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;@tcp(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Port</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">DbName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?charset=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Charset</span>
	<span style="color:#a6e22e">engine</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">xorm</span>.<span style="color:#a6e22e">NewEngine</span>(<span style="color:#e6db74">&#34;mysql&#34;</span>, <span style="color:#a6e22e">conn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">ShowSQL</span>(<span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">ShowSql</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Sync2</span>(new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">orm</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Orm</span>)
	<span style="color:#a6e22e">orm</span>.<span style="color:#a6e22e">Engine</span> = <span style="color:#a6e22e">engine</span>
	<span style="color:#a6e22e">DbEngie</span> = <span style="color:#a6e22e">orm</span>
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">orm</span>, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>3、在controller/MemberController.go添加路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/sendcode&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">sendSmsCode</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/login_sms&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">smsLogin</span>)
}

<span style="color:#75715e">//手机号+短信登录的方法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">smsLogin</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//获取前端传递过来的参数
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">smsLoginParam</span> <span style="color:#a6e22e">param</span>.<span style="color:#a6e22e">SmsLoginParam</span>
	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Body</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">smsLoginParam</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;参数解析失败&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//完成手机+验证码登录
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">us</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">MemberService</span>{}
	<span style="color:#a6e22e">member</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">us</span>.<span style="color:#a6e22e">SmsLogin</span>(<span style="color:#a6e22e">smsLoginParam</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">member</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">member</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;登录失败&#34;</span>)

}
</code></pre></div><p>4、在param/SmsLoginParam.go中定义前端传过来的参数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">param</span>

<span style="color:#75715e">//手机号+验证码登录时 参数传递
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SmsLoginParam</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Phone</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;phone&#34;`</span>
	<span style="color:#a6e22e">Code</span>  <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;code&#34;`</span>
}
</code></pre></div><p>5、在tools/JsonParse.go中实现解码的封装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
	<span style="color:#e6db74">&#34;io&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">JsonParse</span> <span style="color:#66d9ef">struct</span>{}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">io</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">ReadCloser</span>, <span style="color:#a6e22e">v</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#66d9ef">error</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewDecoder</span>(<span style="color:#a6e22e">io</span>).<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">v</span>)
}
</code></pre></div><p>6、在services/MemberService.go中实现手机号登录功能</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ms</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberService</span>) <span style="color:#a6e22e">SmsLogin</span>(<span style="color:#a6e22e">loginparam</span> <span style="color:#a6e22e">param</span>.<span style="color:#a6e22e">SmsLoginParam</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span> {
	<span style="color:#75715e">//1、获取到手机号和验证码
</span><span style="color:#75715e"></span>	<span style="color:#75715e">//2、验证手机号+验证码是否正确
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">md</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">MemberDao</span>{<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">DbEngie</span>}
	<span style="color:#a6e22e">sms</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">ValidateSmsCode</span>(<span style="color:#a6e22e">loginparam</span>.<span style="color:#a6e22e">Phone</span>, <span style="color:#a6e22e">loginparam</span>.<span style="color:#a6e22e">Code</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">sms</span>.<span style="color:#a6e22e">Id</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#75715e">//3、根据手机号member表中查询记录
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">member</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">QueryByPhone</span>(<span style="color:#a6e22e">loginparam</span>.<span style="color:#a6e22e">Phone</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">member</span>
	}
	<span style="color:#75715e">//4、查询不到member记录，则创建一条新的member记录，并保持
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>{}
	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">UserName</span> = <span style="color:#a6e22e">loginparam</span>.<span style="color:#a6e22e">Phone</span>
	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Mobile</span> = <span style="color:#a6e22e">loginparam</span>.<span style="color:#a6e22e">Phone</span>
	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">RegisterTime</span> = <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Unix</span>()
	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span> = <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">InsertMember</span>(<span style="color:#a6e22e">user</span>)
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>
}
</code></pre></div><p>7、在dao/MemberDao.go中实现验证手机号是否正确、根据手机号查询用户、插入用户等功能</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//验证手机号和验证码是否存在
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">md</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberDao</span>) <span style="color:#a6e22e">ValidateSmsCode</span>(<span style="color:#a6e22e">phone</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">code</span> <span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span> {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sms</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;phone = ? and code = ?&#34;</span>, <span style="color:#a6e22e">phone</span>, <span style="color:#a6e22e">code</span>).<span style="color:#a6e22e">Get</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sms</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sms</span>
}
<span style="color:#75715e">//根据手机号查询用户
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">md</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberDao</span>) <span style="color:#a6e22e">QueryByPhone</span>(<span style="color:#a6e22e">phone</span> <span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span> {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">member</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;mobile = ?&#34;</span>, <span style="color:#a6e22e">phone</span>).<span style="color:#a6e22e">Get</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>
}
<span style="color:#75715e">//插入用户
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">md</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberDao</span>) <span style="color:#a6e22e">InsertMember</span>(<span style="color:#a6e22e">member</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>) <span style="color:#66d9ef">int64</span> {
	<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">InsertOne</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>
}
</code></pre></div><h2 id="将登录信息保存到session中">将登录信息保存到session中</h2>
<p>安装redis:<code>go get github.com/go-redis/redis/v8</code></p>
<p>安装session：<code>go get github.com/gin-contrib/sessions</code></p>
<p>1、本案例采用基于redis存储的session；先在config/app.json中配置redis</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;app_name&#34;</span>: <span style="color:#e6db74">&#34;cloudrestaurant&#34;</span>,
  <span style="color:#f92672">&#34;app_mode&#34;</span>: <span style="color:#e6db74">&#34;dev&#34;</span>,
  <span style="color:#f92672">&#34;app_host&#34;</span>: <span style="color:#e6db74">&#34;localhost&#34;</span>,
  <span style="color:#f92672">&#34;app_port&#34;</span>: <span style="color:#e6db74">&#34;8090&#34;</span>,
  <span style="color:#f92672">&#34;sms&#34;</span>: {
    <span style="color:#f92672">&#34;sign_name&#34;</span>: <span style="color:#e6db74">&#34;阿里云短信测试&#34;</span>,
    <span style="color:#f92672">&#34;template_code&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;app_key&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;app_secret&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;region_id&#34;</span>: <span style="color:#e6db74">&#34;cn-qingdao&#34;</span>
  },
  <span style="color:#f92672">&#34;database&#34;</span>: {
    <span style="color:#f92672">&#34;driver&#34;</span>: <span style="color:#e6db74">&#34;mysql&#34;</span>,
    <span style="color:#f92672">&#34;user&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>,
    <span style="color:#f92672">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;123456&#34;</span>,
    <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
    <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#e6db74">&#34;3306&#34;</span>,
    <span style="color:#f92672">&#34;db_name&#34;</span>: <span style="color:#e6db74">&#34;cloudrestaurant&#34;</span>,
    <span style="color:#f92672">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;utf8&#34;</span>,
    <span style="color:#f92672">&#34;show_sql&#34;</span>: <span style="color:#66d9ef">true</span>
  },
  <span style="color:#f92672">&#34;redis_config&#34;</span>: {
    <span style="color:#f92672">&#34;addr&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
    <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#e6db74">&#34;6379&#34;</span>,
    <span style="color:#f92672">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;db&#34;</span>: <span style="color:#ae81ff">0</span>
  }
}
</code></pre></div><p>并在tools/Config.go中将配置文件解析</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;bufio&#34;</span>
	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Config</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">AppName</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_name&#34;`</span>
	<span style="color:#a6e22e">AppMode</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_mode&#34;`</span>
	<span style="color:#a6e22e">AppHost</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_host&#34;`</span>
	<span style="color:#a6e22e">AppPort</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;app_port&#34;`</span>
	<span style="color:#a6e22e">Sms</span>         <span style="color:#a6e22e">SmsConfig</span>      <span style="color:#e6db74">`json:&#34;sms&#34;`</span>
	<span style="color:#a6e22e">Database</span>    <span style="color:#a6e22e">DatabaseConfig</span> <span style="color:#e6db74">`json:&#34;database&#34;`</span>
	<span style="color:#a6e22e">RedisConfig</span> <span style="color:#a6e22e">RedisConfig</span>    <span style="color:#e6db74">`json:&#34;redis_config&#34;`</span>
}
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SmsConfig</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">SignName</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;sign_name&#34;`</span>
	<span style="color:#a6e22e">TemplateCode</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;template_code&#34;`</span>
	<span style="color:#a6e22e">RegionId</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;region_id&#34;`</span>
	<span style="color:#a6e22e">AppKey</span>       <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;app_key&#34;`</span>
	<span style="color:#a6e22e">AppSecret</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;app_secret&#34;`</span>
}
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DatabaseConfig</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Driver</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;driver&#34;`</span>
	<span style="color:#a6e22e">User</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;user&#34;`</span>
	<span style="color:#a6e22e">Password</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;password&#34;`</span>
	<span style="color:#a6e22e">Host</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;host&#34;`</span>
	<span style="color:#a6e22e">Port</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;port&#34;`</span>
	<span style="color:#a6e22e">DbName</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;db_name&#34;`</span>
	<span style="color:#a6e22e">Charset</span>  <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;charset&#34;`</span>
	<span style="color:#a6e22e">ShowSql</span>  <span style="color:#66d9ef">bool</span>   <span style="color:#e6db74">`json:&#34;show_sql&#34;`</span>
}
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RedisConfig</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Addr</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;addr&#34;`</span>
	<span style="color:#a6e22e">Port</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;port&#34;`</span>
	<span style="color:#a6e22e">Password</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;password&#34;`</span>
	<span style="color:#a6e22e">Db</span>       <span style="color:#66d9ef">int</span>    <span style="color:#e6db74">`json:db`</span>
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_Cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span> = <span style="color:#66d9ef">nil</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetConfig</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_Cfg</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">ParseConfig</span>(<span style="color:#a6e22e">path</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">path</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">Close</span>()

	<span style="color:#a6e22e">reader</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">file</span>)
	<span style="color:#a6e22e">decoder</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewDecoder</span>(<span style="color:#a6e22e">reader</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">_Cfg</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_Cfg</span>, <span style="color:#66d9ef">nil</span>
}

</code></pre></div><p>2、在tools/SessionStore.go中实现初始化session和set、get方法的封装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-contrib/sessions/redis&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-contrib/sessions&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
)

<span style="color:#75715e">//初始化Session
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">InitSession</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>){
	<span style="color:#a6e22e">config</span><span style="color:#f92672">:=</span><span style="color:#a6e22e">GetConfig</span>().<span style="color:#a6e22e">RedisConfig</span>
	<span style="color:#a6e22e">store</span>,<span style="color:#a6e22e">err</span><span style="color:#f92672">:=</span><span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">NewStore</span>(<span style="color:#ae81ff">10</span>,<span style="color:#e6db74">&#34;tcp&#34;</span>,<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Addr</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;:&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Port</span>,<span style="color:#e6db74">&#34;&#34;</span>,[]byte(<span style="color:#e6db74">&#34;secret&#34;</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Use</span>(<span style="color:#a6e22e">sessions</span>.<span style="color:#a6e22e">Sessions</span>(<span style="color:#e6db74">&#34;mysession&#34;</span>,<span style="color:#a6e22e">store</span>))
}

<span style="color:#75715e">//set
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Setsess</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>,<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">interface</span>{},<span style="color:#a6e22e">value</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#66d9ef">error</span> {
	<span style="color:#a6e22e">session</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sessions</span>.<span style="color:#a6e22e">Default</span>(<span style="color:#a6e22e">c</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">session</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>{
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">key</span>,<span style="color:#a6e22e">value</span>)
	<span style="color:#66d9ef">return</span>  <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Save</span>()
}
<span style="color:#75715e">//get
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetSess</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>,<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">interface</span>{})  <span style="color:#66d9ef">interface</span>{}{
	<span style="color:#a6e22e">session</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sessions</span>.<span style="color:#a6e22e">Default</span>(<span style="color:#a6e22e">c</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">session</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>{
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">key</span>)
}

</code></pre></div><p>3、在main.go中进行初始化</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">cfg</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">ParseConfig</span>(<span style="color:#e6db74">&#34;./config/app.json&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#75715e">//实例化数据库
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#a6e22e">app</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
	<span style="color:#75715e">//初始化session
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">InitSession</span>(<span style="color:#a6e22e">app</span>)
	<span style="color:#75715e">//设置全局跨域访问
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">Use</span>(<span style="color:#a6e22e">Cors</span>())
	<span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">app</span>)

	<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppHost</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppPort</span>)

}
</code></pre></div><p>4、在controller/MemberController.go中将登录后的状态保存到session中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//手机号+短信登录的方法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">smsLogin</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//获取前端传递过来的参数
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">smsLoginParam</span> <span style="color:#a6e22e">param</span>.<span style="color:#a6e22e">SmsLoginParam</span>
	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Body</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">smsLoginParam</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;参数解析失败&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//完成手机+验证码登录
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">us</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">MemberService</span>{}
	<span style="color:#a6e22e">member</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">us</span>.<span style="color:#a6e22e">SmsLogin</span>(<span style="color:#a6e22e">smsLoginParam</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">member</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span> = <span style="color:#e6db74">&#34;userid_&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Itoa</span>(int(<span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span>))
		<span style="color:#a6e22e">sess</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">member</span>)
        <span style="color:#75715e">//设置session
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Setsess</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">sess</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;登录失败&#34;</span>)
			<span style="color:#66d9ef">return</span>
		}
		<span style="color:#75715e">//cookie设置
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">SetCookie</span>(<span style="color:#e6db74">&#34;cookie_user&#34;</span>, <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Itoa</span>(int(<span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span>)), <span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#ae81ff">60</span>, <span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#e6db74">&#34;localhost&#34;</span>, <span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">true</span>)
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">member</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;登录失败&#34;</span>)

}
</code></pre></div><p>5、在tools/CookieUtil.go中设置cookie的验证方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
	<span style="color:#e6db74">&#34;net/http&#34;</span>
)

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">CookieName</span> = <span style="color:#e6db74">&#34;cookie_user&#34;</span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">CookieTimeLength</span> = <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">CookieAuth</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Cookie</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">cookie</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Cookie</span>(<span style="color:#a6e22e">CookieName</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">SetCookie</span>(<span style="color:#a6e22e">cookie</span>.<span style="color:#a6e22e">Name</span>, <span style="color:#a6e22e">cookie</span>.<span style="color:#a6e22e">Value</span>, <span style="color:#a6e22e">cookie</span>.<span style="color:#a6e22e">MaxAge</span>, <span style="color:#a6e22e">cookie</span>.<span style="color:#a6e22e">Path</span>, <span style="color:#a6e22e">cookie</span>.<span style="color:#a6e22e">Domain</span>, <span style="color:#a6e22e">cookie</span>.<span style="color:#a6e22e">Secure</span>, <span style="color:#a6e22e">cookie</span>.<span style="color:#a6e22e">HttpOnly</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cookie</span>, <span style="color:#66d9ef">nil</span>
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
}

</code></pre></div><h2 id="全局跨域请求设置">全局跨域请求设置</h2>
<p>在前端跨域发送post请求的时候，会先发送一个OPTIONS的请求，来嗅探此次访问是否安全。</p>
<p>修改main.go设置一个Cors的中间件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//设置Cross Orign resource share；跨域访问
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Cors</span>() <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">HandlerFunc</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
		<span style="color:#a6e22e">method</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Method</span>
		<span style="color:#a6e22e">origin</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;Origin&#34;</span>)
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">headerKeys</span> []<span style="color:#66d9ef">string</span>
		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Header</span> {
			<span style="color:#a6e22e">headerKeys</span> = append(<span style="color:#a6e22e">headerKeys</span>, <span style="color:#a6e22e">key</span>)
		}
		<span style="color:#a6e22e">headerStr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">headerKeys</span>, <span style="color:#e6db74">&#34;,&#34;</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">headerStr</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
			<span style="color:#a6e22e">headerStr</span> = <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;access-control-allow-origin,access-control-allow-headers,%s&#34;</span>, <span style="color:#a6e22e">headerStr</span>)
		} <span style="color:#66d9ef">else</span> {
			<span style="color:#a6e22e">headerStr</span> = <span style="color:#e6db74">&#34;access-control-allow-origin,access-control-allow-headers&#34;</span>
		}
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">origin</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Writer</span>.<span style="color:#a6e22e">Header</span>().<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Access-Control-Allow-Origin&#34;</span>, <span style="color:#e6db74">&#34;*&#34;</span>)
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Header</span>(<span style="color:#e6db74">&#34;Access-Control-Allow-Origin&#34;</span>, <span style="color:#e6db74">&#34;*&#34;</span>) <span style="color:#75715e">// 设置允许访问所有域  Access-Control-Allow-Origin
</span><span style="color:#75715e"></span>			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Header</span>(<span style="color:#e6db74">&#34;Access-Control-Allow-Methods&#34;</span>, <span style="color:#e6db74">&#34;POST, GET, OPTIONS, PUT, DELETE,UPDATE&#34;</span>)
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Header</span>(<span style="color:#e6db74">&#34;Access-Control-Allow-Headers&#34;</span>, <span style="color:#e6db74">&#34;Authorization, Content-Length, X-CSRF-Token, Token,session,X_Requested_With,Accept, Origin, Host, Connection, Accept-Encoding, Accept-Language,DNT, X-CustomHeader, Keep-Alive, User-Agent, X-Requested-With, If-Modified-Since, Cache-Control, Content-Type, Pragma&#34;</span>)
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Header</span>(<span style="color:#e6db74">&#34;Access-Control-Expose-Headers&#34;</span>, <span style="color:#e6db74">&#34;Content-Length, Access-Control-Allow-Origin, Access-Control-Allow-Headers,Cache-Control,Content-Language,Content-Type,Expires,Last-Modified,Pragma,FooBar&#34;</span>)
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Header</span>(<span style="color:#e6db74">&#34;Access-Control-Max-Age&#34;</span>, <span style="color:#e6db74">&#34;172800&#34;</span>)
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Header</span>(<span style="color:#e6db74">&#34;Access-Control-Allow-Credentials&#34;</span>, <span style="color:#e6db74">&#34;false&#34;</span>)
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;content-type&#34;</span>, <span style="color:#e6db74">&#34;application/json&#34;</span>) <span style="color:#75715e">// 设置返回格式是json
</span><span style="color:#75715e"></span>		}
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">method</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;OPTIONS&#34;</span> {
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#ae81ff">200</span>, <span style="color:#e6db74">&#34;请求成功&#34;</span>)
		}
		<span style="color:#75715e">//继续处理请求
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Next</span>()
	}
}
</code></pre></div><p>并作用在全局</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">cfg</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">ParseConfig</span>(<span style="color:#e6db74">&#34;./config/app.json&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#75715e">//实例化数据库
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#a6e22e">app</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
	<span style="color:#75715e">//设置全局跨域访问
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">Use</span>(<span style="color:#a6e22e">Cors</span>())
	<span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">app</span>)

	<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppHost</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppPort</span>)

}
</code></pre></div><h2 id="图形验证码生成和验证">图形验证码生成和验证</h2>
<p>实现<code>/api/captcha</code>路由</p>
<p>安装base64Captcha:<code>go get github.com/mojocn/base64Captcha@v1.2.2</code></p>
<p>1、在contoller/MemberController.go中添加路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/sendcode&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">sendSmsCode</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/login_sms&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">smsLogin</span>)
    <span style="color:#75715e">//请求验证码
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/captcha&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">captcha</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/vertifycha&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">vertifyCaptcha</span>)
}
<span style="color:#75715e">//生成验证码，并返回客户端
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">captcha</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">GenerateCaptcha</span>(<span style="color:#a6e22e">c</span>)
}

<span style="color:#75715e">//验证验证码是否正确
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">vertifyCaptcha</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">captcha</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">CaptchaResult</span>
	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Body</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">captcha</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;参数解析失败&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">VertifyCaptcha</span>(<span style="color:#a6e22e">captcha</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#a6e22e">captcha</span>.<span style="color:#a6e22e">VertifyValue</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">result</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;验证通过&#34;</span>)
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;验证失败&#34;</span>)
	}
}
</code></pre></div><p>2、在tools/Captcha.go中实现验证码的生成和验证功能;这边使用的base64Captcha第三方库是V1.2.2版本，最新版本已经不是这样使用了；具体方法可以参考：https://mojotv.cn/go/refactor-base64-captcha</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
	<span style="color:#e6db74">&#34;github.com/mojocn/base64Captcha&#34;</span>
	<span style="color:#e6db74">&#34;image/color&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">CaptchaResult</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Id</span>           <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;id&#34;`</span>
	<span style="color:#a6e22e">Base64Blob</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;base_64_blob&#34;`</span>
	<span style="color:#a6e22e">VertifyValue</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;code&#34;`</span>
}

<span style="color:#75715e">//生成图形验证码
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GenerateCaptcha</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#a6e22e">parameters</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">base64Captcha</span>.<span style="color:#a6e22e">ConfigCharacter</span>{
		<span style="color:#a6e22e">Height</span>:             <span style="color:#ae81ff">30</span>,
		<span style="color:#a6e22e">Width</span>:              <span style="color:#ae81ff">60</span>,
		<span style="color:#a6e22e">Mode</span>:               <span style="color:#ae81ff">3</span>,
		<span style="color:#a6e22e">ComplexOfNoiseText</span>: <span style="color:#ae81ff">0</span>,
		<span style="color:#a6e22e">ComplexOfNoiseDot</span>:  <span style="color:#ae81ff">0</span>,
		<span style="color:#a6e22e">IsUseSimpleFont</span>:    <span style="color:#66d9ef">true</span>,
		<span style="color:#a6e22e">IsShowHollowLine</span>:   <span style="color:#66d9ef">false</span>,
		<span style="color:#a6e22e">IsShowNoiseDot</span>:     <span style="color:#66d9ef">false</span>,
		<span style="color:#a6e22e">IsShowNoiseText</span>:    <span style="color:#66d9ef">false</span>,
		<span style="color:#a6e22e">IsShowSlimeLine</span>:    <span style="color:#66d9ef">false</span>,
		<span style="color:#a6e22e">IsShowSineLine</span>:     <span style="color:#66d9ef">false</span>,
		<span style="color:#a6e22e">CaptchaLen</span>:         <span style="color:#ae81ff">4</span>, <span style="color:#75715e">//长度
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">BgColor</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">RGBA</span>{ <span style="color:#75715e">//背景颜色
</span><span style="color:#75715e"></span>			<span style="color:#a6e22e">R</span>: <span style="color:#ae81ff">3</span>,
			<span style="color:#a6e22e">G</span>: <span style="color:#ae81ff">102</span>,
			<span style="color:#a6e22e">B</span>: <span style="color:#ae81ff">214</span>,
			<span style="color:#a6e22e">A</span>: <span style="color:#ae81ff">254</span>,
		},
	}
	<span style="color:#a6e22e">captchaId</span>, <span style="color:#a6e22e">captchaInterfaceInstance</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">base64Captcha</span>.<span style="color:#a6e22e">GenerateCaptcha</span>(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">parameters</span>)
	<span style="color:#a6e22e">base64blob</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">base64Captcha</span>.<span style="color:#a6e22e">CaptchaWriteToBase64Encoding</span>(<span style="color:#a6e22e">captchaInterfaceInstance</span>)

	<span style="color:#a6e22e">captchaResult</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">CaptchaResult</span>{<span style="color:#a6e22e">Id</span>: <span style="color:#a6e22e">captchaId</span>, <span style="color:#a6e22e">Base64Blob</span>: <span style="color:#a6e22e">base64blob</span>}

	<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
		<span style="color:#e6db74">&#34;captcha_result&#34;</span>: <span style="color:#a6e22e">captchaResult</span>,
	})
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">VertifyCaptcha</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">bool</span> {
	<span style="color:#a6e22e">vertifyResult</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">base64Captcha</span>.<span style="color:#a6e22e">VerifyCaptcha</span>(<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">value</span>)
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">vertifyResult</span>
}

</code></pre></div><p>4、验证码是存储在redis中，所以需要先初始化一下redis，在tools/RedisStore.go中初始化</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;context&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/go-redis/redis/v8&#34;</span>
	<span style="color:#e6db74">&#34;github.com/mojocn/base64Captcha&#34;</span>
	<span style="color:#e6db74">&#34;log&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RedisStore</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">Client</span>
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">RedStore</span> <span style="color:#a6e22e">RedisStore</span>
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ctx</span> = <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">InitRedisStore</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">RedisStore</span> {
	<span style="color:#a6e22e">config</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">GetConfig</span>().<span style="color:#a6e22e">RedisConfig</span>
	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">Options</span>{
		<span style="color:#a6e22e">Addr</span>:     <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Addr</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Port</span>,
		<span style="color:#a6e22e">Password</span>: <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Password</span>,
		<span style="color:#a6e22e">DB</span>:       <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Db</span>,
	})

	<span style="color:#a6e22e">RedStore</span> = <span style="color:#a6e22e">RedisStore</span>{<span style="color:#a6e22e">client</span>: <span style="color:#a6e22e">client</span>}

	<span style="color:#a6e22e">base64Captcha</span>.<span style="color:#a6e22e">SetCustomStore</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">RedStore</span>)

	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">RedStore</span>
}

<span style="color:#75715e">//Set
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rs</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RedisStore</span>) <span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">string</span>) {
	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Minute</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>).<span style="color:#a6e22e">Err</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
	}
}

<span style="color:#75715e">//Get
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rs</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RedisStore</span>) <span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">clear</span> <span style="color:#66d9ef">bool</span>) <span style="color:#66d9ef">string</span> {
	<span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">id</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">clear</span> {
		<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Del</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">id</span>).<span style="color:#a6e22e">Err</span>()
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
			<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
		}
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">val</span>
}
</code></pre></div><p>5、在main.go中要初始化redis配置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">cfg</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">ParseConfig</span>(<span style="color:#e6db74">&#34;./config/app.json&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#75715e">//实例化数据库
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#75715e">//初始化redis配置
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">InitRedisStore</span>()

	<span style="color:#a6e22e">app</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
	<span style="color:#75715e">//初始化session
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">InitSession</span>(<span style="color:#a6e22e">app</span>)
	<span style="color:#75715e">//设置全局跨域访问
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">Use</span>(<span style="color:#a6e22e">Cors</span>())
	<span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">app</span>)

	<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppHost</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">AppPort</span>)

}
</code></pre></div><p>效果：验证码被验证之后，就会失效</p>
<p>
        <img class="mx-auto" alt="image-20220308170600074" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220308170600074.png" />   
    </p>
<h2 id="用户名密码登录">用户名密码登录</h2>
<p>实现<code>/api/login_pwd</code>路由</p>
<p>1、在controller/MemberController.go中添加路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/sendcode&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">sendSmsCode</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/login_sms&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">smsLogin</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/captcha&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">captcha</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/vertifycha&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">vertifyCaptcha</span>)
	<span style="color:#75715e">//login_pwd
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/login_pwd&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">nameLogin</span>)
}
<span style="color:#75715e">// 使用账号密码登录
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">nameLogin</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//1、解析参数
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">loginparam</span> <span style="color:#a6e22e">param</span>.<span style="color:#a6e22e">LoginParam</span>
	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Body</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">loginparam</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;参数解析失败&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//2、验证验证码
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">validate</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">VertifyCaptcha</span>(<span style="color:#a6e22e">loginparam</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#a6e22e">loginparam</span>.<span style="color:#a6e22e">Value</span>)
	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">validate</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;验证码不正确，请重新验证&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//3、登录
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ms</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">MemberService</span>{}
	<span style="color:#a6e22e">member</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">Login</span>(<span style="color:#a6e22e">loginparam</span>.<span style="color:#a6e22e">Name</span>, <span style="color:#a6e22e">loginparam</span>.<span style="color:#a6e22e">Password</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#75715e">//将用户信息保存到session当中
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//var key string = &#34;userid_&#34;+strconv.Itoa(int(member.Id))
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">sess</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">member</span>)
		<span style="color:#75715e">//err := tools.Setsess(c, key, sess)
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Setsess</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;userid_1&#34;</span>, <span style="color:#a6e22e">sess</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;登录失败&#34;</span>)
			<span style="color:#66d9ef">return</span>
		}
		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">SetCookie</span>(<span style="color:#e6db74">&#34;cookie_user&#34;</span>, <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Itoa</span>(int(<span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span>)), <span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#ae81ff">60</span>, <span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#e6db74">&#34;localhost&#34;</span>, <span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">true</span>)
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;登录失败&#34;</span>)
}
</code></pre></div><p>2、在param/LoginParam.go中定义需要解析的参数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">param</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">LoginParam</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Name</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;name&#34;`</span>
	<span style="color:#a6e22e">Password</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;pwd&#34;`</span>
	<span style="color:#a6e22e">Id</span>       <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;id&#34;`</span>    <span style="color:#75715e">//验证码ID
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Value</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;value&#34;`</span> <span style="color:#75715e">//验证码值
</span><span style="color:#75715e"></span>}
</code></pre></div><p>3、在services/MemberService.go中实现用户登录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//用户登录
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ms</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberService</span>) <span style="color:#a6e22e">Login</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">password</span> <span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span> {
	<span style="color:#75715e">//1、使用用户名查询用户信息；如果存在，直接返回
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">md</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">MemberDao</span>{<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">DbEngie</span>}
	<span style="color:#a6e22e">member</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">password</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;memberid:&#34;</span>, <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">member</span>
	}
	<span style="color:#75715e">//2、用户不存在，作为新用户插入数据
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>{}
	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">UserName</span> = <span style="color:#a6e22e">name</span>
	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Password</span> = <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">EncoderSha256</span>(<span style="color:#a6e22e">password</span>)
	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">RegisterTime</span> = <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Unix</span>()

	<span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">InsertMember</span>(<span style="color:#a6e22e">user</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;userid:&#34;</span>, <span style="color:#a6e22e">result</span>)
	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span> = <span style="color:#a6e22e">result</span>
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>
}
</code></pre></div><p>4、在dao/MemberDao.go中实现用户查询</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//用户查询
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">md</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberDao</span>) <span style="color:#a6e22e">Query</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">password</span> <span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span> {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">member</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>
	<span style="color:#a6e22e">password</span> = <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">EncoderSha256</span>(<span style="color:#a6e22e">password</span>)
	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;user_name =? and password = ?&#34;</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">password</span>).<span style="color:#a6e22e">Get</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>
}
</code></pre></div><p>5、在tools/Passwordencoder.go来加密密码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;crypto/md5&#34;</span>
	<span style="color:#e6db74">&#34;crypto/sha256&#34;</span>
	<span style="color:#e6db74">&#34;encoding/base64&#34;</span>
	<span style="color:#e6db74">&#34;encoding/hex&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;io&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">EncoderSha256</span>(<span style="color:#a6e22e">data</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
	<span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">New</span>()
	<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">data</span>))
	<span style="color:#a6e22e">sum</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>)
	<span style="color:#75715e">//由于是十六进制表示，因此需要进行转换
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">hex</span>.<span style="color:#a6e22e">EncodeToString</span>(<span style="color:#a6e22e">sum</span>)
	<span style="color:#66d9ef">return</span> string(<span style="color:#a6e22e">s</span>)
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Md5</span>(<span style="color:#a6e22e">data</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
	<span style="color:#a6e22e">w</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md5</span>.<span style="color:#a6e22e">New</span>()
	<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">WriteString</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">data</span>)
	<span style="color:#a6e22e">bydate</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>)
	<span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">bydate</span>)
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Base64Encode</span>(<span style="color:#a6e22e">data</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">base64</span>.<span style="color:#a6e22e">StdEncoding</span>.<span style="color:#a6e22e">EncodeToString</span>([]byte(<span style="color:#a6e22e">data</span>))
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Base64Decode</span>(<span style="color:#a6e22e">data</span> <span style="color:#66d9ef">string</span>) ([]<span style="color:#66d9ef">byte</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">base64</span>.<span style="color:#a6e22e">StdEncoding</span>.<span style="color:#a6e22e">DecodeString</span>(<span style="color:#a6e22e">data</span>)
}

</code></pre></div><h2 id="用户头像上传">用户头像上传</h2>
<p>实现<code>/api/upload/avator</code>路由</p>
<p>1、在controller/MemberController.go中添加路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/sendcode&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">sendSmsCode</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/login_sms&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">smsLogin</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/captcha&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">captcha</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/vertifycha&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">vertifyCaptcha</span>)
	<span style="color:#75715e">//login_pwd
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/login_pwd&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">nameLogin</span>)
	<span style="color:#75715e">//头像上传
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/upload/avator&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">uploadAvatar</span>)
}
<span style="color:#75715e">//头像上传
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">uploadAvatar</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//1、解析上传的参数
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">userid</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">PostForm</span>(<span style="color:#e6db74">&#34;user_id&#34;</span>)
	<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">FormFile</span>(<span style="color:#e6db74">&#34;avatar&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;avatar decode error&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#75715e">//2、判断user_id对应的用户是否已经登录
</span><span style="color:#75715e"></span>	<span style="color:#75715e">//&#34;userid_&#34;+string(member.Id)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span> = <span style="color:#e6db74">&#34;userid_&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">userid</span>
	<span style="color:#a6e22e">sess</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">GetSess</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">key</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">sess</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;用户未登录&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">member</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>
	<span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">sess</span>.([]<span style="color:#66d9ef">byte</span>), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>)

	<span style="color:#75715e">//3、file保存到本地
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">filename</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;./uploadFile&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">FormatInt</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Unix</span>(), <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">Filename</span>
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">SaveUploadedFile</span>(<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">filename</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;保存文件失败&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//4、将保存后的文件本地路径，保存到用户表的头像字段
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">memberService</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">MemberService</span>{}
    <span style="color:#a6e22e">path</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">memberService</span>.<span style="color:#a6e22e">UploadAvatar</span>(<span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#a6e22e">filename</span>[<span style="color:#ae81ff">1</span>:])
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
        <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;http://localhost:8090/&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">path</span>)
        <span style="color:#66d9ef">return</span>
    }

	<span style="color:#75715e">//5、返回结果
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;上传失败&#34;</span>)
}
</code></pre></div><p>2、在services/MemberService.go中实现上传头像功能</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//上传头像
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberService</span>) <span style="color:#a6e22e">UploadAvatar</span>(<span style="color:#a6e22e">userid</span> <span style="color:#66d9ef">int64</span>, <span style="color:#a6e22e">fileName</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
	<span style="color:#a6e22e">memberDao</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">MemberDao</span>{<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">DbEngie</span>}
	<span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">memberDao</span>.<span style="color:#a6e22e">UpdatememberAvatar</span>(<span style="color:#a6e22e">userid</span>, <span style="color:#a6e22e">fileName</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fileName</span>
}
</code></pre></div><p>3、在dao/MemberDao.go中将数据插入到数据库中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//更新用户
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">md</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberDao</span>) <span style="color:#a6e22e">UpdatememberAvatar</span>(<span style="color:#a6e22e">userid</span> <span style="color:#66d9ef">int64</span>, <span style="color:#a6e22e">fileName</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">int64</span> {
	<span style="color:#a6e22e">member</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>{<span style="color:#a6e22e">Avatar</span>: <span style="color:#a6e22e">fileName</span>}
	<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;id = ?&#34;</span>, <span style="color:#a6e22e">userid</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>
}
</code></pre></div><h2 id="fastdfs分布式文件系统部署">FastDfs分布式文件系统部署</h2>
<p>参考博客：https://www.cnblogs.com/chiangchou/p/fastdfs.html</p>
<p>启动fastdfs：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start
/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start
</code></pre></div><p>启动nginx:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">/usr/local/nginx/sbin/nginx
</code></pre></div><p>关闭防火墙：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">systemctl stop firewalld.service
</code></pre></div><h2 id="上传文件到fastdfs">上传文件到FastDfs</h2>
<p>安装fastdfs客户端:<code>go get github.com/tedcy/fdfs_client</code></p>
<p>1、创建config/fastdfs.conf文件</p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">tracker_server=192.168.145.151:22122
http_server_port=http://192.168.145.151:80
maxConns=100
</code></pre><p>2、创建tools/FastDfsUtil.go</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">tools</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;bufio&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/tedcy/fdfs_client&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
	<span style="color:#e6db74">&#34;strings&#34;</span>
)
<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 上传文件到fastDFS系统
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">FASTDFS_CONFIG</span> <span style="color:#66d9ef">string</span> = <span style="color:#e6db74">&#34;./config/fastdfs.conf&#34;</span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">UploadFile</span>(<span style="color:#a6e22e">fileName</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span>{
	<span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fdfs_client</span>.<span style="color:#a6e22e">NewClientWithConfig</span>(<span style="color:#a6e22e">FASTDFS_CONFIG</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Destory</span>()

	<span style="color:#a6e22e">fileId</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">UploadByFilename</span>(<span style="color:#a6e22e">fileName</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fileId</span>
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 从配置文件中读取文件服务器的ip和端口配置配置
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">FileServerAddr</span>() <span style="color:#66d9ef">string</span>{
	<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">FASTDFS_CONFIG</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#a6e22e">reader</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">file</span>)
	<span style="color:#66d9ef">for</span>{
		<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadString</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
		<span style="color:#a6e22e">line</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSuffix</span>(<span style="color:#a6e22e">line</span>, <span style="color:#e6db74">&#34;\n&#34;</span>)
		<span style="color:#a6e22e">str</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">SplitN</span>(<span style="color:#a6e22e">line</span>, <span style="color:#e6db74">&#34;=&#34;</span>, <span style="color:#ae81ff">2</span>)
		<span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">str</span>[<span style="color:#ae81ff">0</span>]{
		<span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;http_server_port&#34;</span>:
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">str</span>[<span style="color:#ae81ff">1</span>]
		}
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
			<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
		}
	}
}
</code></pre></div><p>3、修改controller/MemberController.go中的uploadAvatar方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//头像上传
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">uploadAvatar</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//1、解析上传的参数
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">userid</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">PostForm</span>(<span style="color:#e6db74">&#34;user_id&#34;</span>)
	<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">FormFile</span>(<span style="color:#e6db74">&#34;avatar&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;avatar decode error&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#75715e">//2、判断user_id对应的用户是否已经登录
</span><span style="color:#75715e"></span>	<span style="color:#75715e">//&#34;userid_&#34;+string(member.Id)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span> = <span style="color:#e6db74">&#34;userid_&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">userid</span>
	<span style="color:#a6e22e">sess</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">GetSess</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">key</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">sess</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;用户未登录&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">member</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>
	<span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">sess</span>.([]<span style="color:#66d9ef">byte</span>), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>)

	<span style="color:#75715e">//3、file保存到本地
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">filename</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;./uploadFile&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">FormatInt</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Unix</span>(), <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">Filename</span>
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">SaveUploadedFile</span>(<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">filename</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;保存文件失败&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#75715e">//3.1 将文件上传到fastDFS系统
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fileId</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">UploadFile</span>(<span style="color:#a6e22e">filename</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">fileId</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
		<span style="color:#75715e">//删除本地uploadfile文件夹的文件
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Remove</span>(<span style="color:#a6e22e">filename</span>)

		<span style="color:#75715e">//4、将保存后的文件本地路径，保存到用户表的头像字段
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">memberService</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">MemberService</span>{}
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">memberService</span>.<span style="color:#a6e22e">UploadAvatar</span>(<span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#a6e22e">filename</span>[<span style="color:#ae81ff">1</span>:])
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
			<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">FileServerAddr</span>()<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">path</span>)
			<span style="color:#66d9ef">return</span>
		}
	}

	<span style="color:#75715e">//5、返回结果
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;上传失败&#34;</span>)
}
</code></pre></div><h2 id="获取食品类别数据">获取食品类别数据</h2>
<p>实现<code>/api/food_category</code>路由</p>
<p>1、在model/FoodCategory.go中定义数据结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">model</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FoodCategory</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Id</span>          <span style="color:#66d9ef">int64</span>  <span style="color:#e6db74">`xorm:&#34;pk autoincr&#34; json:&#34;id&#34;`</span>
	<span style="color:#a6e22e">Title</span>       <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(20)&#34; json:&#34;title&#34;`</span>
	<span style="color:#a6e22e">Description</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(30)&#34; json:&#34;descripiton&#34;`</span>
	<span style="color:#a6e22e">ImageUrl</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(255)&#34; json:&#34;image_url&#34;`</span>
	<span style="color:#a6e22e">LinkUrl</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(255)&#34; json:&#34;link_url&#34;`</span>
	<span style="color:#a6e22e">IsInServing</span> <span style="color:#66d9ef">bool</span>   <span style="color:#e6db74">`json:&#34;is_in_serving&#34;`</span>
}
</code></pre></div><p>2、在tools/OrmEngine.go中同步数据结构到数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Orm</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">database</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Database</span>
	<span style="color:#a6e22e">conn</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">User</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Password</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;@tcp(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Port</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">DbName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?charset=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Charset</span>
	<span style="color:#a6e22e">engine</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">xorm</span>.<span style="color:#a6e22e">NewEngine</span>(<span style="color:#e6db74">&#34;mysql&#34;</span>, <span style="color:#a6e22e">conn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">ShowSQL</span>(<span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">ShowSql</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Sync2</span>(new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FoodCategory</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">orm</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Orm</span>)
	<span style="color:#a6e22e">orm</span>.<span style="color:#a6e22e">Engine</span> = <span style="color:#a6e22e">engine</span>
	<span style="color:#a6e22e">DbEngie</span> = <span style="color:#a6e22e">orm</span>
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">orm</span>, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>3、准备测试数据：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;预定早餐&#34;</span>,<span style="color:#e6db74">&#34;预定早餐&#34;</span>,<span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;果蔬生鲜&#34;</span>,<span style="color:#e6db74">&#34;果蔬生鲜&#34;</span>,<span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;鲜花蛋糕&#34;</span>,<span style="color:#e6db74">&#34;鲜花蛋糕&#34;</span>,<span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;商超便利&#34;</span>,<span style="color:#e6db74">&#34;商超便利&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;美食&#34;</span>,<span style="color:#e6db74">&#34;美食&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;甜品饮品&#34;</span>,<span style="color:#e6db74">&#34;甜品饮品&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;土豪推荐&#34;</span>,<span style="color:#e6db74">&#34;土豪推荐&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;准时达&#34;</span>,<span style="color:#e6db74">&#34;准时达&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;简餐&#34;</span>,<span style="color:#e6db74">&#34;简餐&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;汉堡薯条&#34;</span>,<span style="color:#e6db74">&#34;汉堡薯条&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;日韩料理&#34;</span>,<span style="color:#e6db74">&#34;日韩料理&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;日韩料理&#34;</span>,<span style="color:#e6db74">&#34;麻辣烫&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;披萨意面&#34;</span>,<span style="color:#e6db74">&#34;披萨意面&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;川湘菜&#34;</span>,<span style="color:#e6db74">&#34;川湘菜&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;包子粥店&#34;</span>,<span style="color:#e6db74">&#34;包子粥店&#34;</span>,<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">food_category</span>(title,description,is_in_serving) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;新店特惠&#34;</span>,<span style="color:#e6db74">&#34;新店特惠&#34;</span>,<span style="color:#ae81ff">0</span>);
</code></pre></div><p>4、在controller/FoodCategoryController.go添加路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">controller</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/services&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FoodCategoryController</span> <span style="color:#66d9ef">struct</span> {
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">fcc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">FoodCategoryController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/food_category&#34;</span>, <span style="color:#a6e22e">fcc</span>.<span style="color:#a6e22e">foodCategory</span>)
}
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">fcc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">FoodCategoryController</span>) <span style="color:#a6e22e">foodCategory</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//调用service功能获取食品种类信息
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">foodCategoryService</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">FoodCategoryService</span>{}
	<span style="color:#a6e22e">categories</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">foodCategoryService</span>.<span style="color:#a6e22e">Categories</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;食品种类数据获取失败&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//格式转换
</span><span style="color:#75715e"></span>	<span style="color:#75715e">//imgUrl :hello.png
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">category</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">categories</span> {
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">category</span>.<span style="color:#a6e22e">ImageUrl</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
			<span style="color:#a6e22e">category</span>.<span style="color:#a6e22e">ImageUrl</span> = <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">FileServerAddr</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">category</span>.<span style="color:#a6e22e">ImageUrl</span>
		}
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">categories</span>)
}

</code></pre></div><p>5、在Services/FoodCategoryService.go中实现获取类别功能</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">services</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/dao&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/model&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FoodCategoryService</span> <span style="color:#66d9ef">struct</span> {
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 获取美食类别
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">fcs</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">FoodCategoryService</span>) <span style="color:#a6e22e">Categories</span>() ([]<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FoodCategory</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#75715e">//数据库操作层
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">foodCategoryDao</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">NewFoodCategoryDao</span>()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">foodCategoryDao</span>.<span style="color:#a6e22e">QueryCategories</span>()
}
</code></pre></div><p>6、在dao/FoodCategoryDao.go中查询数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">dao</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/model&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FoodCategoryDao</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#f92672">*</span><span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Orm</span>
}

<span style="color:#75715e">//实例化Dao对象
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewFoodCategoryDao</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">FoodCategoryDao</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">FoodCategoryDao</span>{<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">DbEngie</span>}
}

<span style="color:#75715e">//从数据库中查询所有的食品种类，并返回
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">fcd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">FoodCategoryDao</span>) <span style="color:#a6e22e">QueryCategories</span>() ([]<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FoodCategory</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">categories</span> []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FoodCategory</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fcd</span>.<span style="color:#a6e22e">Engine</span>.<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">categories</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">categories</span>, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>7、在main.go中注册路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">HelloController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">MemberController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">FoodCategoryController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
}
</code></pre></div><p>效果：</p>
<p>
        <img class="mx-auto" alt="image-20220308173246579" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220308173246579.png" />   
    </p>
<h2 id="根据经纬度获取商家数据">根据经纬度获取商家数据</h2>
<p>实现<code>/api/shops</code>路由</p>
<p>1、在model/Shop.go中定义商店的数据结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">model</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Shop</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Id</span>                 <span style="color:#66d9ef">int64</span>     <span style="color:#e6db74">`xorm:&#34;pk autoincr&#34; json:&#34;id&#34;`</span>
	<span style="color:#a6e22e">Name</span>               <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(12)&#34; json:&#34;name&#34;`</span>
	<span style="color:#a6e22e">PromotionInfo</span>      <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(30)&#34; json:&#34;promotion_info&#34;`</span>
	<span style="color:#a6e22e">Address</span>            <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(100)&#34; json:&#34;address&#34;`</span>
	<span style="color:#a6e22e">Phone</span>              <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(11)&#34; json:&#34;phone&#34;`</span>
	<span style="color:#a6e22e">Status</span>             <span style="color:#66d9ef">int</span>       <span style="color:#e6db74">`xorm:&#34;tinyint&#34; json:&#34;status&#34;`</span>
	<span style="color:#a6e22e">Longitude</span>          <span style="color:#66d9ef">float64</span>   <span style="color:#e6db74">`xorm:&#34;&#34; json:&#34;longitude&#34;`</span>
	<span style="color:#a6e22e">Latitude</span>           <span style="color:#66d9ef">float64</span>   <span style="color:#e6db74">`xorm:&#34;&#34; json:&#34;latitude&#34;`</span>
	<span style="color:#a6e22e">ImagePath</span>          <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(255)&#34; json:&#34;image_path&#34;`</span>
	<span style="color:#a6e22e">IsNew</span>              <span style="color:#66d9ef">bool</span>      <span style="color:#e6db74">`xorm:&#34;bool&#34; json:&#34;is_new&#34;`</span>
	<span style="color:#a6e22e">IsPremium</span>          <span style="color:#66d9ef">bool</span>      <span style="color:#e6db74">`xorm:&#34;bool&#34; json:&#34;is_premium&#34;`</span>
	<span style="color:#a6e22e">Rating</span>             <span style="color:#66d9ef">float32</span>   <span style="color:#e6db74">`xorm:&#34;float&#34; json:&#34;rating&#34;`</span>
	<span style="color:#a6e22e">RatingCount</span>        <span style="color:#66d9ef">int64</span>     <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;rating_count&#34;`</span>
	<span style="color:#a6e22e">RecentOrderNum</span>     <span style="color:#66d9ef">int64</span>     <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;recent_order_num&#34;`</span>
	<span style="color:#a6e22e">MinimumOrderAmount</span> <span style="color:#66d9ef">int32</span>     <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;minimum_order_amount&#34;`</span>
	<span style="color:#a6e22e">DeliveryFee</span>        <span style="color:#66d9ef">int32</span>     <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;delivery_fee&#34;`</span>
	<span style="color:#a6e22e">OpeningHours</span>       <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(20)&#34; json:&#34;opening_hours&#34;`</span>
}

</code></pre></div><p>2、在tools/OrmEngine.go中将数据结构同步到数据库中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Orm</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">database</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Database</span>
	<span style="color:#a6e22e">conn</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">User</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Password</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;@tcp(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Port</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">DbName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?charset=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Charset</span>
	<span style="color:#a6e22e">engine</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">xorm</span>.<span style="color:#a6e22e">NewEngine</span>(<span style="color:#e6db74">&#34;mysql&#34;</span>, <span style="color:#a6e22e">conn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">ShowSQL</span>(<span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">ShowSql</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Sync2</span>(new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FoodCategory</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">orm</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Orm</span>)
	<span style="color:#a6e22e">orm</span>.<span style="color:#a6e22e">Engine</span> = <span style="color:#a6e22e">engine</span>
	<span style="color:#a6e22e">DbEngie</span> = <span style="color:#a6e22e">orm</span>
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">orm</span>, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>3、在tools/OrmEngine.go中初始化数据</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Orm</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">database</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Database</span>
	<span style="color:#a6e22e">conn</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">User</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Password</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;@tcp(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Port</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">DbName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?charset=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Charset</span>
	<span style="color:#a6e22e">engine</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">xorm</span>.<span style="color:#a6e22e">NewEngine</span>(<span style="color:#e6db74">&#34;mysql&#34;</span>, <span style="color:#a6e22e">conn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">ShowSQL</span>(<span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">ShowSql</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Sync2</span>(new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FoodCategory</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">orm</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Orm</span>)
	<span style="color:#a6e22e">orm</span>.<span style="color:#a6e22e">Engine</span> = <span style="color:#a6e22e">engine</span>
	<span style="color:#a6e22e">DbEngie</span> = <span style="color:#a6e22e">orm</span>

	<span style="color:#75715e">//插入初始化shop数据
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">InitShopData</span>()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">orm</span>, <span style="color:#66d9ef">nil</span>
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 向shop表中插入初始数据
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">InitShopData</span>() {
	<span style="color:#a6e22e">shops</span> <span style="color:#f92672">:=</span> []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span>{
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;嘉禾一品（温都水城）&#34;</span>, <span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;北京市昌平区宏福苑温都水城F1&#34;</span>, <span style="color:#a6e22e">Longitude</span>: <span style="color:#ae81ff">116.36868</span>, <span style="color:#a6e22e">Latitude</span>: <span style="color:#ae81ff">40.10039</span>,
			<span style="color:#a6e22e">Phone</span>: <span style="color:#e6db74">&#34;13437850035&#34;</span>, <span style="color:#a6e22e">Status</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">RecentOrderNum</span>: <span style="color:#ae81ff">106</span>, <span style="color:#a6e22e">RatingCount</span>: <span style="color:#ae81ff">961</span>, <span style="color:#a6e22e">Rating</span>: <span style="color:#ae81ff">4.7</span>, <span style="color:#a6e22e">PromotionInfo</span>: <span style="color:#e6db74">&#34;欢迎光临，用餐高峰请提前下单，谢谢&#34;</span>,
			<span style="color:#a6e22e">OpeningHours</span>: <span style="color:#e6db74">&#34;8:30/20:30&#34;</span>, <span style="color:#a6e22e">IsNew</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">IsPremium</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">ImagePath</span>: <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">MinimumOrderAmount</span>: <span style="color:#ae81ff">20</span>, <span style="color:#a6e22e">DeliveryFee</span>: <span style="color:#ae81ff">5</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">479</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;杨国福麻辣烫&#34;</span>, <span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;北京市市蜀山区南二环路天鹅湖万达广场8号楼1705室&#34;</span>, <span style="color:#a6e22e">Longitude</span>: <span style="color:#ae81ff">117.22124</span>, <span style="color:#a6e22e">Latitude</span>: <span style="color:#ae81ff">31.81948</span>, <span style="color:#a6e22e">Phone</span>: <span style="color:#e6db74">&#34;13167583411&#34;</span>,
			<span style="color:#a6e22e">Status</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">RecentOrderNum</span>: <span style="color:#ae81ff">755</span>, <span style="color:#a6e22e">RatingCount</span>: <span style="color:#ae81ff">167</span>, <span style="color:#a6e22e">Rating</span>: <span style="color:#ae81ff">4.2</span>, <span style="color:#a6e22e">PromotionInfo</span>: <span style="color:#e6db74">&#34;欢迎光临，用餐高峰请提前下单，谢谢&#34;</span>, <span style="color:#a6e22e">OpeningHours</span>: <span style="color:#e6db74">&#34;8:30/20:30&#34;</span>,
			<span style="color:#a6e22e">IsNew</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">IsPremium</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">ImagePath</span>: <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">MinimumOrderAmount</span>: <span style="color:#ae81ff">20</span>, <span style="color:#a6e22e">DeliveryFee</span>: <span style="color:#ae81ff">5</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">485</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;好适口&#34;</span>, <span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;北京市海淀区西二旗大街58号&#34;</span>, <span style="color:#a6e22e">Longitude</span>: <span style="color:#ae81ff">120.65355</span>, <span style="color:#a6e22e">Latitude</span>: <span style="color:#ae81ff">31.26578</span>, <span style="color:#a6e22e">Phone</span>: <span style="color:#e6db74">&#34;12345678901&#34;</span>,
			<span style="color:#a6e22e">Status</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">RecentOrderNum</span>: <span style="color:#ae81ff">58</span>, <span style="color:#a6e22e">RatingCount</span>: <span style="color:#ae81ff">576</span>, <span style="color:#a6e22e">Rating</span>: <span style="color:#ae81ff">4.6</span>, <span style="color:#a6e22e">PromotionInfo</span>: <span style="color:#e6db74">&#34;欢迎光临，用餐高峰请提前下单，谢谢&#34;</span>, <span style="color:#a6e22e">OpeningHours</span>: <span style="color:#e6db74">&#34;8:30/20:30&#34;</span>,
			<span style="color:#a6e22e">IsNew</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">IsPremium</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">ImagePath</span>: <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">MinimumOrderAmount</span>: <span style="color:#ae81ff">20</span>, <span style="color:#a6e22e">DeliveryFee</span>: <span style="color:#ae81ff">5</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">486</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;东来顺旗舰店&#34;</span>, <span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;北京市天河区东圃镇汇彩路38号1领汇创展商务中心401&#34;</span>, <span style="color:#a6e22e">Longitude</span>: <span style="color:#ae81ff">113.41724</span>, <span style="color:#a6e22e">Latitude</span>: <span style="color:#ae81ff">23.1127</span>, <span style="color:#a6e22e">Status</span>: <span style="color:#ae81ff">1</span>,
			<span style="color:#a6e22e">Phone</span>: <span style="color:#e6db74">&#34;13544323775&#34;</span>, <span style="color:#a6e22e">RecentOrderNum</span>: <span style="color:#ae81ff">542</span>, <span style="color:#a6e22e">RatingCount</span>: <span style="color:#ae81ff">372</span>, <span style="color:#a6e22e">Rating</span>: <span style="color:#ae81ff">4.2</span>, <span style="color:#a6e22e">PromotionInfo</span>: <span style="color:#e6db74">&#34;老北京正宗涮羊肉,非物质文化遗产&#34;</span>,
			<span style="color:#a6e22e">OpeningHours</span>: <span style="color:#e6db74">&#34;09:00/21:30&#34;</span>, <span style="color:#a6e22e">IsNew</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">IsPremium</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">ImagePath</span>: <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">MinimumOrderAmount</span>: <span style="color:#ae81ff">20</span>, <span style="color:#a6e22e">DeliveryFee</span>: <span style="color:#ae81ff">5</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">487</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;北京酒家&#34;</span>, <span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;北京市海淀区上下九商业步行街内&#34;</span>, <span style="color:#a6e22e">Longitude</span>: <span style="color:#ae81ff">113.24826</span>, <span style="color:#a6e22e">Latitude</span>: <span style="color:#ae81ff">23.11488</span>, <span style="color:#a6e22e">Phone</span>: <span style="color:#e6db74">&#34;13257482341&#34;</span>, <span style="color:#a6e22e">Status</span>: <span style="color:#ae81ff">0</span>,
			<span style="color:#a6e22e">RecentOrderNum</span>: <span style="color:#ae81ff">923</span>, <span style="color:#a6e22e">RatingCount</span>: <span style="color:#ae81ff">871</span>, <span style="color:#a6e22e">Rating</span>: <span style="color:#ae81ff">4.2</span>, <span style="color:#a6e22e">PromotionInfo</span>: <span style="color:#e6db74">&#34;北京第一家传承300年酒家&#34;</span>, <span style="color:#a6e22e">OpeningHours</span>: <span style="color:#e6db74">&#34;8:30/20:30&#34;</span>, <span style="color:#a6e22e">IsNew</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">IsPremium</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">ImagePath</span>: <span style="color:#e6db74">&#34;&#34;</span>,
			<span style="color:#a6e22e">MinimumOrderAmount</span>: <span style="color:#ae81ff">20</span>, <span style="color:#a6e22e">DeliveryFee</span>: <span style="color:#ae81ff">5</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">488</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;和平鸽饺子馆&#34;</span>, <span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;北京市越秀区德政中路171&#34;</span>, <span style="color:#a6e22e">Longitude</span>: <span style="color:#ae81ff">113.27521</span>, <span style="color:#a6e22e">Latitude</span>: <span style="color:#ae81ff">23.12092</span>,
			<span style="color:#a6e22e">Phone</span>: <span style="color:#e6db74">&#34;17098764762&#34;</span>, <span style="color:#a6e22e">Status</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">RecentOrderNum</span>: <span style="color:#ae81ff">483</span>, <span style="color:#a6e22e">RatingCount</span>: <span style="color:#ae81ff">273</span>, <span style="color:#a6e22e">Rating</span>: <span style="color:#ae81ff">4.2</span>, <span style="color:#a6e22e">PromotionInfo</span>: <span style="color:#e6db74">&#34;吃饺子就来和平鸽饺子馆&#34;</span>, <span style="color:#a6e22e">OpeningHours</span>: <span style="color:#e6db74">&#34;8:30/20:30&#34;</span>,
			<span style="color:#a6e22e">IsNew</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">IsPremium</span>: <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">ImagePath</span>: <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">MinimumOrderAmount</span>: <span style="color:#ae81ff">20</span>, <span style="color:#a6e22e">DeliveryFee</span>: <span style="color:#ae81ff">5</span>}}
	<span style="color:#75715e">//事务
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">session</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">DbEngie</span>.<span style="color:#a6e22e">NewSession</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#75715e">//事务操作：事务开始，执行操作(回滚),提交事务
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Begin</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">shop</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">shops</span> {
		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Insert</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">shop</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Rollback</span>()
			<span style="color:#66d9ef">return</span>
		}
	}
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Commit</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
}
</code></pre></div><p>4、在controller/ShopController.go中注册路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">controller</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/services&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ShopController</span> <span style="color:#66d9ef">struct</span> {
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/shops&#34;</span>, <span style="color:#a6e22e">sc</span>.<span style="color:#a6e22e">GetShopList</span>)
}


<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 获取商铺列表
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopController</span>) <span style="color:#a6e22e">GetShopList</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//获取经纬度
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">longitude</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;longitude&#34;</span>)
	<span style="color:#a6e22e">latitude</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;latitude&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;undefined&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;undefined&#34;</span> {
		<span style="color:#a6e22e">longitude</span> = <span style="color:#e6db74">&#34;116.34&#34;</span>
		<span style="color:#a6e22e">latitude</span> = <span style="color:#e6db74">&#34;40.34&#34;</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>)
	<span style="color:#a6e22e">shopService</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">ShopService</span>{}
	<span style="color:#a6e22e">shops</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shopService</span>.<span style="color:#a6e22e">ShopList</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>)
	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">shops</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;暂未获取到商户信息&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">shops</span>)
}

</code></pre></div><p>5、在services/ShopService.go中实现功能</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">services</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/dao&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/model&#34;</span>
	<span style="color:#e6db74">&#34;strconv&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ShopService</span> <span style="color:#66d9ef">struct</span> {
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 根据商户id获取对应的服务
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ss</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopService</span>) <span style="color:#a6e22e">GetService</span>(<span style="color:#a6e22e">shopId</span> <span style="color:#66d9ef">int64</span>) []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Service</span> {
	<span style="color:#a6e22e">shopDao</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">NewShopDao</span>()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shopDao</span>.<span style="color:#a6e22e">QueryServiceByShopId</span>(<span style="color:#a6e22e">shopId</span>)
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 查询商铺列表数据
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ss</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopService</span>) <span style="color:#a6e22e">ShopList</span>(<span style="color:#a6e22e">long</span>, <span style="color:#a6e22e">lat</span> <span style="color:#66d9ef">string</span>) []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span> {
	<span style="color:#75715e">//类型转换
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">ParseFloat</span>(<span style="color:#a6e22e">long</span>, <span style="color:#ae81ff">10</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#a6e22e">latitude</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">ParseFloat</span>(<span style="color:#a6e22e">lat</span>, <span style="color:#ae81ff">10</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#a6e22e">shopDao</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">NewShopDao</span>()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shopDao</span>.<span style="color:#a6e22e">QueryShops</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>, <span style="color:#e6db74">&#34;&#34;</span>)
}

</code></pre></div><p>6、在dao/ShopDao.go中实现数据库的查询操作</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">dao</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/model&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ShopDao</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#f92672">*</span><span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Orm</span>
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">DEFAULT_RANGE</span> = <span style="color:#ae81ff">5</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewShopDao</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopDao</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ShopDao</span>{<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">DbEngie</span>}
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 操作数据库查询商铺列表数据
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopDao</span>) <span style="color:#a6e22e">QueryShops</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span> <span style="color:#66d9ef">float64</span>, <span style="color:#a6e22e">keyword</span> <span style="color:#66d9ef">string</span>) []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span> {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">shops</span> []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">keyword</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
		<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sd</span>.<span style="color:#a6e22e">Engine</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;longitude&gt;? and longitude&lt;? and latitude&gt;? and latitude &lt;? and status=1&#34;</span>, <span style="color:#a6e22e">longitude</span><span style="color:#f92672">-</span><span style="color:#a6e22e">DEFAULT_RANGE</span>, <span style="color:#a6e22e">longitude</span><span style="color:#f92672">+</span><span style="color:#a6e22e">DEFAULT_RANGE</span>, <span style="color:#a6e22e">latitude</span><span style="color:#f92672">-</span><span style="color:#a6e22e">DEFAULT_RANGE</span>, <span style="color:#a6e22e">latitude</span><span style="color:#f92672">+</span><span style="color:#a6e22e">DEFAULT_RANGE</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">shops</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
		}
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sd</span>.<span style="color:#a6e22e">Engine</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;longitude&gt;? and longitude&lt;? and latitude&gt;? and latitude &lt;? and name like ? and status=1&#34;</span>, <span style="color:#a6e22e">longitude</span><span style="color:#f92672">-</span><span style="color:#a6e22e">DEFAULT_RANGE</span>, <span style="color:#a6e22e">longitude</span><span style="color:#f92672">+</span><span style="color:#a6e22e">DEFAULT_RANGE</span>, <span style="color:#a6e22e">latitude</span><span style="color:#f92672">-</span><span style="color:#a6e22e">DEFAULT_RANGE</span>, <span style="color:#a6e22e">latitude</span><span style="color:#f92672">+</span><span style="color:#a6e22e">DEFAULT_RANGE</span>, <span style="color:#e6db74">&#34;%&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">keyword</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;%&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">shops</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
		}
	}

	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shops</span>
}

</code></pre></div><p>7、在main.go中注册路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">HelloController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">MemberController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">FoodCategoryController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">ShopController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
}
</code></pre></div><p>效果：</p>
<p>
        <img class="mx-auto" alt="image-20220308174510240" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220308174510240.png" />   
    </p>
<h2 id="关键词搜索商家">关键词搜索商家</h2>
<p>实现：<code>/api/search_shops</code>路由</p>
<p>1、在controller/ShopController.go中添加路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/shops&#34;</span>, <span style="color:#a6e22e">sc</span>.<span style="color:#a6e22e">GetShopList</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/search_shops&#34;</span>, <span style="color:#a6e22e">sc</span>.<span style="color:#a6e22e">SearchShop</span>)
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 关键词搜索
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopController</span>) <span style="color:#a6e22e">SearchShop</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//获取经纬度
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">longitude</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;longitude&#34;</span>)
	<span style="color:#a6e22e">latitude</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;latitude&#34;</span>)
	<span style="color:#a6e22e">keyword</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;keyword&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">keyword</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;请重新输入商铺名称&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//40.10038,116.36867
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;undefined&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;undefined&#34;</span> {
		<span style="color:#a6e22e">longitude</span> = <span style="color:#e6db74">&#34;116.34&#34;</span>
		<span style="color:#a6e22e">latitude</span> = <span style="color:#e6db74">&#34;40.34&#34;</span>
	}
	<span style="color:#75715e">//执行真实的搜索逻辑
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">shopService</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">ShopService</span>{}
	<span style="color:#a6e22e">shops</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shopService</span>.<span style="color:#a6e22e">SearchShops</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>, <span style="color:#a6e22e">keyword</span>)
	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">shops</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>{
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>,<span style="color:#e6db74">&#34;未搜索到商铺信息&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>,<span style="color:#a6e22e">shops</span>)
}
</code></pre></div><p>2、在service/ShopService.go中实现用关键字查询商铺功能</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * 根据关键词查询商铺
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ss</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopService</span>) <span style="color:#a6e22e">SearchShops</span>(<span style="color:#a6e22e">long</span>, <span style="color:#a6e22e">lat</span>, <span style="color:#a6e22e">keyword</span> <span style="color:#66d9ef">string</span>) []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span> {
	<span style="color:#75715e">//类型转换
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">ParseFloat</span>(<span style="color:#a6e22e">long</span>, <span style="color:#ae81ff">10</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#a6e22e">latitude</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">ParseFloat</span>(<span style="color:#a6e22e">lat</span>, <span style="color:#ae81ff">10</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#a6e22e">shopDao</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">NewShopDao</span>()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shopDao</span>.<span style="color:#a6e22e">QueryShops</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>, <span style="color:#a6e22e">keyword</span>)

}
</code></pre></div><p>效果</p>
<p>
        <img class="mx-auto" alt="image-20220308175323727" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220308175323727.png" />   
    </p>
<h2 id="用户信息查询">用户信息查询</h2>
<p>实现<code>/api/userinfo</code>路由</p>
<p>1、在controller/MemberController.go中添加路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/sendcode&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">sendSmsCode</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/login_sms&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">smsLogin</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/captcha&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">captcha</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/vertifycha&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">vertifyCaptcha</span>)
	<span style="color:#75715e">//login_pwd
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/login_pwd&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">nameLogin</span>)
	<span style="color:#75715e">//头像上传
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">POST</span>(<span style="color:#e6db74">&#34;/api/upload/avator&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">uploadAvatar</span>)
	<span style="color:#75715e">//用户信息查询
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/userinfo&#34;</span>, <span style="color:#a6e22e">mc</span>.<span style="color:#a6e22e">userInfo</span>)
}
<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 用户信息查询
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberController</span>) <span style="color:#a6e22e">userInfo</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#a6e22e">cookie</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">CookieAuth</span>(<span style="color:#a6e22e">c</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Abort</span>()
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;请先登录&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">memberService</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">MemberService</span>{}
	<span style="color:#a6e22e">member</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">memberService</span>.<span style="color:#a6e22e">GetUserInfo</span>(<span style="color:#a6e22e">cookie</span>.<span style="color:#a6e22e">Value</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">member</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#75715e">//返回成功
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
			<span style="color:#e6db74">&#34;id&#34;</span>:            <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Id</span>,
			<span style="color:#e6db74">&#34;user_name&#34;</span>:     <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">UserName</span>,
			<span style="color:#e6db74">&#34;mobile&#34;</span>:        <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Mobile</span>,
			<span style="color:#e6db74">&#34;register_time&#34;</span>: <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">RegisterTime</span>,
			<span style="color:#e6db74">&#34;avatar&#34;</span>:        <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Avatar</span>,
			<span style="color:#e6db74">&#34;balance&#34;</span>:       <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">Balance</span>,
			<span style="color:#e6db74">&#34;city&#34;</span>:          <span style="color:#a6e22e">member</span>.<span style="color:#a6e22e">City</span>,
		})
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;获取用户信息失败&#34;</span>)
}
</code></pre></div><p>2、在services/MemberService.go中添加方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberService</span>) <span style="color:#a6e22e">GetUserInfo</span>(<span style="color:#a6e22e">userid</span> <span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span> {
	<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">userid</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#a6e22e">memberDao</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">MemberDao</span>{<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">DbEngie</span>}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">memberDao</span>.<span style="color:#a6e22e">QueryMemberById</span>(int64(<span style="color:#a6e22e">id</span>))
}
</code></pre></div><p>3、在dao/MemberDao.go中查询数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//根据用户id查询
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">md</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MemberDao</span>) <span style="color:#a6e22e">QueryMemberById</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">int64</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span> {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">member</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>
	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;id = ?&#34;</span>, <span style="color:#a6e22e">id</span>).<span style="color:#a6e22e">Get</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">member</span>
}
</code></pre></div><h2 id="多表查询商家信息">多表查询商家信息</h2>
<p>1、在model/Service.go中定义服务种类的数据结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">model</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Service</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Id</span>          <span style="color:#66d9ef">int64</span>  <span style="color:#e6db74">`xorm:&#34;pk autoincr&#34; json:&#34;id&#34;`</span>
	<span style="color:#a6e22e">Name</span>        <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(20)&#34; json:&#34;name&#34;`</span>
	<span style="color:#a6e22e">Description</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(30)&#34; json:&#34;description&#34;`</span>
	<span style="color:#a6e22e">IconName</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(3)&#34; json:&#34;icon_name&#34;`</span>
	<span style="color:#a6e22e">IconColor</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(6)&#34; json:&#34;icon_color&#34;`</span>
}
</code></pre></div><p>2、在tools/OrmEngine.go中同步数据结构到数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Orm</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">database</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Database</span>
	<span style="color:#a6e22e">conn</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">User</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Password</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;@tcp(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Port</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">DbName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?charset=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Charset</span>
	<span style="color:#a6e22e">engine</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">xorm</span>.<span style="color:#a6e22e">NewEngine</span>(<span style="color:#e6db74">&#34;mysql&#34;</span>, <span style="color:#a6e22e">conn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">ShowSQL</span>(<span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">ShowSql</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Sync2</span>(new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FoodCategory</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Service</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">orm</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Orm</span>)
	<span style="color:#a6e22e">orm</span>.<span style="color:#a6e22e">Engine</span> = <span style="color:#a6e22e">engine</span>
	<span style="color:#a6e22e">DbEngie</span> = <span style="color:#a6e22e">orm</span>

	<span style="color:#75715e">//插入初始化shop数据
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">InitShopData</span>()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">orm</span>, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>3、初始化service表数据</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">service</span>(name,description,icon_name,icon_color) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;外卖保&#34;</span>,<span style="color:#e6db74">&#34;已加入“外卖保”计划&#34;</span>,<span style="color:#e6db74">&#34;保&#34;</span>,<span style="color:#e6db74">&#34;999999&#34;</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">service</span>(name,description,icon_name,icon_color) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;准时达&#34;</span>,<span style="color:#e6db74">&#34;准时必达，超时秒赔&#34;</span>,<span style="color:#e6db74">&#34;准&#34;</span>,<span style="color:#e6db74">&#34;57A9FF&#34;</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">service</span>(name,description,icon_name,icon_color) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#34;开发票&#34;</span>,<span style="color:#e6db74">&#34;该商家支持开发票&#34;</span>,<span style="color:#e6db74">&#34;票&#34;</span>,<span style="color:#e6db74">&#34;999999&#34;</span>);
</code></pre></div><p>4、在model/ShopService.go中定义商户-服务数据结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">model</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ShopService</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">ShopId</span>    <span style="color:#66d9ef">int64</span> <span style="color:#e6db74">`xorm:&#34;pk not null&#34; json:&#34;shop_id&#34;`</span>
	<span style="color:#a6e22e">ServiceId</span> <span style="color:#66d9ef">int64</span> <span style="color:#e6db74">`xorm:&#34;pk not null&#34; json:&#34;service_id&#34;`</span>
}
</code></pre></div><p>5、在tools/OrmEngine.go中同步数据结构到数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Orm</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">database</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Database</span>
	<span style="color:#a6e22e">conn</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">User</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Password</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;@tcp(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Port</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">DbName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?charset=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Charset</span>
	<span style="color:#a6e22e">engine</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">xorm</span>.<span style="color:#a6e22e">NewEngine</span>(<span style="color:#e6db74">&#34;mysql&#34;</span>, <span style="color:#a6e22e">conn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">ShowSQL</span>(<span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">ShowSql</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Sync2</span>(new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FoodCategory</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Service</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">ShopService</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">orm</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Orm</span>)
	<span style="color:#a6e22e">orm</span>.<span style="color:#a6e22e">Engine</span> = <span style="color:#a6e22e">engine</span>
	<span style="color:#a6e22e">DbEngie</span> = <span style="color:#a6e22e">orm</span>

	<span style="color:#75715e">//插入初始化shop数据
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">InitShopData</span>()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">orm</span>, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>6、初始化shop_service表数据</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> shop_service <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> shop_service <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> shop_service <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> shop_service <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">479</span>,<span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> shop_service <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">479</span>,<span style="color:#ae81ff">2</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> shop_service <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">479</span>,<span style="color:#ae81ff">3</span>);
</code></pre></div><p>7、修改model/Shop.go文件，添加Supports字段</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">model</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Shop</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Id</span>                 <span style="color:#66d9ef">int64</span>     <span style="color:#e6db74">`xorm:&#34;pk autoincr&#34; json:&#34;id&#34;`</span>
	<span style="color:#a6e22e">Name</span>               <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(12)&#34; json:&#34;name&#34;`</span>
	<span style="color:#a6e22e">PromotionInfo</span>      <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(30)&#34; json:&#34;promotion_info&#34;`</span>
	<span style="color:#a6e22e">Address</span>            <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(100)&#34; json:&#34;address&#34;`</span>
	<span style="color:#a6e22e">Phone</span>              <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(11)&#34; json:&#34;phone&#34;`</span>
	<span style="color:#a6e22e">Status</span>             <span style="color:#66d9ef">int</span>       <span style="color:#e6db74">`xorm:&#34;tinyint&#34; json:&#34;status&#34;`</span>
	<span style="color:#a6e22e">Longitude</span>          <span style="color:#66d9ef">float64</span>   <span style="color:#e6db74">`xorm:&#34;&#34; json:&#34;longitude&#34;`</span>
	<span style="color:#a6e22e">Latitude</span>           <span style="color:#66d9ef">float64</span>   <span style="color:#e6db74">`xorm:&#34;&#34; json:&#34;latitude&#34;`</span>
	<span style="color:#a6e22e">ImagePath</span>          <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(255)&#34; json:&#34;image_path&#34;`</span>
	<span style="color:#a6e22e">IsNew</span>              <span style="color:#66d9ef">bool</span>      <span style="color:#e6db74">`xorm:&#34;bool&#34; json:&#34;is_new&#34;`</span>
	<span style="color:#a6e22e">IsPremium</span>          <span style="color:#66d9ef">bool</span>      <span style="color:#e6db74">`xorm:&#34;bool&#34; json:&#34;is_premium&#34;`</span>
	<span style="color:#a6e22e">Rating</span>             <span style="color:#66d9ef">float32</span>   <span style="color:#e6db74">`xorm:&#34;float&#34; json:&#34;rating&#34;`</span>
	<span style="color:#a6e22e">RatingCount</span>        <span style="color:#66d9ef">int64</span>     <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;rating_count&#34;`</span>
	<span style="color:#a6e22e">RecentOrderNum</span>     <span style="color:#66d9ef">int64</span>     <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;recent_order_num&#34;`</span>
	<span style="color:#a6e22e">MinimumOrderAmount</span> <span style="color:#66d9ef">int32</span>     <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;minimum_order_amount&#34;`</span>
	<span style="color:#a6e22e">DeliveryFee</span>        <span style="color:#66d9ef">int32</span>     <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;delivery_fee&#34;`</span>
	<span style="color:#a6e22e">OpeningHours</span>       <span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`xorm:&#34;varchar(20)&#34; json:&#34;opening_hours&#34;`</span>
	<span style="color:#a6e22e">Supports</span>           []<span style="color:#a6e22e">Service</span> <span style="color:#e6db74">`xorm:&#34;&#34;`</span>
}
</code></pre></div><p>8、修改controller/ShopController.go文件，将查询到的商户对应的service返回回来</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">controller</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/services&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ShopController</span> <span style="color:#66d9ef">struct</span> {
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopController</span>) <span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/shops&#34;</span>, <span style="color:#a6e22e">sc</span>.<span style="color:#a6e22e">GetShopList</span>)
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/search_shops&#34;</span>, <span style="color:#a6e22e">sc</span>.<span style="color:#a6e22e">SearchShop</span>)
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 关键词搜索
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopController</span>) <span style="color:#a6e22e">SearchShop</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//获取经纬度
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">longitude</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;longitude&#34;</span>)
	<span style="color:#a6e22e">latitude</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;latitude&#34;</span>)
	<span style="color:#a6e22e">keyword</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;keyword&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">keyword</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;请重新输入商铺名称&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//40.10038,116.36867
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;undefined&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;undefined&#34;</span> {
		<span style="color:#a6e22e">longitude</span> = <span style="color:#e6db74">&#34;116.34&#34;</span>
		<span style="color:#a6e22e">latitude</span> = <span style="color:#e6db74">&#34;40.34&#34;</span>
	}
	<span style="color:#75715e">//执行真实的搜索逻辑
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">shopService</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">ShopService</span>{}
	<span style="color:#a6e22e">shops</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shopService</span>.<span style="color:#a6e22e">SearchShops</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>, <span style="color:#a6e22e">keyword</span>)
	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">shops</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>{
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>,<span style="color:#e6db74">&#34;未搜索到商铺信息&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>,<span style="color:#a6e22e">shop</span><span style="color:#f92672">:=</span><span style="color:#66d9ef">range</span> <span style="color:#a6e22e">shops</span>{
		<span style="color:#a6e22e">shopService</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shopService</span>.<span style="color:#a6e22e">GetService</span>(<span style="color:#a6e22e">shop</span>.<span style="color:#a6e22e">Id</span>)
		<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">shopService</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>{
			<span style="color:#a6e22e">shop</span>.<span style="color:#a6e22e">Supports</span>=<span style="color:#66d9ef">nil</span>
		}<span style="color:#66d9ef">else</span>{
			<span style="color:#a6e22e">shop</span>.<span style="color:#a6e22e">Supports</span>=<span style="color:#a6e22e">shopService</span>
		}
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>,<span style="color:#a6e22e">shops</span>)
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 获取商铺列表
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopController</span>) <span style="color:#a6e22e">GetShopList</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
	<span style="color:#75715e">//获取经纬度
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">longitude</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;longitude&#34;</span>)
	<span style="color:#a6e22e">latitude</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;latitude&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;undefined&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;undefined&#34;</span> {
		<span style="color:#a6e22e">longitude</span> = <span style="color:#e6db74">&#34;116.34&#34;</span>
		<span style="color:#a6e22e">latitude</span> = <span style="color:#e6db74">&#34;40.34&#34;</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>)
	<span style="color:#a6e22e">shopService</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">ShopService</span>{}
	<span style="color:#a6e22e">shops</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shopService</span>.<span style="color:#a6e22e">ShopList</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>)
	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">shops</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>, <span style="color:#e6db74">&#34;暂未获取到商户信息&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
    <span style="color:#75715e">//遍历商户，获取到对应的services
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">shop</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">shops</span> {
		<span style="color:#a6e22e">shopServices</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shopService</span>.<span style="color:#a6e22e">GetService</span>(<span style="color:#a6e22e">shop</span>.<span style="color:#a6e22e">Id</span>)
		<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">shopServices</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
			<span style="color:#a6e22e">shop</span>.<span style="color:#a6e22e">Supports</span> = <span style="color:#66d9ef">nil</span>
		} <span style="color:#66d9ef">else</span> {
			<span style="color:#a6e22e">shop</span>.<span style="color:#a6e22e">Supports</span> = <span style="color:#a6e22e">shopServices</span>
		}
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">shops</span>)
}

</code></pre></div><p>9、在services/ShopService.go中添加根据商户id获取服务的方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * 根据商户id获取对应的服务
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ss</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopService</span>) <span style="color:#a6e22e">GetService</span>(<span style="color:#a6e22e">shopId</span> <span style="color:#66d9ef">int64</span>) []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Service</span> {
	<span style="color:#a6e22e">shopDao</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">NewShopDao</span>()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shopDao</span>.<span style="color:#a6e22e">QueryServiceByShopId</span>(<span style="color:#a6e22e">shopId</span>)
}
</code></pre></div><p>10、在dao/ShopDao.go中添加根据商户id查询数据库中对应服务的方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * 根据商户id查询对应的服务
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ShopDao</span>) <span style="color:#a6e22e">QueryServiceByShopId</span>(<span style="color:#a6e22e">shopid</span> <span style="color:#66d9ef">int64</span>) []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Service</span> {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">services</span> []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Service</span>
	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sd</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;service&#34;</span>).<span style="color:#a6e22e">Join</span>(<span style="color:#e6db74">&#34;inner&#34;</span>, <span style="color:#e6db74">&#34;shop_service&#34;</span>, <span style="color:#e6db74">&#34;service.id=shop_service.service_id and shop_service.shop_id = ?&#34;</span>, <span style="color:#a6e22e">shopid</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">services</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">services</span>
}
</code></pre></div><h2 id="商家在售食品信息展示">商家在售食品信息展示</h2>
<p>实现<code>/api/goods</code>路由</p>
<p>1、在model/Goods.go中定义数据结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">model</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Goods</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Id</span> <span style="color:#66d9ef">int64</span> <span style="color:#e6db74">`xorm:&#34;pk autoincr&#34; json:&#34;id&#34;`</span>
	<span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(12)&#34; json:&#34;name&#34;`</span>
	<span style="color:#a6e22e">Description</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(32)&#34; json:&#34;name&#34;`</span>
	<span style="color:#a6e22e">Icon</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`xorm:&#34;varchar(255)&#34; json:&#34;icon&#34;`</span>
	<span style="color:#a6e22e">SellCount</span> <span style="color:#66d9ef">int64</span> <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;sell_count&#34;`</span>
	<span style="color:#a6e22e">Price</span> <span style="color:#66d9ef">float32</span> <span style="color:#e6db74">`xorm:&#34;float&#34; json:&#34;price&#34;`</span>
	<span style="color:#a6e22e">OldPrice</span> <span style="color:#66d9ef">float32</span> <span style="color:#e6db74">`xorm:&#34;float&#34; json:&#34;old_price&#34;`</span>
	<span style="color:#a6e22e">ShopId</span> <span style="color:#66d9ef">int64</span> <span style="color:#e6db74">`xorm:&#34;int&#34; json:&#34;shop_id&#34;`</span>
}
</code></pre></div><p>2、在tools/OrmEngine.go中同步数据结构到数据库中并初始化数据</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">OrmEngine</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Orm</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">database</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Database</span>
	<span style="color:#a6e22e">conn</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">User</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Password</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;@tcp(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Port</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">DbName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?charset=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">Charset</span>
	<span style="color:#a6e22e">engine</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">xorm</span>.<span style="color:#a6e22e">NewEngine</span>(<span style="color:#e6db74">&#34;mysql&#34;</span>, <span style="color:#a6e22e">conn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">ShowSQL</span>(<span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">ShowSql</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Sync2</span>(new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SmsCode</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Member</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FoodCategory</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Shop</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Service</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">ShopService</span>),
		new(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Goods</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">orm</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Orm</span>)
	<span style="color:#a6e22e">orm</span>.<span style="color:#a6e22e">Engine</span> = <span style="color:#a6e22e">engine</span>
	<span style="color:#a6e22e">DbEngie</span> = <span style="color:#a6e22e">orm</span>

	<span style="color:#75715e">//插入初始化shop数据
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">InitShopData</span>()
	<span style="color:#75715e">//插入初始化good数据
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">InitGoodData</span>()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">orm</span>, <span style="color:#66d9ef">nil</span>
}


<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 向商品表初始化数据
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">InitGoodData</span>(){
	<span style="color:#a6e22e">goods</span><span style="color:#f92672">:=</span>[]<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Goods</span>{
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;小小鲜肉包&#34;</span>, <span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;滑蛋牛肉粥(1份)+小小鲜肉包(4只)&#34;</span>, <span style="color:#a6e22e">SellCount</span>: <span style="color:#ae81ff">14</span>, <span style="color:#a6e22e">Price</span>: <span style="color:#ae81ff">25</span>, <span style="color:#a6e22e">OldPrice</span>: <span style="color:#ae81ff">29</span>, <span style="color:#a6e22e">ShopId</span>: <span style="color:#ae81ff">1</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;滑蛋牛肉粥+小小鲜肉包&#34;</span>, <span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;滑蛋牛肉粥(1份)+小小鲜肉包(3只)&#34;</span>, <span style="color:#a6e22e">SellCount</span>: <span style="color:#ae81ff">6</span>, <span style="color:#a6e22e">Price</span>: <span style="color:#ae81ff">35</span>, <span style="color:#a6e22e">OldPrice</span>: <span style="color:#ae81ff">41</span>, <span style="color:#a6e22e">ShopId</span>: <span style="color:#ae81ff">1</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">3</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;滑蛋牛肉粥+绿甘蓝馅饼&#34;</span>, <span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;滑蛋牛肉粥(1份)+绿甘蓝馅饼(1张)&#34;</span>, <span style="color:#a6e22e">SellCount</span>: <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">Price</span>: <span style="color:#ae81ff">25</span>, <span style="color:#a6e22e">OldPrice</span>: <span style="color:#ae81ff">30</span>, <span style="color:#a6e22e">ShopId</span>: <span style="color:#ae81ff">1</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">4</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;茶香卤味蛋&#34;</span>, <span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;咸鸡蛋&#34;</span>, <span style="color:#a6e22e">SellCount</span>: <span style="color:#ae81ff">688</span>, <span style="color:#a6e22e">Price</span>: <span style="color:#ae81ff">2.5</span>, <span style="color:#a6e22e">OldPrice</span>: <span style="color:#ae81ff">3</span>, <span style="color:#a6e22e">ShopId</span>: <span style="color:#ae81ff">1</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;韭菜鸡蛋馅饼(2张)&#34;</span>, <span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;韭菜鸡蛋馅饼&#34;</span>, <span style="color:#a6e22e">SellCount</span>: <span style="color:#ae81ff">381</span>, <span style="color:#a6e22e">Price</span>: <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">OldPrice</span>: <span style="color:#ae81ff">12</span>, <span style="color:#a6e22e">ShopId</span>: <span style="color:#ae81ff">1</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">6</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;小小鲜肉包+豆浆套餐&#34;</span>, <span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;小小鲜肉包(8只)装+豆浆(1杯)&#34;</span>, <span style="color:#a6e22e">SellCount</span>: <span style="color:#ae81ff">335</span>, <span style="color:#a6e22e">Price</span>: <span style="color:#ae81ff">9.9</span>, <span style="color:#a6e22e">OldPrice</span>: <span style="color:#ae81ff">11.9</span>, <span style="color:#a6e22e">ShopId</span>: <span style="color:#ae81ff">479</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">7</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;翠香炒素饼&#34;</span>, <span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;咸鲜翠香素炒饼&#34;</span>, <span style="color:#a6e22e">SellCount</span>: <span style="color:#ae81ff">260</span>, <span style="color:#a6e22e">Price</span>: <span style="color:#ae81ff">17.9</span>, <span style="color:#a6e22e">OldPrice</span>: <span style="color:#ae81ff">20.9</span>, <span style="color:#a6e22e">ShopId</span>: <span style="color:#ae81ff">485</span>},
		{<span style="color:#a6e22e">Id</span>: <span style="color:#ae81ff">8</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;香煎鲜肉包&#34;</span>, <span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;咸鲜猪肉鲜肉包&#34;</span>, <span style="color:#a6e22e">SellCount</span>: <span style="color:#ae81ff">173</span>, <span style="color:#a6e22e">Price</span>: <span style="color:#ae81ff">10.9</span>, <span style="color:#a6e22e">OldPrice</span>: <span style="color:#ae81ff">12.9</span>, <span style="color:#a6e22e">ShopId</span>: <span style="color:#ae81ff">486</span>}}
	<span style="color:#75715e">//事务
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">session</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">DbEngie</span>.<span style="color:#a6e22e">NewSession</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#75715e">//事务操作：事务开始，执行操作(回滚),提交事务
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Begin</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">good</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">goods</span> {
		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Insert</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">good</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Rollback</span>()
			<span style="color:#66d9ef">return</span>
		}
	}
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Commit</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
}
</code></pre></div><p>3、在controller/GoodController.go中添加路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">controller</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/services&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
	<span style="color:#e6db74">&#34;strconv&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">GoodController</span> <span style="color:#66d9ef">struct</span> {

}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">gc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">GoodController</span>)<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>){
	<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/api/goods&#34;</span>,<span style="color:#a6e22e">gc</span>.<span style="color:#a6e22e">getGoods</span>)
}
<span style="color:#75715e">//获取某个商户下面包含的食品
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">gc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">GoodController</span>) <span style="color:#a6e22e">getGoods</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>){
	<span style="color:#75715e">//获取商户id
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">shopId</span>, <span style="color:#a6e22e">exist</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">GetQuery</span>(<span style="color:#e6db74">&#34;shop_id&#34;</span>)
	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">exist</span>{
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>,<span style="color:#e6db74">&#34;请求参数错误，请重试&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#75715e">//实例化一个goodService，并调用对应的service方法
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">shopId</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>,<span style="color:#e6db74">&#34;请求参数错误，请重试&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">goodService</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">services</span>.<span style="color:#a6e22e">NewGoodService</span>()
	<span style="color:#a6e22e">goods</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">goodService</span>.<span style="color:#a6e22e">GetGoods</span>(int64(<span style="color:#a6e22e">id</span>))
	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">goods</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>{
		<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Failed</span>(<span style="color:#a6e22e">c</span>,<span style="color:#e6db74">&#34;为查找到数据&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Success</span>(<span style="color:#a6e22e">c</span>,<span style="color:#a6e22e">goods</span>)
}
</code></pre></div><p>4、在service/GoodService.go中实现查询方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">services</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/dao&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/model&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">GoodService</span> <span style="color:#66d9ef">struct</span>{}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewGoodService</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">GoodService</span>{
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">GoodService</span>{}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">gs</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">GoodService</span>) <span style="color:#a6e22e">GetGoods</span>(<span style="color:#a6e22e">shop_id</span> <span style="color:#66d9ef">int64</span>) []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Goods</span>{
	<span style="color:#a6e22e">goodDao</span><span style="color:#f92672">:=</span><span style="color:#a6e22e">dao</span>.<span style="color:#a6e22e">NewGoodDao</span>()
	<span style="color:#a6e22e">goods</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">goodDao</span>.<span style="color:#a6e22e">QueryGoods</span>(<span style="color:#a6e22e">shop_id</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">goods</span>
}
</code></pre></div><p>5、在dao/GoodDao.go中实现查询数据库的方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">dao</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;CloudRestaurant/model&#34;</span>
	<span style="color:#e6db74">&#34;CloudRestaurant/tools&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">GoodDao</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#f92672">*</span><span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">Orm</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewGoodDao</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">GoodDao</span>{
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">GoodDao</span>{<span style="color:#a6e22e">tools</span>.<span style="color:#a6e22e">DbEngie</span>}
}
<span style="color:#75715e">//根据商户ID查询商户下所有的商品
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">gd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">GoodDao</span>) <span style="color:#a6e22e">QueryGoods</span>(<span style="color:#a6e22e">shop_id</span> <span style="color:#66d9ef">int64</span>)([]<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Goods</span>,<span style="color:#66d9ef">error</span>){
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">goods</span> []<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Goods</span>
	<span style="color:#a6e22e">err</span>	 <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gd</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;shop_id = ?&#34;</span>, <span style="color:#a6e22e">shop_id</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">goods</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>,<span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">goods</span>,<span style="color:#a6e22e">err</span>
}
</code></pre></div><p>6、在main.go中注册路由</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">registerRouter</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">HelloController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">MemberController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">FoodCategoryController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">ShopController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
	new(<span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">GoodController</span>).<span style="color:#a6e22e">Router</span>(<span style="color:#a6e22e">r</span>)
}
</code></pre></div><p>效果：</p>
<p>
        <img class="mx-auto" alt="image-20220308181916315" src="https://cdn.jsdelivr.net/gh/kevinbin123/pics/imgs/image-20220308181916315.png" />   
    </p>
<h2 id="代码">代码</h2>
<p><a href="https://gitee.com/kevinbin/cloud-restaurant">https://gitee.com/kevinbin/cloud-restaurant</a></p>
<h2 id="参考文献">参考文献</h2>
<blockquote>
<p>1、 gin框架案例 <a href="https://www.bilibili.com/video/BV1bp4y1x7Th?">https://www.bilibili.com/video/BV1bp4y1x7Th?</a></p>
<p>2、前端包 <a href="https://github.com/Teanix/shop_client">https://github.com/Teanix/shop_client</a></p>
<p>3、设置代理 <a href="https://www.cnblogs.com/haojile/p/13144030.html">https://www.cnblogs.com/haojile/p/13144030.html</a></p>
<p>4、验证码 <a href="https://github.com/mojocn/base64Captcha/tree/v1.2.2">https://github.com/mojocn/base64Captcha/tree/v1.2.2</a></p>
<p>5、搭建fastdfs <a href="https://www.cnblogs.com/chiangchou/p/fastdfs.html">https://www.cnblogs.com/chiangchou/p/fastdfs.html</a></p>
</blockquote>

        </div>

        


        

<div class="post-archive">
    <h2>相关文章</h2>
    <ul class="listing">
        
        <li><a href="/post/Gin%E6%A1%86%E6%9E%B6%E7%AC%94%E8%AE%B0/">Gin框架笔记</a></li>
        
        <li><a href="/post/Golang%E5%B0%8F%E6%A1%88%E4%BE%8B-%E8%8E%B7%E5%8F%96%E6%88%90%E8%AF%AD%E5%B9%B6%E6%9F%A5%E8%AF%A2/">Golang小案例 获取成语并查询</a></li>
        
        <li><a href="/post/Golang%E5%B0%8F%E6%A1%88%E4%BE%8B-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF/">Golang小案例 即时通讯</a></li>
        
        <li><a href="/post/GolangGMP/">Golang GMP学习笔记</a></li>
        
        <li><a href="/post/GolangGC/">Golang 中GC回收机制学习笔记</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/Golang' target="_blank">Golang</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    
    

</div>

                    <footer id="footer">
    <div class="container">
        &copy; 2023 <a href="https://kevinbin123.github.io/">abin の 成长之路 By abin</a>.本站博客未经授权禁止转载.
		<br>
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="http://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>
		       
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
<style type="text/css">
div.highlight {
    position: relative;
    margin: 1em 0px;
}

.copy-code {
    display: none;
    position: absolute;
    top: 4px;
    right: 4px;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(78, 78, 78, 0.8);
    border-radius: var(--radius);
    padding: 0 5px;
    font: inherit;
    user-select: none;
    cursor: pointer;
    border: 0;
    --radius: 8px;
}

div.highlight:hover .copy-code,pre:hover .copy-code {
    display: block;
}

</style>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/bootstrap.min.js'></script>

    <script src='/js/post_category.1.js'></script>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://kevinbin123.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://kevinbin123.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>

    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://kevinbin123.github.io/post/%E7%AE%80%E5%8D%95%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/" title="简单分布式系统" target="_blank">简单分布式系统</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/fyne%E6%A1%88%E4%BE%8B%E4%B9%8B%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/" title="Fyne案例之音乐播放器" target="_blank">Fyne案例之音乐播放器</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/fyne%E6%A1%88%E4%BE%8B%E4%B9%8B%E6%8E%A5%E4%BD%8F%E4%BD%A0%E5%B0%8F%E6%B8%B8%E6%88%8F/" title="Fyne案例之接住你小游戏" target="_blank">Fyne案例之接住你小游戏</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/gin&#43;vue2%E5%8D%9A%E5%AE%A2%E7%AC%94%E8%AE%B0%E5%89%8D%E7%AB%AF/" title="Gin&#43;vue2博客笔记（前端）" target="_blank">Gin&#43;vue2博客笔记（前端）</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/gin&#43;vue2%E5%8D%9A%E5%AE%A2%E7%AC%94%E8%AE%B0%E5%90%8E%E7%AB%AF/" title="Gin&#43;vue2博客笔记（后端）" target="_blank">Gin&#43;vue2博客笔记（后端）</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/PWA%E7%AC%94%E8%AE%B0/" title="PWA笔记" target="_blank">PWA笔记</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/Golang%E6%A1%88%E4%BE%8B-zinx%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Golang案例 Zinx轻量级服务器框架学习笔记" target="_blank">Golang案例 Zinx轻量级服务器框架学习笔记</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/Golang%E5%B0%8F%E6%A1%88%E4%BE%8B-%E7%88%AC%E5%8F%96%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1/" title="Golang小案例 爬取豆瓣电影" target="_blank">Golang小案例 爬取豆瓣电影</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/go-micro%E6%A1%88%E4%BE%8B/" title="Go Micro案例" target="_blank">Go Micro案例</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/go-micro%E7%AC%94%E8%AE%B0/" title="Go Micro笔记" target="_blank">Go Micro笔记</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://kevinbin123.github.io/categories/DB/">DB (2)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/Golang/">Golang (19)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/JavaScript/">JavaScript (1)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/Network/">Network (1)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/container/">container (1)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/other/">other (5)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://kevinbin123.github.io/tags/DB/">DB</a>
    
    <a href="https://kevinbin123.github.io/tags/Golang/">Golang</a>
    
    <a href="https://kevinbin123.github.io/tags/JavaScript/">JavaScript</a>
    
    <a href="https://kevinbin123.github.io/tags/Network/">Network</a>
    
    <a href="https://kevinbin123.github.io/tags/container/">container</a>
    
    <a href="https://kevinbin123.github.io/tags/other/">other</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.liwenzhou.com/" title="go语言学习之路">李文周的博客</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://kevinbin123.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>MySQL笔记 | abin の 成长之路</title>
    <meta property="og:title" content="MySQL笔记 - abin の 成长之路">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2022-02-17T00:02:17&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2022-02-17T00:02:17&#43;08:00'>
        
    <meta name="Keywords" content="golang,go语言,go语言笔记,博客,项目管理,软件架构">
    <meta name="description" content="MySQL笔记">
        
    <meta name="author" content="abin">
    <meta property="og:url" content="https://kevinbin123.github.io/post/MySQL%E7%AC%94%E8%AE%B0/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
        <link rel="stylesheet" href='/css/sidebar_menu.css'>
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://kevinbin123.github.io/">
                        abin の 成长之路
                    </a>
                
                <p class="description">冉冉升起的码神</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://kevinbin123.github.io/">首页</a>
                    
                    <a  href="https://kevinbin123.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://kevinbin123.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">MySQL笔记</h1>
        </header>
        
  <time datetime="2022-02-16T16:02:17Z" class="post-meta meta-date dt-published">
    2022年2月17日
  </time>


<div class="post-meta meta-category">
  <span>&nbsp;|</span>
  
    <a href='/categories/DB' target="_blank">DB</a>
  
</div>


        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">&nbsp;|
                <span id="busuanzi_value_page_pv"></span> <span>阅读</span>
            </span>
        </div>
        
        
        <div class="post-content">
            <h1 id="mysql学习笔记">MySQL学习笔记</h1>
<h2 id="相关概念">相关概念</h2>
<p>DB: databae，数据库，保存一组有组织的数据的容器</p>
<p>DBMS: Database Management System，数据库管理系统，又称为数据库软件（产品），用于管理DB中的数据</p>
<p>SQL: Structure Query Language，结构化查询语言，用于和DBMS通信的语言</p>
<h2 id="初始mysql">初始MySQL</h2>
<p>安装：略</p>
<p>卸载：略</p>
<p>配置：略</p>
<p>启动：<code>net start mysql</code></p>
<p>停止：<code>net stop mysql</code></p>
<p>登录：<code>mysql -h localhost -P 3306 -u root -p</code> 或者 <code>mysql -u root -p</code></p>
<p>登出：<code>exit</code> 或者 CTRL+C</p>
<h2 id="常见命令">常见命令</h2>
<p>查看当前所有的数据库：<code>show databases;</code></p>
<p>打开指定的库：<code>use 库名;</code></p>
<p>查看当前库的所有表：<code>show tables;</code></p>
<p>查看其它库的所有表：<code>show tables from 库名;</code></p>
<p>创建表：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#960050;background-color:#1e0010">表名</span>(
	<span style="color:#960050;background-color:#1e0010">列名</span> <span style="color:#960050;background-color:#1e0010">列类型</span>,
    <span style="color:#960050;background-color:#1e0010">列名</span> <span style="color:#960050;background-color:#1e0010">列类型</span>,
    ...
);
</code></pre></div><p>查看表结构：<code>desc 表名;</code></p>
<p>查看数据库版本：</p>
<p>​	未登陆到mysql服务端： <code>mysql -V</code>  或者<code>mysql --version</code></p>
<p>​	进入到数据库后用：<code>select version();</code></p>
<h2 id="dql相关">DQL相关</h2>
<p>DQL:Data Query Language 数据查询语言</p>
<p>​														执行顺序</p>
<p>select 查询列表								⑦</p>
<p>from 表1 别名									①</p>
<p>连接类型 join 表2 别名					 ②</p>
<p>on 连接条件										③</p>
<p>where 筛选条件								④</p>
<p>group by 分组列表							⑤</p>
<p>having 筛选										⑥</p>
<p>order by 排序列表							⑧</p>
<p>limit 起始条目索引,条目数;				⑨</p>
<h3 id="基础查询">基础查询</h3>
<p>基础查询：<code>select 查询列表 from 表名;</code> 查询列表可以是字段、常量值、表达式、函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#基础查询语句：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name,salary <span style="color:#66d9ef">from</span> emplyees;

<span style="color:#75715e">#查询常量：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#ae81ff">100</span>;

<span style="color:#75715e">#查询表达式：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#ae81ff">98</span><span style="color:#f92672">*</span><span style="color:#ae81ff">100</span>;

<span style="color:#75715e">#查询函数：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">VERSION</span>();

<span style="color:#75715e">#别名：
</span><span style="color:#75715e"></span>
<span style="color:#75715e">##使用as:
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">姓</span> <span style="color:#66d9ef">from</span> employees;

<span style="color:#75715e">##使用空格：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name  <span style="color:#960050;background-color:#1e0010">姓</span> <span style="color:#66d9ef">from</span> employees;

<span style="color:#75715e">#去重：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">DISTINCT</span> last_name <span style="color:#66d9ef">from</span> employees;

<span style="color:#75715e"># +号的作用：+只能作为运算符
</span><span style="color:#75715e"></span>
<span style="color:#75715e">##要拼接两个字段的错误用法：select last_name+first_name as 姓名 from employees;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">##得到运算结果:select 1+1;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">##试图将‘123’转成数值，然后继续做加法运算:select &#39;123&#39;+10;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">##试图将‘hello’转成数值，转换失败，则转成0:select &#39;hello&#39;+10;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">##其中一方为null，则结果为null:select null+10;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#concat：拼接多个字段，用法：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">CONCAT</span>(last_name,first_name) <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">姓名</span> <span style="color:#66d9ef">from</span> employees;
<span style="color:#75715e">#ifnull函数；如果某个字段或表达式是null，则返回指定的值，否则返回原本的值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">ifnull</span>(commission_pct,<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">from</span> employees;
<span style="color:#75715e"># isnull函数；判断某字段或表达式是否为null，如果是，则返回1；否则返回0
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">isnull</span>(commission_pct) <span style="color:#66d9ef">from</span> employees;
</code></pre></div><h3 id="条件查询">条件查询</h3>
<p>一、按照条件表达式筛选，条件运算符：<code>&gt;, &lt;, =, !=, &lt;&gt;, &gt;=, &lt;=</code></p>
<p>二、按照逻辑表达式筛选，逻辑运算符：<code>&amp;&amp;, ||, ！, and, or, not</code></p>
<p>三、模糊查询：<code>like, between and, in, is null</code></p>
<p>条件运算符示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> salary<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">12000</span>;
<span style="color:#66d9ef">select</span> last_name,department_id <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> department_id<span style="color:#f92672">!=</span><span style="color:#ae81ff">90</span>
</code></pre></div><p>逻辑运算符示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> last_name,salary <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> salary<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">10000</span> <span style="color:#66d9ef">AND</span> salary<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">20000</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employess <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">NOT</span>(department_id<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">90</span> <span style="color:#66d9ef">AND</span> department_id<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">110</span>) <span style="color:#66d9ef">OR</span> salary<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">15000</span>;
</code></pre></div><p>模糊查询示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-MYSQL" data-lang="MYSQL"><span style="color:#75715e"># %可以匹配任意多个字符； _ 任意单个字符
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%abc%&#39;</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;__a_e%&#39;</span>;
<span style="color:#75715e"># \为转义字符
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;_\_%&#39;</span>;
<span style="color:#75715e"># escape 声明后面的字符不作为通配符使用
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;_$_%&#39;</span> ESCAPE <span style="color:#e6db74">&#39;$&#39;</span>;
<span style="color:#75715e"># BETWEEN AND ;包含临界值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> employee_id <span style="color:#66d9ef">BETWEEN</span> <span style="color:#ae81ff">100</span> <span style="color:#66d9ef">AND</span> <span style="color:#ae81ff">120</span>;
<span style="color:#75715e"># in
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name,job_id <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> job_id <span style="color:#66d9ef">IN</span>(<span style="color:#e6db74">&#39;IT_PORT&#39;</span>,<span style="color:#e6db74">&#39;AD_VP&#39;</span>,<span style="color:#e6db74">&#39;AD_PRES&#39;</span>);
<span style="color:#75715e"># is null ; = 或 &lt;&gt; 不能用来判断null值， is null或 is not null可以用来判断null值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> commission_pct <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e"># &lt;=&gt; 安全等于 ;既可以判断null值，又可以判断普通的数值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> commission_pct <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> salary <span style="color:#f92672">&lt;=&gt;</span><span style="color:#ae81ff">12000</span>;
</code></pre></div><h3 id="排序查询">排序查询</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#desc 倒序 ；asc 正序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> salary <span style="color:#66d9ef">desc</span>;
<span style="color:#75715e"># 按照表达式排序 或者 别名排序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>,salary<span style="color:#f92672">*</span><span style="color:#ae81ff">12</span><span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#a6e22e">IFNULL</span>(commission_pct,<span style="color:#ae81ff">0</span>)) <span style="color:#960050;background-color:#1e0010">年薪</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#960050;background-color:#1e0010">年薪</span> <span style="color:#66d9ef">desc</span>;
<span style="color:#75715e"># 按照函数排序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">LENGTH</span>(last_name) <span style="color:#960050;background-color:#1e0010">字节长度</span>,last_name,salary <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#a6e22e">length</span>(last_name) <span style="color:#66d9ef">desc</span>;
<span style="color:#75715e"># 按照多个字段排序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> salary <span style="color:#66d9ef">asc</span>,employee_id <span style="color:#66d9ef">desc</span>;
</code></pre></div><h3 id="函数">函数</h3>
<p>调用：select 函数名(实参列表) [from 表]</p>
<p>分类：</p>
<p>​	单行函数：concat、length、ifnull等</p>
<p>​	分组函数：做统计使用，又称为统计函数、聚合函数、组函数</p>
<h4 id="单行函数">单行函数</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 字符函数
</span><span style="color:#75715e">## length函数：获取参数值的字节个数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">length</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>);
<span style="color:#66d9ef">show</span> VARIABLES <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%cahr%&#39;</span>;<span style="color:#960050;background-color:#1e0010">可以看字符集</span>
<span style="color:#75715e">## concat拼接函数：拼接字符串
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">concat</span>(last_name,<span style="color:#e6db74">&#39;_&#39;</span>,first_name) <span style="color:#960050;background-color:#1e0010">姓名</span> <span style="color:#66d9ef">from</span> employees;
<span style="color:#75715e">## upper、lower
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">UPPER</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>);
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">LOWER</span>(<span style="color:#e6db74">&#39;HELLO WORLD&#39;</span>);
<span style="color:#75715e">## substr、shubstring；
</span><span style="color:#75715e">## - 索引从1开始
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">SUBSTR</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>,<span style="color:#ae81ff">5</span>); <span style="color:#960050;background-color:#1e0010">结果是：</span>o world
<span style="color:#75715e">## - 截取从指定索引处开始，截取指定长度的字符
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">SUBSTR</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">5</span>);<span style="color:#960050;background-color:#1e0010">结果是</span>hello
<span style="color:#75715e">## instr 返回子串第一次出现的索引，如果找不到返回0
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">INSTR</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>,<span style="color:#e6db74">&#39;w&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">7</span>
<span style="color:#75715e">## trim 过滤前后的空格，或者指定字符
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">LENGTH</span>(<span style="color:#a6e22e">TRIM</span>(<span style="color:#e6db74">&#39;    hello    &#39;</span>));<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">5</span>
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">TRIM</span>(<span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;aaahelloaaaworldaaaaaa&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span>helloaaaworld
<span style="color:#75715e">## lpad 用指定的字符实现左填充指定的长度
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">LPAD</span>(<span style="color:#e6db74">&#39;hello&#39;</span>,<span style="color:#ae81ff">10</span>,<span style="color:#e6db74">&#39;*&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#f92672">*****</span>hello
<span style="color:#75715e">## rpad 用指定的字符实现右填充指定的长度
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">RPAD</span>(<span style="color:#e6db74">&#39;hello&#39;</span>,<span style="color:#ae81ff">13</span>,<span style="color:#e6db74">&#39;*&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span>hello<span style="color:#f92672">********</span>
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">RPAD</span>(<span style="color:#e6db74">&#39;hello&#39;</span>,<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#39;*&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span>hel
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">RPAD</span>(<span style="color:#e6db74">&#39;hello&#39;</span>,<span style="color:#ae81ff">13</span>,<span style="color:#e6db74">&#39;yes&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span>helloyesyesye
<span style="color:#75715e">## replace 替换
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">REPLACE</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>,<span style="color:#e6db74">&#39;o&#39;</span>,<span style="color:#e6db74">&#39;a&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span>hella warld


<span style="color:#75715e"># 数学函数
</span><span style="color:#75715e">##round 四舍五入
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">ROUND</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">67</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">round</span>(<span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">676785</span>,<span style="color:#ae81ff">2</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">68</span>
<span style="color:#75715e">## ceil 向上取整，返回&gt;=该参数的最小整数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">CEIL</span>(<span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">01</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">2</span>
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">CEIL</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">01</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
<span style="color:#75715e">## floor 向下取整，返回&lt;=该参数的最大整数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">FLOOR</span>(<span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">01</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">FLOOR</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">01</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
<span style="color:#75715e">## truncate 截断
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">TRUNCATE</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">8999</span>,<span style="color:#ae81ff">1</span>)<span style="color:#960050;background-color:#1e0010">；结果是</span><span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">8</span>
<span style="color:#75715e">## mod 取余
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">MOD</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">3</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">1</span>
<span style="color:#75715e">## rand 获取随机数，返回0-1之间的小数
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># 日期函数
</span><span style="color:#75715e">## now 返回当前系统日期+时间
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">NOW</span>();<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">2022</span><span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">08</span> <span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">00</span>:<span style="color:#ae81ff">18</span>
<span style="color:#75715e">## curdate 返回当前系统日期，不包含时间
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">CURDATE</span>();<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">2022</span><span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">08</span>
<span style="color:#75715e">## curetime返回当前时间，不包含日期
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">CURTIME</span>();<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">24</span>
<span style="color:#75715e">## 获取指定的部分：年、月、日、小时、分钟、秒
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">YEAR</span>(<span style="color:#a6e22e">NOW</span>()) <span style="color:#960050;background-color:#1e0010">年</span>; <span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">2022</span>
<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">YEAR</span>(<span style="color:#e6db74">&#39;2020-05-08&#39;</span>) <span style="color:#960050;background-color:#1e0010">年</span>;<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">2020</span>
<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">YEAR</span>(hiredate) <span style="color:#960050;background-color:#1e0010">年</span> <span style="color:#66d9ef">from</span> employees;
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">MONTH</span>(<span style="color:#a6e22e">NOW</span>()) <span style="color:#960050;background-color:#1e0010">月</span>; <span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">2</span>
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">MONTHNAME</span>(<span style="color:#a6e22e">NOW</span>()) <span style="color:#960050;background-color:#1e0010">月</span>;<span style="color:#960050;background-color:#1e0010">结果是</span>Februray
<span style="color:#75715e">## 其他的day、hour、minute、sencond类似
</span><span style="color:#75715e">### str_to_date 日期格式的字符转成指定格式的日期
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">str_to_date</span>(<span style="color:#a6e22e">now</span>(),<span style="color:#e6db74">&#39;%Y-%m-%d&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">2022</span><span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">08</span>
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">str_to_date</span>(<span style="color:#e6db74">&#39;4-3 1992&#39;</span>,<span style="color:#e6db74">&#39;%c-%d %Y&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">1992</span><span style="color:#f92672">-</span><span style="color:#ae81ff">04</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span>
<span style="color:#75715e">### date_formate 将日期转换成字符
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">date_format</span>(<span style="color:#a6e22e">now</span>(),<span style="color:#e6db74">&#39;%Y/%m/%d&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">2022</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span><span style="color:#f92672">/</span><span style="color:#ae81ff">08</span>
 <span style="color:#66d9ef">select</span> <span style="color:#a6e22e">date_format</span>(<span style="color:#a6e22e">now</span>(),<span style="color:#e6db74">&#39;%y/%c/%d&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">22</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">08</span>


<span style="color:#75715e"># 其他函数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">VERSION</span>();<span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">5</span>.<span style="color:#ae81ff">7</span>.<span style="color:#ae81ff">11</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DATABASE</span>();<span style="color:#960050;background-color:#1e0010">结果是</span>bookstore
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">USER</span>();<span style="color:#960050;background-color:#1e0010">结果是</span>root<span style="color:#f92672">@</span>localhost
<span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">PASSWORD</span>(<span style="color:#e6db74">&#39;hello&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是加密后的密文</span>


<span style="color:#75715e"># 流程控制函数 - if函数
</span><span style="color:#75715e">## if函数 if else的效果
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">IF</span>(<span style="color:#ae81ff">10</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">5</span>,<span style="color:#e6db74">&#39;大于&#39;</span>,<span style="color:#e6db74">&#39;小于&#39;</span>);<span style="color:#960050;background-color:#1e0010">结果是</span> <span style="color:#960050;background-color:#1e0010">小于</span>

<span style="color:#75715e"># 流程控制函数 - case结构
</span><span style="color:#75715e">## case函数，一：switch case效果
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> salary <span style="color:#960050;background-color:#1e0010">原始工资</span>,department_id,
<span style="color:#66d9ef">case</span> department_id
<span style="color:#66d9ef">when</span> <span style="color:#ae81ff">30</span> <span style="color:#66d9ef">then</span> salary<span style="color:#f92672">*</span><span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">when</span> <span style="color:#ae81ff">40</span> <span style="color:#66d9ef">then</span> salary<span style="color:#f92672">*</span><span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">2</span>
<span style="color:#66d9ef">when</span> <span style="color:#ae81ff">50</span> <span style="color:#66d9ef">then</span> salary<span style="color:#f92672">*</span><span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">3</span>
<span style="color:#66d9ef">ELSE</span> salary
END <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">新工资</span>
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">## case函数，二：多重if效果
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> salary
<span style="color:#66d9ef">case</span>
<span style="color:#66d9ef">when</span> salary<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">20000</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;A&#39;</span>
<span style="color:#66d9ef">when</span> salary<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">15000</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;B&#39;</span>
<span style="color:#66d9ef">when</span> salary<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">10000</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;C&#39;</span>
<span style="color:#66d9ef">ELSE</span> <span style="color:#e6db74">&#39;D&#39;</span>
END <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">工资级别</span>
<span style="color:#66d9ef">FROM</span> employees;

</code></pre></div><h4 id="分组函数">分组函数</h4>
<p>分类：sum 求和、avg 平均值、 max 最大值、min 最小值、count 计算个数</p>
<p>特点：</p>
<p>​	sum、avg一般用于处理数值型</p>
<p>​	max、min、count可以处理任何类型</p>
<p>​	以上分组函数都忽略null值</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 简单的使用
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">SUM</span>(salary) <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">AVG</span>(salary) <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">MIN</span>(salary) <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">MAX</span>(salary) <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">COUNT</span>(salary) <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e"># 和distinct搭配使用,实现去重
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">SUM</span>(<span style="color:#66d9ef">DISTINCT</span> salary),<span style="color:#a6e22e">SUM</span>(salary),<span style="color:#a6e22e">COUNT</span>(<span style="color:#66d9ef">DISTINCT</span> salary),<span style="color:#a6e22e">COUNT</span>(salary) <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e"># count函数的相关介绍，一般使用COUNT(*)统计行数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">COUNT</span>(salary) <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">##效率
</span><span style="color:#75715e">#MYISAM存储引擎下，COUNT(*)的效率高
</span><span style="color:#75715e">#INNODB存储引擎下，COUNT(*)和COUNT(1)的效率差不多，比COUNT(字段)要高一些
</span><span style="color:#75715e"># 和分组函数一同查询的字段要求是group by后的字段
</span><span style="color:#75715e"># DATEDIFF() 天数之差
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">DATEDIFF</span>(<span style="color:#e6db74">&#39;2022-02-11&#39;</span>,<span style="color:#e6db74">&#39;2022-02-01&#39;</span>); <span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#ae81ff">7</span>
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">DATEDIFF</span>(<span style="color:#e6db74">&#39;2022-02-11&#39;</span>,<span style="color:#e6db74">&#39;2022-03-01&#39;</span>); <span style="color:#960050;background-color:#1e0010">结果是</span><span style="color:#f92672">-</span><span style="color:#ae81ff">18</span>
</code></pre></div><h3 id="分组查询">分组查询</h3>
<p>语法：</p>
<p>SELECT 分组函数,列（要求出现在group by的后面）</p>
<p>FROM table</p>
<p>[where condition]</p>
<p>[GROUP BY 分组的列表]</p>
<p>[ORDER BY column];</p>
<p>注意：查询列表要求是分组函数和group by后出现的字段</p>
<p>特点：</p>
<p>​	一、分组查询中的筛选条件分为两类</p>
<p>​		分组前筛选：数据源在原始表，使用where关键字，写在group by前面</p>
<p>​		分组后筛选：数据源是分组后的结果集，使用having关键字，卸载group by后面</p>
<p>​		1、分组函数做条件肯定是放在having子句中</p>
<p>​		2、能用分组前筛选的，就优先考虑使用分组前筛选</p>
<p>​	二、group by子句支持单独字段分组、多个字段分组（多个字段之间用逗号隔开），也可以用表达式或者函数</p>
<p>​	三、可以添加排序，排序放在整个分组查询的最后</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 简单使用
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">MAX</span>(salary),job_id <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> job_id;

<span style="color:#75715e"># 添加分组前筛选条件：查询邮箱中包含a字符的，每个部门的平均工资
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">AVG</span>(salary),department_id <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">WHERE</span> email <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%a%&#39;</span> <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id;

<span style="color:#75715e"># 添加分组后筛选条件：
</span><span style="color:#75715e">## 查询部门员工数&gt;2
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>),department_id <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">by</span> department_id <span style="color:#66d9ef">HAVING</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">2</span>;
<span style="color:#75715e">## 查询每个工种有奖金的员工的最高工资&gt;12000的工种编号和最高工资
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> job_id,<span style="color:#a6e22e">MAX</span>(salary) <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">where</span> commission_pct <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> job_id <span style="color:#66d9ef">HAVING</span> <span style="color:#a6e22e">MAX</span>(salary)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">12000</span>;
<span style="color:#75715e">## 查询领导编号&gt;102的每个领导手下的最低工资&gt;5000的领导编号是哪个，以及其最低工资
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> manager_id,<span style="color:#a6e22e">MIN</span>(salary) <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">where</span> manager_id<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">102</span> <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> manager_id <span style="color:#66d9ef">HAVING</span> <span style="color:#a6e22e">MIN</span>(salary)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">5000</span>;

<span style="color:#75715e"># 按表达式或函数分组
</span><span style="color:#75715e">## 按员工姓名长度分组，查询每一组的员工个数，筛选员工个数&gt;5的有哪些
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>),<span style="color:#a6e22e">LENGTH</span>(last_name) <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#a6e22e">LENGTH</span>(last_name) <span style="color:#66d9ef">HAVING</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">5</span>;

<span style="color:#75715e"># 按多个字段分组
</span><span style="color:#75715e">## 查询每个部门每个工种的员工的平均工资
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">AVG</span>(salary),department_id,job_id <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id,job_id;
<span style="color:#75715e">## 查询每个部门每个工种的员工的平均工资，并按平均工资的高低显示
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">AVG</span>(salary) a ,department_id,job_id <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id,job_id <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> a <span style="color:#66d9ef">DESC</span>;
</code></pre></div><h3 id="连接查询">连接查询</h3>
<p>分类：内连接（等值连接、非等值连接、自连接）、外连接（左外连接、右外连接、全外连接）、交叉连接</p>
<p><strong>（99标准）</strong></p>
<p>语法：select 查询列表 from表1 别名 [连接类型] join 表2 别名 on 连接条件 [where 筛选条件]</p>
<p>连接类型：</p>
<p>​	内连接：inner</p>
<p>​	外连接：</p>
<p>​		左外连接：left [outer]</p>
<p>​		右外连接：right [outer]</p>
<p>​		全外连接：full [outer]</p>
<p>​	交叉连接：cross</p>
<h4 id="内连接">内连接</h4>
<h5 id="等值连接92标准">等值连接（92标准）</h5>
<p>多表等值连接的结果为多表的交集部分</p>
<p>n表连接，至少需要n-1个连接条件</p>
<p>多表的顺序没有要求</p>
<p>一般需要为表起别名，起了别名后，不能用原来的名字</p>
<p>可以搭配子句使用，比如排序、分组、筛选</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 多表查询，笛卡尔乘积：表1有m行，表2有n行，结果=m*n行；添加有效的链接条件可以避免
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> name,boyName <span style="color:#66d9ef">from</span> boys,beauty <span style="color:#66d9ef">where</span> beauty.boyfriend_id<span style="color:#f92672">=</span> boys.id;
<span style="color:#75715e"># 加分组的情况：查询每个城市的部门个数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>),city <span style="color:#66d9ef">FROM</span> departments d,locations l <span style="color:#66d9ef">where</span> d.location_id <span style="color:#f92672">=</span> l.location_id <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> city;
<span style="color:#75715e"># 三表连接
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name,department_name,city <span style="color:#66d9ef">FROM</span> employees e,departments d,locations l <span style="color:#66d9ef">where</span> e.department_id <span style="color:#f92672">=</span> d.department_id <span style="color:#66d9ef">and</span> d.location_id <span style="color:#f92672">=</span> l.location_id;
</code></pre></div><h5 id="非等值连接92标准">非等值连接（92标准）</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 非等值连接
</span><span style="color:#75715e">## 查询员工的工资和工资级别
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> salary,grade_level <span style="color:#66d9ef">FROM</span> employees e,job_grades g <span style="color:#66d9ef">where</span> salary <span style="color:#66d9ef">between</span> g.lowest_sal <span style="color:#66d9ef">and</span> g.highest_sal;
</code></pre></div><h5 id="自连接92标准">自连接（92标准）</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#自连接
</span><span style="color:#75715e">## 查询员工 和 领导
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> e.employee_id,e.last_name,m.employee_id,m.last_name <span style="color:#66d9ef">from</span> employees e,employees m <span style="color:#66d9ef">where</span> e.manager_id <span style="color:#f92672">=</span> m.employee_id;
</code></pre></div><h5 id="等值连接99标准">等值连接（99标准）</h5>
<p>特点：</p>
<p>添加排序、分组、筛选</p>
<p>inner可以省略</p>
<p>筛选条件放在where后面，连接条件放在on后面，提高分离性，便于阅读</p>
<p>99和 92标准中的等值连接效果一样</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 等值连接 查询员工名、部门名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name,department_name <span style="color:#66d9ef">from</span> employee e <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> departments d <span style="color:#66d9ef">on</span> e.department_id <span style="color:#f92672">=</span> d.department_id;
<span style="color:#75715e">## 添加分组+筛选：查询部门个数&gt;3的城市名和部门个数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> city,<span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#960050;background-color:#1e0010">部门个数</span> <span style="color:#66d9ef">from</span> departments d <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> locations l <span style="color:#66d9ef">on</span> d.location_id <span style="color:#f92672">=</span> l.locationid <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> city <span style="color:#66d9ef">having</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">3</span>;
<span style="color:#75715e">## 三表连接
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name,department_name,job_title <span style="color:#66d9ef">from</span> employees e 
<span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> departments d <span style="color:#66d9ef">on</span> e.department_id <span style="color:#f92672">=</span> d.department_id 
<span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> jobs j <span style="color:#66d9ef">on</span> e.job_id <span style="color:#f92672">=</span> j.job_id
<span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> department_name <span style="color:#66d9ef">desc</span>;
</code></pre></div><h5 id="非等值连接99标准">非等值连接（99标准）</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">## 查询员工工资级别
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> salary,grade_level <span style="color:#66d9ef">from</span> employees e <span style="color:#66d9ef">join</span> job_grades g <span style="color:#66d9ef">on</span> e.salary <span style="color:#66d9ef">between</span> g.lowest_sal <span style="color:#66d9ef">and</span> g.highest_sal;

<span style="color:#75715e">## 查询工资级别的个数&gt;20的个数，并且按照工资级别降序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>),grade_level <span style="color:#66d9ef">from</span> employees e <span style="color:#66d9ef">join</span> job_grades g 
<span style="color:#66d9ef">on</span> e.salary <span style="color:#66d9ef">between</span> g.lowest_sal <span style="color:#66d9ef">on</span> g.highest_sal
<span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> grade_level
<span style="color:#66d9ef">having</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">20</span>
<span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> grade_level <span style="color:#66d9ef">desc</span>;
</code></pre></div><h5 id="自连接99标准">自连接（99标准）</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#自连接 查询员工的名字，上级的名字
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> e.last_name,e.employe_id,m.last_name,m.employe_id
<span style="color:#66d9ef">from</span> employees e
<span style="color:#66d9ef">join</span> employees m
<span style="color:#66d9ef">on</span> e.manager_id <span style="color:#f92672">=</span> m.employe_id;
</code></pre></div><h4 id="外连接">外连接</h4>
<p>应用场景：用于查询一个表中有，另一个表中没有的记录</p>
<p>特点：</p>
<p>1、外连接的查询结果为主表中的所有记录</p>
<p>​	如果从表中有和它匹配的，则显示匹配的值</p>
<p>​	如果从表中没有和它匹配的，则显示null</p>
<p>​	外连接查询结果=内连接结果+主表中有而从表中没有的记录</p>
<p>2、左外连接，left join左边的是主表；右外连接，right join 右边的是主表</p>
<p>3、左外和右外交换两个表的顺序，可以实现同样的效果</p>
<p>4、全外连接=内连接的结果+表1中有但表2没有+表2中有但表1没有</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 示例
</span><span style="color:#75715e">## 左外：查询没有男朋友的女生名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> b.name <span style="color:#66d9ef">from</span> beauty b <span style="color:#66d9ef">left</span> <span style="color:#66d9ef">join</span> boys bo <span style="color:#66d9ef">on</span> b.boyfriend_id <span style="color:#f92672">=</span> bo.id <span style="color:#66d9ef">where</span> bo.id <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">## 右外：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> b.name <span style="color:#66d9ef">from</span> boys bo <span style="color:#66d9ef">right</span> <span style="color:#66d9ef">join</span> beauty b <span style="color:#66d9ef">on</span> bo.id <span style="color:#f92672">=</span> b.boyfriend_id <span style="color:#66d9ef">where</span> bo.id <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">null</span>;
<span style="color:#75715e">## 全外：
</span><span style="color:#75715e"></span>mysql不支持<span style="color:#960050;background-color:#1e0010">，需要用</span>union等方式实现<span style="color:#960050;background-color:#1e0010">。</span>
</code></pre></div><h4 id="交叉连接">交叉连接</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">## 相当于笛卡尔乘积
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> b.<span style="color:#f92672">*</span>,bo.<span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> beauty b <span style="color:#66d9ef">cross</span> <span style="color:#66d9ef">join</span> boys bo;
</code></pre></div><h3 id="子查询">子查询</h3>
<p>出现在其他语句内部的select语句，称为子查询；外部的查询，称为外查询或主查询</p>
<p>分类：</p>
<p>按子查询出现的位置：</p>
<p>​	select后面：仅仅支持标量子查询</p>
<p>​	from后面：支持表子查询</p>
<p>​	where或having后面：标量子查询、列子查询、行子查询</p>
<p>​	exists后面（相关子查询）：表子查询</p>
<p>按结果集的行列数不同：</p>
<p>​	标量子查询（结果集只有一行一列）</p>
<p>​	列子查询（结果集只有一列多行）</p>
<p>​	行子查询（结果集有一行多列）</p>
<p>​	表子查询（结果集一般为多行多列）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># where或having后面
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">1、标量子查询（单行子查询）
</span><span style="color:#75715e">2、列子查询（多行子查询）
</span><span style="color:#75715e">3、行子查询（多列多行）
</span><span style="color:#75715e">特点：
</span><span style="color:#75715e">1、子查询放在小括号内
</span><span style="color:#75715e">2、子查询一般放在条件的右侧
</span><span style="color:#75715e">3、标量子查询，一般搭配着单行操作符使用：&gt; &lt; &gt;= &lt;= = &lt;&gt;
</span><span style="color:#75715e">	列子查询，一般搭配着多行操作符使用in,any/some、all
</span><span style="color:#75715e">4、子查询的执行优先于主查询
</span><span style="color:#75715e">*/</span>
<span style="color:#75715e">#1、标量子查询：查询谁的工资比Abel高
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> salary <span style="color:#f92672">&gt;</span>(
	<span style="color:#66d9ef">select</span> salary <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> last_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Abel&#39;</span>
);
<span style="color:#75715e">## 查询最低工资大于50号部门最低工资的部门id和其最低工资
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> department_id,<span style="color:#a6e22e">min</span>(salary) <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> department_id 
<span style="color:#66d9ef">having</span> <span style="color:#a6e22e">min</span>(salary) <span style="color:#f92672">&gt;</span>(
	<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">min</span>(salary) <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> department_id<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>
);

<span style="color:#75715e">#2、列子查询
</span><span style="color:#75715e">## 返回location_id是1400或1700的部门中的所有员工姓名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> department_id <span style="color:#66d9ef">in</span>(
	<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">distinct</span> department_id <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> location_id <span style="color:#66d9ef">in</span>(<span style="color:#ae81ff">1400</span>,<span style="color:#ae81ff">1700</span>)
);

<span style="color:#75715e">## 返回其他工种中比job_id为‘IT_PROG’工种任一工资低的员工的员工号、姓名、job_id以及salary
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name,employee_id,job_id,salary <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> salary <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">any</span>(
	<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">distinct</span> salary <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> job_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;IT_PROG&#39;</span>
) <span style="color:#66d9ef">and</span> job_id <span style="color:#f92672">&lt;&gt;</span> <span style="color:#e6db74">&#39;IT_PROG&#39;</span>;
<span style="color:#75715e">#或者用max替代
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> last_name,employee_id,job_id,salary <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> salary <span style="color:#f92672">&lt;</span> (
	<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">max</span>(salary) <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> job_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;IT_PROG&#39;</span>
) <span style="color:#66d9ef">and</span> job_id <span style="color:#f92672">&lt;&gt;</span> <span style="color:#e6db74">&#39;IT_PROG&#39;</span>;

<span style="color:#75715e">#3、列子查询（结果集一行多列或多行多列）
</span><span style="color:#75715e">## 查询员工编号最小并且工资最高的员工信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> (employee_id,salary)<span style="color:#f92672">=</span>(
	<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">min</span>(employee_id),<span style="color:#a6e22e">max</span>(salary) <span style="color:#66d9ef">from</span> employees
);
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 放在select后面 -- 仅仅支持标量子查询
</span><span style="color:#75715e">## 查询每个部门的员工个数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> d.<span style="color:#f92672">*</span>,(
	<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> employees e <span style="color:#66d9ef">where</span> e.department_id <span style="color:#f92672">=</span> d.department_id
) <span style="color:#960050;background-color:#1e0010">个数</span> <span style="color:#66d9ef">from</span> departments d;
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># from 后面
</span><span style="color:#75715e">## 将子查询的结果充当一张表，要求必须起别名
</span><span style="color:#75715e">## 查询每个部门的平均工资
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> ag_dep.<span style="color:#f92672">*</span>,g.grade_level
<span style="color:#66d9ef">from</span> (
	<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">avg</span>(salary) ag,department_id <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> department_id
) ag_dep 
<span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> job_grades g
<span style="color:#66d9ef">on</span> ag_dep.ag <span style="color:#66d9ef">between</span> g.lowest_sal <span style="color:#66d9ef">and</span> g.highest_sal;
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-MYSQL" data-lang="MYSQL"><span style="color:#75715e">#放在exists后面（相关子查询）
</span><span style="color:#75715e">## exists(完整的查询语句)，结果0或1
</span><span style="color:#75715e">## 查询有员工的部门名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> department_name <span style="color:#66d9ef">from</span> departments d <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">exists</span>(
	<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees e <span style="color:#66d9ef">where</span> d.department_id<span style="color:#f92672">=</span>e.department_id
);
</code></pre></div><h3 id="分页查询">分页查询</h3>
<p>limit语句放在最后，执行上也是最后执行</p>
<p>公式：</p>
<p>​	要显示的页数page,每页的条目数size</p>
<p>​	select 查询列表 from 表 limit (page-1)*size,size;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#limt [offset,]size; offset开始索引，size要显示的条目数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">5</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">5</span>;
<span style="color:#75715e">## 从第11条到25条数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">15</span>;

</code></pre></div><h3 id="联合查询-union">联合查询 union</h3>
<p>union合并，将多个查询结果合并成一个结果</p>
<p>查询结果来自多个表，且多个表没有直接的链接关系，但查询的信息一致时，可以显示</p>
<p>特点：</p>
<p>​	1、要求显示的列的个数一致</p>
<p>​	2、要求多条查询每一列的类型和顺序最好一致</p>
<p>​	3、union关键字默认去重，如果使用union all可以包含重复项</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#查询部门编号&gt;90 或 邮箱包含a的员工信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees <span style="color:#66d9ef">where</span> email <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%a%&#39;</span>
<span style="color:#66d9ef">union</span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employees wehre department_id<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">90</span>;
</code></pre></div><h2 id="dml相关">DML相关</h2>
<p>数据操作语言（Data Manipulation Language）</p>
<p>插入：insert、修改：update、删除：delete</p>
<h3 id="insert">insert</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># insert 
</span><span style="color:#75715e">## 方式一 列数和值的个数必须一致；可以省略列名，默认就是所有列
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">beauty</span>(id,name,sex,borndate,phone,boyfriend_id) <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">13</span>,<span style="color:#e6db74">&#39;Katherine&#39;</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;1990-01-01&#39;</span>,<span style="color:#e6db74">&#39;18630181181&#39;</span>,<span style="color:#66d9ef">NULL</span>,<span style="color:#ae81ff">12</span>);
<span style="color:#75715e">## 方式二 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> beauty <span style="color:#66d9ef">set</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">19</span>,name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;siri&#39;</span>,phone<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;110&#39;</span>;

<span style="color:#75715e">## 方式一和方式二比较
</span><span style="color:#75715e">##方式一可以插入多行,方式二不支持
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> beauty <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">13</span>,<span style="color:#e6db74">&#39;Katherine&#39;</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;1990-01-01&#39;</span>,<span style="color:#e6db74">&#39;18630181181&#39;</span>,<span style="color:#66d9ef">NULL</span>,<span style="color:#ae81ff">12</span>),(<span style="color:#ae81ff">14</span>,<span style="color:#e6db74">&#39;Katherine&#39;</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;1990-01-01&#39;</span>,<span style="color:#e6db74">&#39;18630181181&#39;</span>,<span style="color:#66d9ef">NULL</span>,<span style="color:#ae81ff">12</span>),(<span style="color:#ae81ff">15</span>,<span style="color:#e6db74">&#39;Katherine&#39;</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;1990-01-01&#39;</span>,<span style="color:#e6db74">&#39;18630181181&#39;</span>,<span style="color:#66d9ef">NULL</span>,<span style="color:#ae81ff">12</span>);

<span style="color:#75715e">##方式一支持子查询，方式二不支持
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">beauty</span>(id,name,phone) <span style="color:#66d9ef">select</span> id<span style="color:#960050;background-color:#1e0010">，</span>boyname, <span style="color:#e6db74">&#39;130110&#39;</span> <span style="color:#66d9ef">from</span> boys <span style="color:#66d9ef">where</span> id<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span>;
<span style="color:#75715e">## 或者
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">beauty</span>(id,name,phone) 
<span style="color:#66d9ef">select</span> id<span style="color:#960050;background-color:#1e0010">，</span>boyname, <span style="color:#e6db74">&#39;130110&#39;</span> <span style="color:#66d9ef">from</span> boys <span style="color:#66d9ef">where</span> id<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span> <span style="color:#66d9ef">union</span>
<span style="color:#66d9ef">select</span> id<span style="color:#960050;background-color:#1e0010">，</span>boyname, <span style="color:#e6db74">&#39;130110&#39;</span> <span style="color:#66d9ef">from</span> boys <span style="color:#66d9ef">where</span> id<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">8</span>;


</code></pre></div><h3 id="update">update</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># update
</span><span style="color:#75715e">## 修改单表记录
</span><span style="color:#75715e"></span><span style="color:#66d9ef">update</span> beauty <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;siri&#39;</span>,phone<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;156236&#39;</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>;
<span style="color:#75715e">## 修改多表的记录
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">## sql92语法：
</span><span style="color:#75715e">update 表1 别名,表2 别名
</span><span style="color:#75715e">set 列=值,...
</span><span style="color:#75715e">where 连接条件
</span><span style="color:#75715e">and 筛选条件；
</span><span style="color:#75715e">## sql99语法：
</span><span style="color:#75715e">update 表1 别名
</span><span style="color:#75715e">inner|left|right join 表2 别名
</span><span style="color:#75715e">on 连接条件
</span><span style="color:#75715e">set 列=值,...
</span><span style="color:#75715e">where 筛选条件;
</span><span style="color:#75715e">*/</span>
<span style="color:#75715e">## 修改张无忌的女朋友的手机号为114
</span><span style="color:#75715e"></span><span style="color:#66d9ef">update</span> boys bo
<span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> beauty b <span style="color:#66d9ef">on</span> bo.id<span style="color:#f92672">=</span>b.boyfriend_id
<span style="color:#66d9ef">set</span> b.phone<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;114&#39;</span> <span style="color:#66d9ef">where</span> bo.boyName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;张无忌&#39;</span>;

</code></pre></div><h3 id="delete">delete</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#delete 删除语句
</span><span style="color:#75715e">#方式一：delete
</span><span style="color:#75715e">## 单表删除：delete from 表 where 筛选条件
</span><span style="color:#75715e">## 删除手机号以9结尾的女神信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> beauty <span style="color:#66d9ef">where</span> phone <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%9&#39;</span>;
<span style="color:#75715e">## 多表的删除
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">92语法：
</span><span style="color:#75715e">delete 表1的别名，表2的别名
</span><span style="color:#75715e">from 表1 别名, 表2 别名
</span><span style="color:#75715e">where 连接条件
</span><span style="color:#75715e">and 筛选条件
</span><span style="color:#75715e">
</span><span style="color:#75715e">99语法：
</span><span style="color:#75715e">delete 表1的别名，表2的别名
</span><span style="color:#75715e">from 表1 别名
</span><span style="color:#75715e">inner|left|right join 表2 别名 on 连接条件
</span><span style="color:#75715e">where 筛选条件;
</span><span style="color:#75715e">*/</span>
<span style="color:#75715e">## 删除张无忌的女朋友的信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">delete</span> b
<span style="color:#66d9ef">from</span> beauty b
<span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> boys bo <span style="color:#66d9ef">on</span> b.boyfriend_id <span style="color:#f92672">=</span> bo.id
<span style="color:#66d9ef">where</span> bo.boyName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;张无忌&#39;</span>;
<span style="color:#75715e">## 删除法外狂徒张三的信息以及他女朋友的信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">delete</span> b,bo
<span style="color:#66d9ef">from</span> beauty b
<span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> boys bo <span style="color:#66d9ef">on</span> b.boyfriend_id <span style="color:#f92672">=</span> bo.id
<span style="color:#66d9ef">where</span> bo.boyName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;张三&#39;</span>;
<span style="color:#75715e">#方式二：truncate 语法：truncate table 表名;
</span><span style="color:#75715e"></span>truncate <span style="color:#66d9ef">table</span> boys;
<span style="color:#75715e">##truncate 和 delete比较
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">、</span>delete可以加where条件<span style="color:#960050;background-color:#1e0010">，</span>truncate不能加
<span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">、加入删除的标有自增长列</span>
<span style="color:#960050;background-color:#1e0010">用</span>delete删除后<span style="color:#960050;background-color:#1e0010">，在插入数据，自增长列的值从断点开始，</span>
<span style="color:#960050;background-color:#1e0010">用</span>truncate删除后<span style="color:#960050;background-color:#1e0010">，再插入数据，自增长列的值从</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">开始。</span>
<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">、</span>truncate删除的效率比delete略高一些
<span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">、</span>truncate删除没有返回值<span style="color:#960050;background-color:#1e0010">，</span>delete删除有返回值
<span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">、</span>truncate删除不能回滚<span style="color:#960050;background-color:#1e0010">，</span>delete删除可以回滚
</code></pre></div><h2 id="ddl相关">DDL相关</h2>
<p>数据定义语言(Date Definition Language)</p>
<p>库的管理：创建、修改、删除</p>
<p>表的管理：创建、修改、删除</p>
<p>创建（CREATE）、修改(ALTER)、删除（DROP）</p>
<h3 id="库的管理">库的管理</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#库的管理
</span><span style="color:#75715e">##语法：create database [if not exists]库名;
</span><span style="color:#75715e">## 创建books库
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> books;
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">exists</span> books;

<span style="color:#75715e">#库的修改
</span><span style="color:#75715e">#语法：rename database 库名 to 新库名;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">rename</span> <span style="color:#66d9ef">database</span> books <span style="color:#66d9ef">to</span> book_store;
<span style="color:#75715e">#修改库的字符集
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">database</span> books <span style="color:#66d9ef">character</span> <span style="color:#66d9ef">set</span> gbk;

<span style="color:#75715e">#库的删除
</span><span style="color:#75715e"></span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">database</span> books;
<span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">database</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> books;


</code></pre></div><h3 id="表的管理">表的管理</h3>
<h4 id="create">create</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#create 表的创建
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">create table 表名(
</span><span style="color:#75715e">	列名 列的类型[(长度) 约束],
</span><span style="color:#75715e">	列名 列的类型[(长度) 约束]
</span><span style="color:#75715e">)
</span><span style="color:#75715e">*/</span>
<span style="color:#75715e">#创建book表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">book</span>(
	id <span style="color:#66d9ef">INT</span>,
    bName <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">20</span>),
    price <span style="color:#66d9ef">DOUBLE</span>,
    authorId <span style="color:#66d9ef">INT</span>,
    publishDate <span style="color:#66d9ef">DATETIME</span>
);
</code></pre></div><h4 id="alter">alter</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#表的修改
</span><span style="color:#75715e">## 语法 alter table 表名 add|drop|modify|change colunmn 列名 [列类型 约束];
</span><span style="color:#75715e">## 修改列名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> book <span style="color:#66d9ef">change</span> <span style="color:#66d9ef">column</span> publishDate pubDate <span style="color:#66d9ef">DATETIME</span>;
<span style="color:#75715e">## 修改类型或约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> book modify <span style="color:#66d9ef">column</span> pubdate <span style="color:#66d9ef">TIMESTAMP</span>;
<span style="color:#75715e">## 添加新列
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> author <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">column</span> annual <span style="color:#66d9ef">double</span> ;
<span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> author <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">column</span> annual2 <span style="color:#66d9ef">double</span> first;
<span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> author <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">column</span> annual3 <span style="color:#66d9ef">double</span> after pubdate;
<span style="color:#75715e">##删除列
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> author <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">column</span> annual;
<span style="color:#75715e">##修改表名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> author <span style="color:#66d9ef">rename</span> <span style="color:#66d9ef">to</span> book_author
</code></pre></div><h4 id="drop">drop</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#表的删除
</span><span style="color:#75715e"></span><span style="color:#66d9ef">Drop</span> <span style="color:#66d9ef">table</span> author;
<span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> author;
</code></pre></div><p>通用的写法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">Drop</span> <span style="color:#66d9ef">database</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> <span style="color:#960050;background-color:#1e0010">旧库名</span>;
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> <span style="color:#960050;background-color:#1e0010">新库名</span>;

<span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> <span style="color:#960050;background-color:#1e0010">旧表名</span>;
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#960050;background-color:#1e0010">表名</span>();

</code></pre></div><p>表的复制</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">## 仅仅复制表的结构
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> copy <span style="color:#66d9ef">like</span> author;

<span style="color:#75715e">## 复制表的数据+结构
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> copy2
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> author;

<span style="color:#75715e">## 复制表的部分数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> copy3
<span style="color:#66d9ef">select</span> id,au_name <span style="color:#66d9ef">from</span> author <span style="color:#66d9ef">where</span> nation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;中国&#39;</span>;

<span style="color:#75715e">## 仅仅复制表的部分结构
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> copy4
<span style="color:#66d9ef">select</span> id,au_name <span style="color:#66d9ef">from</span> author <span style="color:#66d9ef">where</span> <span style="color:#ae81ff">0</span>;
</code></pre></div><h3 id="类型介绍">类型介绍</h3>
<p>常见的数据类型：</p>
<p>数值型：整型、小数（定点数、浮点数）</p>
<p>字符型：较短的文本（char、varchar），较长的文本（text、blob）</p>
<p>日期型</p>
<p>/<em>原则：所选择的类型越简单越好，能保存数值得类型越小越好</em>/</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 整型
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">分类：
</span><span style="color:#75715e">tinyint、smallint、mediumint、int/integer、bigint
</span><span style="color:#75715e">1		2			3			4			8
</span><span style="color:#75715e">特点：
</span><span style="color:#75715e">1、如果不设置符号，默认是有符号，如果想设置无符号，需要添加关键字unsigned
</span><span style="color:#75715e">2、如果插入的数值超过整型的范围，会报out of range异常，并插入临界值
</span><span style="color:#75715e">3、如果不设置长度，会有默认的长度
</span><span style="color:#75715e">长度代表了显示的最大宽度，如果不够会用0在左边填充，但必须搭配zerofill使用
</span><span style="color:#75715e">*/</span>
<span style="color:#75715e">#设置有符号、无符号
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">tab_int</span>(
	t1 <span style="color:#66d9ef">int</span>,
    t2 <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">unsigned</span>,
    t3 <span style="color:#66d9ef">int</span>(<span style="color:#ae81ff">7</span>) <span style="color:#66d9ef">zerofill</span>
)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#小数
</span><span style="color:#75715e"></span><span style="color:#75715e">/*分类
</span><span style="color:#75715e">1、浮点型 float(M,D) 4字节  DOUBLE(M,D)	8字节
</span><span style="color:#75715e">2、定点型 dec(M,D) decimal(M,D)
</span><span style="color:#75715e">特点：
</span><span style="color:#75715e">1、
</span><span style="color:#75715e">M表示整数部位+小数部位
</span><span style="color:#75715e">D表示小数部位
</span><span style="color:#75715e">如果超过范围插入临界值
</span><span style="color:#75715e">2、
</span><span style="color:#75715e">M和D都可以省略
</span><span style="color:#75715e">如果是decimal，则M默认为10，D默认为0
</span><span style="color:#75715e">如果是float和double，则会根据插入的值得精度来决定精度
</span><span style="color:#75715e">3、定点型的精度较高，如果要求插入的数值精度较高，如货币运算等则考虑使用
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">tab_float</span>(
	f1 <span style="color:#66d9ef">float</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>),
    f2 <span style="color:#66d9ef">double</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>),
    f3 <span style="color:#66d9ef">decimal</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>)
)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#字符型
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">char、varchar、binary、varbinary、enum、set、text、blob
</span><span style="color:#75715e">较短的文本：char、varchar
</span><span style="color:#75715e">
</span><span style="color:#75715e">特点：
</span><span style="color:#75715e">char:写法为char(M),M的意思是最大的字符数，可以省略，默认为1；固定长度的字符，比较耗费空间，效率高
</span><span style="color:#75715e">varchar:写法为varchar(M)，M不可以省略;可变长度的字符;比较节省空间，效率低
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">tab_char</span>(
	c1 <span style="color:#66d9ef">ENUM</span>(<span style="color:#e6db74">&#39;A&#39;</span>,<span style="color:#e6db74">&#39;B&#39;</span>,<span style="color:#e6db74">&#39;C&#39;</span>), <span style="color:#75715e"># 枚举，插入的时候只能选一个值
</span><span style="color:#75715e"></span>    s1 <span style="color:#66d9ef">SET</span>(<span style="color:#e6db74">&#39;A&#39;</span>,<span style="color:#e6db74">&#39;B&#39;</span>,<span style="color:#e6db74">&#39;C&#39;</span>)   <span style="color:#75715e"># 集合,插入的时候可以选个值
</span><span style="color:#75715e"></span>)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#日期型
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">分类：
</span><span style="color:#75715e">date		只保存日期
</span><span style="color:#75715e">time		只保存时间
</span><span style="color:#75715e">year		只保存年
</span><span style="color:#75715e">datetime	保存日期+时间
</span><span style="color:#75715e">timestamp	保存日期+时间
</span><span style="color:#75715e">
</span><span style="color:#75715e">特点
</span><span style="color:#75715e">			字节		范围		时区的影响
</span><span style="color:#75715e">datetime	8		1000-9999	不受
</span><span style="color:#75715e">timestamp	4		1970-2038	受
</span><span style="color:#75715e">*/</span>

<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">tab_date</span>(
	t1 <span style="color:#66d9ef">datetime</span>,
    t2 <span style="color:#66d9ef">timestamp</span>
)
</code></pre></div><h3 id="常见约束">常见约束</h3>
<p>含义：一种限制，用于限制表中的数据，保证表的数据的准确和可靠性</p>
<p><strong>分类：六大约束</strong></p>
<p>​	NOT NULL：非空，保证值不为空</p>
<p>​	DEFAULT:	默认，保证有默认值</p>
<p>​	PRIMARY KEY:	主键，具有唯一性，并且非空</p>
<p>​	UNIQUE:	唯一，具有唯一性，可以为空</p>
<p>​	CHECK:	检查约束【mysql中不支持】</p>
<p>​	FOREIGN KEY: 	外键，用于限制两个表的关系，用于保证该字段的值必须来自于主表的关联列的值；在从表中添加外键约束，用于引用主表中某列的值；</p>
<p>添加约束的时机：</p>
<p>​	1、创建表时</p>
<p>​	2、修改表时</p>
<p><strong>约束添加的分类</strong>：</p>
<p>​	列级约束：六大约束语法上都支持，但外键约束没有效果</p>
<p>​	表级约束：除了非空、默认，其他的都支持</p>
<p><strong>主键和唯一的对比</strong>：</p>
<p>​	主键：保证唯一性，不允许为空，一个表中最多有一个，允许组合但不推荐</p>
<p>​	唯一：保证唯一性，允许为空，一个表中可以有多个，允许组合但不推荐</p>
<p><strong>外键：</strong></p>
<p>​	1、要求在从表设置外键关系</p>
<p>​	2、从表的外键列的类型和 主表 的关联列的类型要求一致或兼容，名称无要求</p>
<p>​	3、主表的关联列必须是一个key(一般是主键或唯一)</p>
<p>​	4、插入数据时，先插入主表，再插入从表</p>
<p>​	5、删除数据时，先删除从表，再删除主表</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 语法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#960050;background-color:#1e0010">表名</span>(
	<span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#960050;background-color:#1e0010">字段类型</span> <span style="color:#960050;background-color:#1e0010">列级约束</span>,
    <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#960050;background-color:#1e0010">字段类型</span>,
    <span style="color:#960050;background-color:#1e0010">表级约束</span>
)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 创建表时添加约束
</span><span style="color:#75715e">## 1、添加列级约束：只支持默认、非空、主键、唯一（其他两个在mysql不支持）
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> tabloe <span style="color:#a6e22e">stuinfo</span>(
	id <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
    stuName <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span><span style="color:#960050;background-color:#1e0010">，</span>
    gender <span style="color:#66d9ef">CHAR</span>(<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">CHECK</span>(gender<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;男&#39;</span> <span style="color:#66d9ef">or</span> gender<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;女&#39;</span>),
    seat <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">UNIQUE</span>,
    age <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">18</span>,
    marjorId <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">REFERENCES</span> <span style="color:#a6e22e">major</span>(id)
)
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">major</span>(
	id <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
    majorName <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">20</span>)
)

<span style="color:#75715e">## 2、添加表级约束
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">[constraint 约束名] 约束类型(字段名)
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">stuinfo</span>(
	id <span style="color:#66d9ef">INT</span>,
    stuname <span style="color:#a6e22e">CARCHAR</span>(<span style="color:#ae81ff">20</span>)<span style="color:#960050;background-color:#1e0010">，</span>
    gender <span style="color:#66d9ef">CHAR</span>(<span style="color:#ae81ff">1</span>),
    seat <span style="color:#66d9ef">INT</span>,
    age <span style="color:#66d9ef">INT</span>,
    majorid <span style="color:#66d9ef">INT</span>,
    
    <span style="color:#66d9ef">CONSTRAINT</span> pk <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(id),
    <span style="color:#66d9ef">constraint</span> uq <span style="color:#66d9ef">UNIQUE</span>(seat),
    <span style="color:#66d9ef">constraint</span> ck <span style="color:#66d9ef">CHECK</span>(gender<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;男&#39;</span> <span style="color:#66d9ef">or</span> gender<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;女&#39;</span>),
    <span style="color:#66d9ef">constraint</span> fk_stuinfo_major <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(majorid) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">major</span>(id)
)

<span style="color:#75715e">## 一般通用的写法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">stuinfo</span>(
	id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
    stuname <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
    gender <span style="color:#66d9ef">char</span>(<span style="color:#ae81ff">1</span>),
    seat <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">unique</span>,
    age <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">default</span> <span style="color:#ae81ff">18</span>,
    majorid <span style="color:#66d9ef">int</span>,
    <span style="color:#66d9ef">constraint</span> fk_stuinfo_major <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(majorid) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">major</span>(id)
)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 修改表时添加约束
</span><span style="color:#75715e">## 1、添加非空约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo modify <span style="color:#66d9ef">column</span> stuname <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>;

<span style="color:#75715e">## 2、添加默认约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo modify <span style="color:#66d9ef">column</span> age <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">default</span> <span style="color:#ae81ff">18</span>;

<span style="color:#75715e">## 3、添加主键
</span><span style="color:#75715e">## 3.1 列级约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo modify <span style="color:#66d9ef">column</span> id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>;
<span style="color:#75715e">## 3.2 表级约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>(id);

<span style="color:#75715e">## 4、添加唯一
</span><span style="color:#75715e">## 4.1 列级约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo modify <span style="color:#66d9ef">column</span> seat <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">unique</span>;
<span style="color:#75715e">## 4.2 表级约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">unique</span>(seat);

<span style="color:#75715e"># 5、添加外键(正常是先删从表，再删主表)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo <span style="color:#66d9ef">add</span>  <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(majorid) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">major</span>(id);
<span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> fk_stuinfo_major <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(majorid) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">major</span>(id);
<span style="color:#75715e">## 添加外键时候，设置级联删除(on delte cascade)，这样主表删除后，从表的数据也会一起删除
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuino <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> fk_stu_major <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(majorid) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">major</span>(id) <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">cascade</span>;
<span style="color:#75715e">## 添加外键时候，设置级联置空(on delte set null)，这样主表删除后，从表的数据引用的数据会为null
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuino <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> fk_stu_major <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(majorid) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">major</span>(id) <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">null</span>;
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 修改表时删除约束
</span><span style="color:#75715e"># 1、删除非空约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo modify <span style="color:#66d9ef">column</span> stuname <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">null</span>;

<span style="color:#75715e"># 2、删除默认约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo modify <span style="color:#66d9ef">column</span> age <span style="color:#66d9ef">int</span>;

<span style="color:#75715e"># 3、删除主键
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>;

<span style="color:#75715e"># 4、删除唯一
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">index</span> seat;

<span style="color:#75715e"># 5、删除外键
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> majorid;
<span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> stuinfo <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> fk_stuinfo_major;
</code></pre></div><table>
<thead>
<tr>
<th></th>
<th>位置</th>
<th>支持的约束类型</th>
<th>是否可以起约束名</th>
</tr>
</thead>
<tbody>
<tr>
<td>列级约束</td>
<td>列的后面</td>
<td>语法都支持，但外键没有效果</td>
<td>不可以</td>
</tr>
<tr>
<td>表级约束</td>
<td>所有列的下面</td>
<td>默认和非空不支持，其他支持</td>
<td>可以（主键没有效果）</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 标识列 auto_increment
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">show variables like &#39;%auto_increment%&#39;;可以查看
</span><span style="color:#75715e">特点：
</span><span style="color:#75715e">	1、标识列必须和一个key搭配（主键或唯一）
</span><span style="color:#75715e">	2、一个表最多一个标识列
</span><span style="color:#75715e">	3、标识列的类型只能是数值型
</span><span style="color:#75715e">	4、标识列可以通过set auto_increment_increment=3；设置步长，可以通过手动插入值，设置起始值
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">tab_identity</span>(
	id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>,
    name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>)
)

<span style="color:#75715e">## 修改表时设置标识列
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> tab_identity modify <span style="color:#66d9ef">column</span> id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>;

<span style="color:#75715e">## 修改表时删除标识列
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> tab_identity modify <span style="color:#66d9ef">column</span> id <span style="color:#66d9ef">int</span>;
</code></pre></div><h2 id="tcl相关">TCL相关</h2>
<p>事务控制语言Transaction Control Language</p>
<p>一个或一组sql语句组成一个执行单元，这个执行单元要么全部执行，要么全部不执行</p>
<p>innode存储引擎支持事务，myisam和memory不支持事务</p>
<p>show engines;可以查看mysql支持的存储引擎</p>
<p><strong>事务的ACID属性</strong></p>
<p>​	1、原子性（Atomicity）：事务是一个而不可分割的工作单位</p>
<p>​	2、一致性（Consistency）：从一个一致性状态变换成另一个一致性状态</p>
<p>​	3、隔离性（Isolation）：事务的执行不能被其他事物干扰，并发执行的事务之间不能互相干扰</p>
<p>​	4、持久性（Durability）: 事务一旦被提交，对数据库的改变是持久性的</p>
<p>show variables like &lsquo;%autocommit%&rsquo; 查看自动提交是否开启</p>
<h3 id="事务使用">事务使用</h3>
<p>显式事务：具有明显的开始和结束的标记；前提是需要先设置自动提交功能为禁用</p>
<p>步骤1：开启事务</p>
<p>set autocommit=0;</p>
<p>start transaction;可选的</p>
<p>步骤2：编写事务中的sql语句（select insert update delete）</p>
<p>语句1；语句2;&hellip;</p>
<p>步骤3：结束事务</p>
<p>commit;提交事务</p>
<p>rollback;回滚事务</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 事务的使用步骤
</span><span style="color:#75715e">#开启事务
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> autocommit<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
start transaction;
<span style="color:#75715e">#编写一组事务的语句
</span><span style="color:#75715e"></span><span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span> <span style="color:#66d9ef">where</span> username<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;账号1&#39;</span>;
<span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span> <span style="color:#66d9ef">where</span> username<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;账号2&#39;</span>;
<span style="color:#75715e">#结束事务
</span><span style="color:#75715e"></span>commit; <span style="color:#960050;background-color:#1e0010">或者</span> rollback;
</code></pre></div><p>delete删除的可以用rollback回滚；truncate删除的不可用rollback回滚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># savepoint的使用
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> autocommit<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
start transaction;
<span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> account <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">25</span>;
savepoint a;<span style="color:#75715e">#设置保存点
</span><span style="color:#75715e"></span><span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> account <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">28</span>;
rollback <span style="color:#66d9ef">to</span> a;<span style="color:#75715e">#回滚到保存点
</span></code></pre></div><h3 id="隔离机制">隔离机制</h3>
<p>并发事务访问相同的数据的时候，如果没有隔离机制，可能会有一些问题：</p>
<p>​	脏读：T2更新了但还没有提交，T1读了，T2回滚了，T1读取的有问题</p>
<p>​	不可重复度：T1读了，T2更新了，T1再次读，值就不同了</p>
<p>​	幻读：T1读了，T2插入新的行,T1再读，就会多出几行</p>
<p><strong>数据库的4种事务隔离级别</strong></p>
<p>​	READ UNCOMMITTED（读未提交数据）：脏读、不可重复读、幻读都会出现</p>
<p>​	READ COMMITTED（读已提交）：可以避免脏读、不可以避免不可重复度、幻读</p>
<p>​	REPEATABLE READ（可重复读）：可以避免脏读、不可重复读；但是幻读仍然存在</p>
<p>​	SERIALIZABLE（串行化）：可以避免所有问题，但是性能十分低下</p>
<p>oracle 支持2个READ COMMITED（默认）和 SERIALIZABLE</p>
<p>mysql支持4个，默认是REPEATABLE READ</p>
<p>通过<code>select @@tx_isolation;</code>  全局变量 可以查看当前隔离级别</p>
<p>通过<code>set session transaction isolation level read uncommitted;</code> 可以设置隔离级别</p>
<p>设置全局的隔离级别：<code>set global transaction isolation level read committed;</code></p>
<h2 id="视图存储函数">视图、存储、函数</h2>
<h3 id="视图">视图</h3>
<p>是虚拟表，和普通表一样使用</p>
<p>动态生成的，只保存sql逻辑，不保存实际数据</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 创建视图
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> view <span style="color:#960050;background-color:#1e0010">视图名</span> <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">查询语句</span>

<span style="color:#75715e"># 修改视图
</span><span style="color:#75715e"># 方式1
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">replace</span> view <span style="color:#960050;background-color:#1e0010">视图名</span> <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">查询语句</span>
<span style="color:#75715e"># 方式2
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> view <span style="color:#960050;background-color:#1e0010">视图名</span> <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">查询语句</span>

<span style="color:#75715e"># 删除视图
</span><span style="color:#75715e"></span><span style="color:#66d9ef">drop</span> view <span style="color:#960050;background-color:#1e0010">视图名</span>,<span style="color:#960050;background-color:#1e0010">视图名</span>,...;

<span style="color:#75715e"># 查看视图结构
</span><span style="color:#75715e"></span><span style="color:#66d9ef">desc</span> <span style="color:#960050;background-color:#1e0010">视图名</span>;
<span style="color:#66d9ef">show</span> <span style="color:#66d9ef">create</span> view <span style="color:#960050;background-color:#1e0010">视图名</span>;

<span style="color:#75715e"># 视图数据的更新 insert update delete 和表一样
</span><span style="color:#75715e">## 具备以下特点的视图不允许更新
</span><span style="color:#75715e"># 1 包含分组函数、distinct、group by、having、union或者union all等关键字
</span><span style="color:#75715e"># 2 常量视图
</span><span style="color:#75715e"># 3 select中包含子查询
</span><span style="color:#75715e"># 4 有join 或者,连接表的
</span><span style="color:#75715e"># 5 from一个不能更新的视图
</span><span style="color:#75715e"># 6 where子句的子查询引用了from子句的表
</span><span style="color:#75715e"></span>
</code></pre></div><h3 id="变量">变量</h3>
<p>变量：分为系统变量、自定义变量</p>
<p>​	系统变量：全局变量、会话变量</p>
<p>​	自定义变量：用户变量、局部变量</p>
<p><strong>系统变量：</strong></p>
<p>由系统提供，不是用户定义，属于服务器层面</p>
<p>1、查看所有的系统变量：<code>show global|[session] variables;</code></p>
<p>2、查看满足条件的部分系统变量：<code>show global|[session] variables like '%char%';</code></p>
<p>3、查看指定的某个系统变量的值：<code>select @@global|[session].系统变量名</code>;</p>
<p>4、为某个系统变量赋值</p>
<p>​	方式一：<code>set global | [session] 系统变量名 = 值;</code></p>
<p>​	方式二：<code>set @@global|[session].系统变量名 = 值;</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 全局变量
</span><span style="color:#75715e"># 作用域：针对所有的会话或链接有效，但是不能跨重启
</span><span style="color:#75715e">#1 查看全局变量
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> global variables;
<span style="color:#75715e">#2 查看部分的全局变量
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> global variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%char%&#39;</span>;
<span style="color:#75715e">#3 查看指定的全局变量值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">@@</span>global.autocommit;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">@@</span>tx_isolation;
<span style="color:#75715e">#4 为某个指定的全局变量赋值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#f92672">@@</span>global.autocommit <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#会话变量 session 可以省略
</span><span style="color:#75715e"># 作用域：当前的会话有效
</span><span style="color:#75715e">#1 查看所有的会话变量
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> session variables;
<span style="color:#75715e">#2 查看部分的会话变量
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> session variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%char%&#39;</span>;
<span style="color:#75715e">#3 查看指定的会话变量
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">@@</span>tx_isolation;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">@@</span>session.tx_isolation;
<span style="color:#75715e">#4 为某个会话赋值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#f92672">@@</span>session.tx_isolation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;read-uncommitted&#39;</span>;
<span style="color:#66d9ef">set</span> session tx_isolation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;read-committed&#39;</span>;

</code></pre></div><p><strong>自定义变量</strong></p>
<p>说明：自定义变量是用户自定义的，不是有系统提供的</p>
<p>使用步骤：声明、赋值、使用</p>
<p>作用域：当前会话有效，等同于会话变量的作用域</p>
<p>位置：应用在任何地方</p>
<p>1、声明并初始化</p>
<p>​	<code>set @用户变量名=值; </code> <code>set @用户变量名:=值;</code> <code>select @用户变量名:=值;</code></p>
<p>2、赋值（更新用户变量的值）</p>
<p>​	方式一：<code>set @用户变量名=值; </code> <code>set @用户变量名:=值;</code> <code>select @用户变量名:=值;</code></p>
<p>​	方式二：<code>select 字段 into @用户变量名 from 表;</code></p>
<p>3、使用</p>
<p>​	查看：<code>select @用户变量名;</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 用户自定义变量
</span><span style="color:#75715e"># 声明并初始化
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#f92672">@</span>count<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
<span style="color:#75715e"># 赋值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">into</span> <span style="color:#f92672">@</span>count <span style="color:#66d9ef">from</span> employees;
<span style="color:#75715e"># 查看
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">@</span>count;
</code></pre></div><p>局部变量：作用域只在定义它的begin end中有效;</p>
<p>必须放在第一句话！</p>
<p>1、声明</p>
<p>​	<code>declare 变量名 类型;</code>	<code>declare 变量名 类型 default 值;</code></p>
<p>2、赋值</p>
<p>​	方式一：<code>set 局部变量名=值;</code> <code>set 局部变量名:=值;</code> <code>select @局部变量名:=值;</code></p>
<p>​	方式二: <code>select 字段 into @局部变量名 from 表;</code></p>
<p>3、使用</p>
<p>​	<code>select 局部变量名;</code></p>
<table>
<thead>
<tr>
<th></th>
<th>作用域</th>
<th>定义和使用位置</th>
<th>语法</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户变量</td>
<td>当前会话有效</td>
<td>会话中的任何位置</td>
<td>必须加@符号，不限定类型</td>
</tr>
<tr>
<td>局部变量</td>
<td>begin end中有效</td>
<td>只能在begin end中，且为第一句话</td>
<td>一般不加@符号，需要限定类型</td>
</tr>
</tbody>
</table>
<h3 id="存储过程">存储过程</h3>
<p>一组预先编译好的SQL语句的集合</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#创建
</span><span style="color:#75715e"></span><span style="color:#75715e">/*创建语法
</span><span style="color:#75715e">create procedure 存储过程名(参数列表)
</span><span style="color:#75715e">BEGIN
</span><span style="color:#75715e">	存储过程体(一组合法的SQL语句)
</span><span style="color:#75715e">END
</span><span style="color:#75715e">注意：
</span><span style="color:#75715e">1、参数列表包含 参数模式 参数名 参数类型
</span><span style="color:#75715e">参数模式：IN OUT INOUT
</span><span style="color:#75715e">2、如果存储过程体只有一句话begin end可以省略
</span><span style="color:#75715e">存储过程体枚举sql语句结尾必须加分号
</span><span style="color:#75715e">存储过程体结尾可以使用DELIMITER 重新设置结束标记;例如DELIMITER $
</span><span style="color:#75715e">*/</span>
<span style="color:#75715e"># 空参列表
</span><span style="color:#75715e"></span>DELIMITER <span style="color:#960050;background-color:#1e0010">$</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">PROCEDURE</span> <span style="color:#a6e22e">myp1</span>()
BEGIN
	<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">admin</span>(username,password)
	<span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#39;kevin&#39;</span>,<span style="color:#ae81ff">1234</span>),(<span style="color:#e6db74">&#39;abin&#39;</span>,<span style="color:#ae81ff">5678</span>);
END <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#75715e"># 有in参数的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">PROCEDURE</span> <span style="color:#a6e22e">myp2</span>(<span style="color:#66d9ef">IN</span> username <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>),<span style="color:#66d9ef">IN</span> password <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>))
BEGIN
	<span style="color:#66d9ef">declare</span> result <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">default</span> <span style="color:#ae81ff">0</span>;
	<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">into</span> reslut
	<span style="color:#66d9ef">from</span> admin a <span style="color:#66d9ef">where</span> a.username<span style="color:#f92672">=</span>username <span style="color:#66d9ef">and</span> a.password<span style="color:#f92672">=</span>password;
    <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">if</span>(result<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#39;success&#39;</span>,<span style="color:#e6db74">&#39;fail&#39;</span>);
END <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#75715e"># 有out参数的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">procedure</span> <span style="color:#a6e22e">myp3</span>(<span style="color:#66d9ef">in</span> beautyname <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>),<span style="color:#66d9ef">out</span> boyname <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>),<span style="color:#66d9ef">out</span> usercp <span style="color:#66d9ef">int</span>)
begin
	<span style="color:#66d9ef">select</span> bo.boyName,bo.userCP <span style="color:#66d9ef">into</span> boyname,usercp
	<span style="color:#66d9ef">from</span> boys bo
	<span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> beauty b <span style="color:#66d9ef">on</span> bo.id<span style="color:#f92672">=</span>b.boyfriend_id
	<span style="color:#66d9ef">where</span> b.name<span style="color:#f92672">=</span>beautyname;
end <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#75715e"># 有inout参数的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">procedure</span> <span style="color:#a6e22e">myp4</span>(<span style="color:#66d9ef">inout</span> a <span style="color:#66d9ef">int</span>,<span style="color:#66d9ef">inout</span> b <span style="color:#66d9ef">int</span>)
begin
	<span style="color:#66d9ef">set</span> a<span style="color:#f92672">=</span>a<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>;
	<span style="color:#66d9ef">set</span> b<span style="color:#f92672">=</span>b<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>;
end <span style="color:#960050;background-color:#1e0010">$</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#调用
</span><span style="color:#75715e"></span><span style="color:#75715e">/*call 存储过程名()*/</span>
<span style="color:#75715e"># 调用 空参存储过程
</span><span style="color:#75715e"></span><span style="color:#66d9ef">call</span> <span style="color:#a6e22e">myp1</span>()<span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#75715e"># 调用 有in参数的存储过程
</span><span style="color:#75715e"></span><span style="color:#66d9ef">call</span> <span style="color:#a6e22e">myp2</span>(<span style="color:#e6db74">&#39;张飞&#39;</span>,<span style="color:#e6db74">&#39;8888&#39;</span>)<span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#75715e"># 调用 有out参数的存储过程
</span><span style="color:#75715e"></span><span style="color:#66d9ef">call</span> <span style="color:#a6e22e">myp3</span>(<span style="color:#e6db74">&#39;小昭&#39;</span>,<span style="color:#f92672">@</span>bName,<span style="color:#f92672">@</span>usercp)<span style="color:#960050;background-color:#1e0010">$</span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">@</span>bName,<span style="color:#f92672">@</span>usercp<span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#75715e"># 调用 有inout参数的存储过程
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#f92672">@</span>m<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">$</span>
<span style="color:#66d9ef">set</span> <span style="color:#f92672">@</span>n<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span><span style="color:#960050;background-color:#1e0010">$</span>
<span style="color:#66d9ef">call</span> <span style="color:#a6e22e">myp4</span>(<span style="color:#f92672">@</span>m,<span style="color:#f92672">@</span>n)<span style="color:#960050;background-color:#1e0010">$</span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">@</span>m,<span style="color:#f92672">@</span>n<span style="color:#960050;background-color:#1e0010">$</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 删除存储过程 :一次只能删除一个
</span><span style="color:#75715e"></span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">procedure</span> myp1;

<span style="color:#75715e"># 查看存储过程的结构
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">procedure</span> myp2;
</code></pre></div><h3 id="函数-1">函数</h3>
<p>和存储过程类似，但是函数有且仅有一个返回值。所以函数更适合做处理数据后返回一个结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 创建
</span><span style="color:#75715e"></span><span style="color:#75715e">/* 语法
</span><span style="color:#75715e">CREATE FUNCTION 函数名(参数列表) RETURNS 返回类型
</span><span style="color:#75715e">BEGIN
</span><span style="color:#75715e">	函数体
</span><span style="color:#75715e">END
</span><span style="color:#75715e">
</span><span style="color:#75715e">注意：
</span><span style="color:#75715e">1、参数列表包含 参数名 参数类型
</span><span style="color:#75715e">2、return语句必须要有，否则报错；位置不一定放在最后，但不建议；
</span><span style="color:#75715e">3、函数体如果只有一句话 begin end 可以省略的
</span><span style="color:#75715e">4、使用delimiter语句设置结束标记
</span><span style="color:#75715e">*/</span>
<span style="color:#75715e"># 有参数有返回
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> function <span style="color:#a6e22e">myf1</span>(deptName <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>)) returns <span style="color:#66d9ef">double</span>
begin
	<span style="color:#66d9ef">declare</span> sal <span style="color:#66d9ef">double</span>;
	<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">avg</span>(salary) <span style="color:#66d9ef">into</span> sal
	<span style="color:#66d9ef">from</span> employees e <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> departments d <span style="color:#66d9ef">on</span> e.department_id<span style="color:#f92672">=</span>d.department_id
	<span style="color:#66d9ef">where</span> d.department_name<span style="color:#f92672">=</span>deptName;
	<span style="color:#66d9ef">return</span> sal;
end <span style="color:#960050;background-color:#1e0010">$</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 调用
</span><span style="color:#75715e"></span><span style="color:#75715e">/*语法
</span><span style="color:#75715e">select 函数名(参数列表)
</span><span style="color:#75715e">*/</span>
<span style="color:#75715e"># 调用有参数的函数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">myf1</span>(<span style="color:#e6db74">&#39;IT&#39;</span>)<span style="color:#960050;background-color:#1e0010">$</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 查看函数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> <span style="color:#66d9ef">create</span> function myf1;

<span style="color:#75715e"># 删除函数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">drop</span> function myf1;
</code></pre></div><h3 id="流程控制">流程控制</h3>
<p><strong>分支结构</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># if函数
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">if(表达式1，表达式2，表达式3)
</span><span style="color:#75715e">如果表达式1成立，则if函数返回表达式2的值，否则返回表达式3的值
</span><span style="color:#75715e">*/</span>

<span style="color:#75715e"># if 结构
</span><span style="color:#75715e"></span><span style="color:#75715e">/*  条件1 then 语句1;
</span><span style="color:#75715e">elseif 条件2 then 语句2;
</span><span style="color:#75715e">...
</span><span style="color:#75715e">[else 语句n;]
</span><span style="color:#75715e">end if;
</span><span style="color:#75715e">只能应用在begin end中
</span><span style="color:#75715e">*/</span>

<span style="color:#75715e"># 结合函数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> function <span style="color:#a6e22e">test_if</span>(score <span style="color:#66d9ef">int</span>) returns <span style="color:#66d9ef">char</span>
begin
	<span style="color:#66d9ef">if</span> score<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">90</span> <span style="color:#66d9ef">and</span> score<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">100</span> <span style="color:#66d9ef">then</span> <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;A&#39;</span>;
	<span style="color:#66d9ef">elseif</span> score<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">80</span> <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;B&#39;</span>;
	<span style="color:#66d9ef">elseif</span> score<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">60</span> <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;C&#39;</span>;
	<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;D&#39;</span>;
	end <span style="color:#66d9ef">if</span>;
end <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">test_if</span>(<span style="color:#ae81ff">86</span>)<span style="color:#960050;background-color:#1e0010">$</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># case结构
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">-- case 作为表达式 --
</span><span style="color:#75715e">情况1：实现等值判断
</span><span style="color:#75715e">case 变量|表达式|字段
</span><span style="color:#75715e">when 要判断的值 then 返回的值1
</span><span style="color:#75715e">when 要判断的值 then 返回的值2
</span><span style="color:#75715e">...
</span><span style="color:#75715e">else 返回的值n或语句
</span><span style="color:#75715e">end;
</span><span style="color:#75715e">
</span><span style="color:#75715e">情况2：实现区间判断
</span><span style="color:#75715e">case
</span><span style="color:#75715e">when 要判断的条件	then 返回的值1
</span><span style="color:#75715e">when 要判断的条件	then 返回的值2
</span><span style="color:#75715e">...
</span><span style="color:#75715e">else 返回的值n或语句
</span><span style="color:#75715e">end;
</span><span style="color:#75715e">
</span><span style="color:#75715e">-- case 作为独立的语句 --
</span><span style="color:#75715e">情况1：实现等值判断
</span><span style="color:#75715e">case 变量|表达式|字段
</span><span style="color:#75715e">when 要判断的值 then 语句1;
</span><span style="color:#75715e">when 要判断的值 then 语句2;
</span><span style="color:#75715e">...
</span><span style="color:#75715e">else 语句;
</span><span style="color:#75715e">end case;
</span><span style="color:#75715e">
</span><span style="color:#75715e">情况2：实现区间判断
</span><span style="color:#75715e">case
</span><span style="color:#75715e">when 要判断的条件	then 语句1;
</span><span style="color:#75715e">when 要判断的条件	then 语句2;
</span><span style="color:#75715e">...
</span><span style="color:#75715e">else 语句n;
</span><span style="color:#75715e">end case;
</span><span style="color:#75715e">
</span><span style="color:#75715e">特点：
</span><span style="color:#75715e">作为表达式，嵌套在其他语句中，可以放在任何地方，BEIGN END中或者外面；
</span><span style="color:#75715e">作为独立的语句使用，只能放在BEGIN END中
</span><span style="color:#75715e">*/</span>

<span style="color:#75715e"># case作为独立语句
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">procedure</span> <span style="color:#a6e22e">test_case</span>(<span style="color:#66d9ef">in</span> score <span style="color:#66d9ef">int</span>)
begin
	<span style="color:#66d9ef">case</span>
	<span style="color:#66d9ef">when</span> score<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">90</span> <span style="color:#66d9ef">and</span> score <span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">100</span> <span style="color:#66d9ef">then</span> <span style="color:#66d9ef">select</span> <span style="color:#e6db74">&#39;A&#39;</span>;
	<span style="color:#66d9ef">when</span> score<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">80</span> <span style="color:#66d9ef">then</span> <span style="color:#66d9ef">select</span> <span style="color:#e6db74">&#39;B&#39;</span>;
	<span style="color:#66d9ef">when</span> score<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">60</span> <span style="color:#66d9ef">then</span> <span style="color:#66d9ef">select</span> <span style="color:#e6db74">&#39;C&#39;</span>;
	<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">select</span> <span style="color:#e6db74">&#39;D&#39;</span>;
	end <span style="color:#66d9ef">case</span>;
end <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#66d9ef">call</span> <span style="color:#a6e22e">test_case</span>(<span style="color:#ae81ff">95</span>)<span style="color:#960050;background-color:#1e0010">$</span>
</code></pre></div><p><strong>循环结构</strong></p>
<p>循环结构有while、repeat、loop</p>
<p>循环控制有iterate、leave</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#while  先判断后执行
</span><span style="color:#75715e"></span><span style="color:#75715e">/*语法
</span><span style="color:#75715e">[Label:] while 循环条件 do
</span><span style="color:#75715e">	循环体
</span><span style="color:#75715e">	end while [Label]
</span><span style="color:#75715e">*/</span>

<span style="color:#75715e">#repeat  先执行后判断
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">[Label:] repeat 
</span><span style="color:#75715e">	循环体
</span><span style="color:#75715e">	util 结束条件
</span><span style="color:#75715e">	end repeat [Label]
</span><span style="color:#75715e">*/</span>

<span style="color:#75715e">#loop 	没有条件的死循环
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">[Label:] loop
</span><span style="color:#75715e">	循环体
</span><span style="color:#75715e">	end loop [label]
</span><span style="color:#75715e">*/</span>

<span style="color:#75715e"># while 添加leave
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">procedure</span> <span style="color:#a6e22e">test_while1</span>(<span style="color:#66d9ef">in</span> insertCount <span style="color:#66d9ef">int</span>)
begin
	<span style="color:#66d9ef">declare</span> i <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">default</span> <span style="color:#ae81ff">1</span>;
	a:<span style="color:#66d9ef">while</span> i<span style="color:#f92672">&lt;=</span>insertCount do
        <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">admin</span>(username,password) <span style="color:#66d9ef">values</span>(<span style="color:#a6e22e">concat</span>(<span style="color:#e6db74">&#39;kevin&#39;</span>,i),<span style="color:#e6db74">&#39;666&#39;</span>);
        <span style="color:#66d9ef">if</span> i<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">20</span> <span style="color:#66d9ef">then</span> <span style="color:#66d9ef">leave</span> a;
        end <span style="color:#66d9ef">if</span>;
        <span style="color:#66d9ef">set</span> i<span style="color:#f92672">=</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>;
	end <span style="color:#66d9ef">while</span> a;
end <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#66d9ef">call</span> <span style="color:#a6e22e">test_while1</span>(<span style="color:#ae81ff">100</span>)<span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#75715e"># while 添加iterate语句
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">procedure</span> <span style="color:#a6e22e">test_while2</span>(<span style="color:#66d9ef">in</span> insertcount <span style="color:#66d9ef">int</span>)
begin
	<span style="color:#66d9ef">declare</span> i <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">default</span> <span style="color:#ae81ff">0</span>;
	a:<span style="color:#66d9ef">while</span> i<span style="color:#f92672">&lt;=</span>insertcount do
        <span style="color:#66d9ef">set</span> i<span style="color:#f92672">=</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>;
        <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">mod</span>(i,<span style="color:#ae81ff">2</span>)<span style="color:#f92672">!=</span><span style="color:#ae81ff">0</span> <span style="color:#66d9ef">then</span> <span style="color:#66d9ef">iterate</span> a;
        end <span style="color:#66d9ef">if</span>;
        <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">admin</span>(username,password) <span style="color:#66d9ef">values</span>(<span style="color:#a6e22e">concat</span>(<span style="color:#e6db74">&#39;kevin&#39;</span>,i),<span style="color:#e6db74">&#39;666&#39;</span>);
	end <span style="color:#66d9ef">while</span> a;
	
end <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#66d9ef">call</span> <span style="color:#a6e22e">test_while2</span>(<span style="color:#ae81ff">100</span>)<span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#75715e"># 使用while 添加指定个数的随机字符串
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">procedure</span> <span style="color:#a6e22e">test_while3</span>(<span style="color:#66d9ef">in</span> insertcount <span style="color:#66d9ef">int</span>)
begin
	<span style="color:#66d9ef">declare</span> i <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">default</span> <span style="color:#ae81ff">1</span>;
	<span style="color:#66d9ef">declare</span> sidx <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">default</span> <span style="color:#ae81ff">1</span>;
	<span style="color:#66d9ef">declare</span> slen <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">default</span> <span style="color:#ae81ff">1</span>;
	<span style="color:#66d9ef">declare</span> str <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">26</span>) <span style="color:#66d9ef">default</span> <span style="color:#e6db74">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>;
	<span style="color:#66d9ef">while</span> i<span style="color:#f92672">&lt;=</span>insertcount do
		<span style="color:#66d9ef">set</span> sidx<span style="color:#f92672">=</span> <span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">rand</span>()<span style="color:#f92672">*</span><span style="color:#ae81ff">26</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>);
		<span style="color:#66d9ef">set</span> slen<span style="color:#f92672">=</span> <span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">rand</span>()<span style="color:#f92672">*</span>(<span style="color:#ae81ff">26</span><span style="color:#f92672">-</span>sidx<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>);
		<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> stringcontent <span style="color:#66d9ef">values</span>(<span style="color:#a6e22e">substr</span>(str,sidx,slen));
		<span style="color:#66d9ef">set</span> i<span style="color:#f92672">=</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>;
	end <span style="color:#66d9ef">while</span>;
	
end <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#66d9ef">call</span> <span style="color:#a6e22e">test_while3</span>(<span style="color:#ae81ff">10</span>)<span style="color:#960050;background-color:#1e0010">$</span>	
</code></pre></div><h2 id="架构">架构</h2>
<p>mysql主要配置文件：</p>
<p>​	二进制日志log-bin</p>
<p>​	错误日志log-error</p>
<p>​	查询日志log</p>
<p>​	数据文件：</p>
<p>​		frm文件：存放表结构</p>
<p>​		myd文件：存放表数据</p>
<p>​		myi文件：存放表索引</p>
<p>mysql逻辑架构</p>
<p>​	第一层(连接层)：connection Pool</p>
<p>​	第二层(服务层)：Management Services&amp;Utilities 、SQL Interface、Parser、Optimizer、Caches &amp; Buffers</p>
<p>​	第三层(引擎层)：Pluggable Storage Engines （插件式的）</p>
<p>​	第四层(存储层)：File Sytem 、Files &amp; Logs</p>
<p>mysql存储引擎</p>
<p>​	查看命令：<code>show engines;</code> 或 <code>show variables like '%store_engines%';</code></p>
<table>
<thead>
<tr>
<th></th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td>主外键</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>事务</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>行表锁</td>
<td>表锁，即使操作一条记录也会锁住整张表，不适合高并发操作</td>
<td>行锁，操作时只锁某一行，不对其他行影响，适合高并发操作</td>
</tr>
<tr>
<td>缓存</td>
<td>只缓存索引，不缓存真实数据</td>
<td>不仅缓存索引，还缓存真实数据，对内存要求较高</td>
</tr>
<tr>
<td>表空间</td>
<td>小</td>
<td>大</td>
</tr>
<tr>
<td>关注点</td>
<td>性能</td>
<td>事务</td>
</tr>
<tr>
<td>默认安装</td>
<td>是</td>
<td>是</td>
</tr>
</tbody>
</table>
<h2 id="索引">索引</h2>
<h3 id="索引优化">索引优化</h3>
<h4 id="7种join理论">7种join理论</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># A 交 B 查询 A
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> A <span style="color:#66d9ef">left</span> <span style="color:#66d9ef">join</span> B <span style="color:#66d9ef">on</span> A.<span style="color:#66d9ef">key</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">key</span>

<span style="color:#75715e"># A 交 B 查询 B
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.<span style="color:#66d9ef">KEY</span> <span style="color:#f92672">=</span> B.<span style="color:#66d9ef">KEY</span>

<span style="color:#75715e"># A 交 B 查询 A和B的交集
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A <span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.<span style="color:#66d9ef">KEY</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">KEY</span>

<span style="color:#75715e"># A 交 B 查询A 但是去除交集
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.<span style="color:#66d9ef">KEY</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">WHERE</span> B.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>

<span style="color:#75715e"># A 交 B 查询B 但是去除交集
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.<span style="color:#66d9ef">KEY</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">WHERE</span> A.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>

<span style="color:#75715e"># A 交 B 查询全部
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A FULL <span style="color:#66d9ef">OUTER</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.<span style="color:#66d9ef">KEY</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">KEY</span> ( <span style="color:#75715e">-- mysql 无效)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.<span style="color:#66d9ef">KEY</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">KEY</span> 
<span style="color:#66d9ef">UNION</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A  <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span>  A.<span style="color:#66d9ef">KEY</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">KEY</span>

<span style="color:#75715e"># A 交 B 查询全部 但是去除交集
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A FULL <span style="color:#66d9ef">OUTER</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.<span style="color:#66d9ef">KEY</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">WHERE</span> A.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">OR</span> B.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span> (<span style="color:#75715e">-- mysql 无效)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.<span style="color:#66d9ef">KEY</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">WHERE</span> B.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>
<span style="color:#66d9ef">UNION</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.<span style="color:#66d9ef">KEY</span><span style="color:#f92672">=</span>B.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">WHERE</span> A.<span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>

</code></pre></div><h4 id="索引简介">索引简介</h4>
<p>索引：可以理解为排好序的快速查找的数据结构；一般使用B+tree索引。(还有Hash、full-text、R-Tree等索引)</p>
<p>​	B+tree树的特点：非叶子节点不存储真实数据，只存储指引搜索方向的数据项；真实的数据放在叶子节点；叶子节点之间只用指针连接在一起，方便顺序遍历。</p>
<p>优劣势：提高了数据检索的效率，降低数据库的IO成本；但是占用了更多空间，同时降低了更新表的速度。</p>
<p>索引分类：</p>
<p>​	单值索引：一个索引只包含单个列，一个表可以有多个单列索引</p>
<p>​	唯一索引：索引列的值必须唯一，但允许有空值</p>
<p>​	复合索引：一个索引包含多个列</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 创建索引
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> [<span style="color:#66d9ef">UNIQUE</span>] <span style="color:#66d9ef">INDEX</span> indexName <span style="color:#66d9ef">ON</span> <span style="color:#a6e22e">mytable</span>(<span style="color:#a6e22e">columnname</span>(length));
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">table</span> mytable <span style="color:#66d9ef">ADD</span> [<span style="color:#66d9ef">UNIQUE</span>] <span style="color:#66d9ef">INDEX</span> [indexName] <span style="color:#66d9ef">ON</span> (<span style="color:#a6e22e">columnname</span>(length));

<span style="color:#75715e"># 删除索引
</span><span style="color:#75715e"></span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">INDEX</span> [INDEXNAME] <span style="color:#66d9ef">ON</span> mytable;

<span style="color:#75715e"># 查看索引
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">FROM</span> table_name<span style="color:#960050;background-color:#1e0010">\</span>G

<span style="color:#75715e">#添加主键，该索引值必须唯一，且不能为NULL
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(column_list);
<span style="color:#75715e">#添加唯一索引，值必须唯一，但可以为NULL
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">UNIQUE</span> <span style="color:#a6e22e">index_name</span>(column_list);
<span style="color:#75715e">#添加普通索引，索引值可以出现多次
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#a6e22e">index_name</span>(column_list);
<span style="color:#75715e">#添加全文索引
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">FULLTEXT</span> <span style="color:#a6e22e">index_name</span>(column_list);
</code></pre></div><p>需要建立索引和不需要建立索引的情况：</p>
<p>​	需要建立索引的情况：</p>
<p>​		1、主键自动建立唯一索引</p>
<p>​		2、频繁作为查询的字段应该创建索引</p>
<p>​		3、外键关系建立索引</p>
<p>​		4、单值/复合索引的选择，在高并发倾向创建组合索引</p>
<p>​		5、查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度</p>
<p>​		6、查询中统计或者分组字段</p>
<p>​	不需要建立索引的情况：</p>
<p>​		1、频繁更新的字段不适合创建索引</p>
<p>​		2、WHERE条件中用不到的字段不创建索引</p>
<p>​		3、表记录太少</p>
<p>​		4、数据重复且分布平均的字段（例如性别、国籍）</p>
<h4 id="性能分析">性能分析</h4>
<p>性能分析：mysql query optimizer; cpu 、io、硬件等；Explain</p>
<p>Explain：使用explain关键字，模拟优化器执行sql语句，分析查询语句或表结构的性能瓶颈。</p>
<p><code>explain select * from stuinfo where id=1;</code></p>
<p>​	作用：</p>
<p>​		表的读取顺序 （通过id可以看出）</p>
<p>​		数据读取操作的操作类型 （select_type 可以看出）</p>
<p>​		哪些索引可以使用（possible_keys可以看出）</p>
<p>​		实际使用了哪些索引（key可以看出）</p>
<p>​		表之间的引用（ref可以看出）</p>
<p>​		每张表有多少行被优化器查询（rows可以看出）</p>
<p>​	各名词含义：</p>
<p>​		id:	id相同，顺序从上到下；id不同，数值越大，越先执行；</p>
<p>​		select_type:	查询类型，包含SIMPLE、PRIMARY、SUBQUERY、DERIVED、UNION、UNION RESULT</p>
<p>​			SIMPLE:简单的select查询，不包含子查询或者union</p>
<p>​			PRIMARY:查询中若包含复杂的子部分，最外层查询被标记为primary</p>
<p>​			SUBQUERY:在select 或where列表中包含了子查询</p>
<p>​			DERIVED：在from中包含的子查询被标记为DERIVED（衍生）,MYSQL递归查询子查询，把结果放在临时表</p>
<p>​			UNION：若第二个select出现在union后，被标记为UNION；若union包含在from子句的子查询中，外层select 被标记为DERIVED</p>
<p>​			UNION RESULT：从UNION表获取结果的select</p>
<p>​		table:	显示这一行的数据是关于哪张表</p>
<p>​		type:	包含：ALL 、index、range、ref、eq_ref、const,system、NULL</p>
<p>​			最好到最差依次是：system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</p>
<p>​				system: 表中只有一条记录</p>
<p>​				const:索引一次就找到了，匹配出一行数据，常见于主键或唯一索引扫描（一般用于单表查询）</p>
<p>​				eq_ref:唯一性索引扫描，匹配一条记录，常见于主键或唯一索引扫描（一般用于联表查询）</p>
<p>​				ref:非唯一索引扫描，返回匹配某个单独值的所有行</p>
<p>​				range:只检索出给定范围的行，使用一个索引来选择，一般是between、in、&lt;、&gt;等的查询</p>
<p>​				index:遍历索引，全索引扫描</p>
<p>​				all:全表扫描</p>
<p>​		possible_keys:显示可能用到的索引，一个或多个；但不一定被实际查询使用</p>
<p>​		key:实际使用的索引，如果为null，则没有使用索引；查询中若使用了覆盖索引，则该索引仅出现在key列表中</p>
<p>​		key_len:索引使用的字节数，不损失精确性的情况下，长度越短越好；显示的为索引字段的最大可能长度，并非实际商都。</p>
<p>​		ref:显示索引的哪一列被使用了，哪些列或常量被用于查找索引列上的值；如果可能，是一个常数。</p>
<p>​		rows:大致估算出找到所需记录所需要读取的行数</p>
<p>​		Extra:包含不适合在其他列中显示但十分重要的额外信息</p>
<p>​			using filesort:文件排序，无法按照索引顺序读取，使用一个外部的索引排序。</p>
<p>​			using temporary:在对查询结果排序的时候，使用了临时表保存中间结果；常用语order by和group by。</p>
<p>​			using index:表明使用了索引；如果同时出现了using where，说明被用来执行索引键值的查找；如果没有出现using where，说明是用来读取数据而不是查找数据</p>
<p>​			其他还包括：using where、using join buffer、impossible where、select tables optimized away、distinct等。</p>
<h4 id="索引优化-1">索引优化</h4>
<p>join语句优化：</p>
<p>尽可能减少join语句中NestedLoop嵌套循环的总次数：用小结果集驱动大的结果集。</p>
<p>优先优化NestedLoop的内层循环；</p>
<p>保证join语句中被驱动表上的join条件字段已经被索引：left join 索引添加到右表上；right join 索引添加到左表上；</p>
<p>当无法保证被驱动表的join条件字段被索引且内存资源充足的前提下，不要吝惜JoinBuffer的设置；</p>
<p><strong>索引失效</strong></p>
<p>1、全值匹配效果最好</p>
<p>2、<strong>最佳左前缀法则</strong>-查询从最左边的索引开始，并且不跳过索引中间的列</p>
<p>3、不在索引列上做任何操作（计算、函数、类型转换），会导致索引失效而转向全表扫描</p>
<p>4、不能使用索引中范围条件右边的列</p>
<p>5、尽量使用覆盖索引（只访问索引的查询，索引列和查询列一致），少用select *</p>
<p>6、在使用!=或&lt;&gt;时，无法使用索引会导致全表扫描</p>
<p>7、is null，is not null无法使用索引</p>
<p>8、like以通配符开头‘%ab..’的索引会失效变成全表扫描 （一般用覆盖索引解决）</p>
<p>9、字符串不加单引号索引失效</p>
<p>10、少用or，用来连接时会索引失效。</p>
<p>注意：group by基本上需要进行排序，会有临时表产生</p>
<p>一般建议：</p>
<p>​	对于单值索引，尽量选择过滤性更好的索引</p>
<p>​	对于组合索引，过滤性最好的索引位置越靠左越好</p>
<p>​	对于组合索引，尽量选择包含更多where中的字段</p>
<h4 id="查询截取分析">查询截取分析</h4>
<p>慢查询的开启并捕获、explain+慢SQL分析、show profile查询SQL的执行细节和生命周期情况、SQL数据库服务器的参数调优。</p>
<p><strong>查询优化</strong>：</p>
<p>​	永远小表驱动大表</p>
<p>​		<code>select * from A where id in (select id from B)</code></p>
<p>​		B表的数据集必须小于A表的时候，用in优于exists。</p>
<p>​		<code>select * from A where exists (select 1 from B where B.id=A.id)</code></p>
<p>​		当A的数据集小于B表的数据集时，用exists优于in。</p>
<p>​	ORDER BY子句优化</p>
<p>​		mysql支持index,filesort；index效率高，filesort效率低</p>
<p>​		order by 使用索引最左前列；或使用where与order by组合满足最左前列；会使用index方式排序</p>
<p>​		提高order by速度：</p>
<p>​			1、不要写select * ，只写需要的列</p>
<p>​			2、提高sort_buffer_size</p>
<p>​			3、提高max_length_for_sort_data</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># Mysql两种排序方式：文件排序(filesort)或扫描有序索引排序(index)
</span><span style="color:#75715e"># Mysql能为排序与查询使用相同的索引
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># 假设建立复合索引key a_b_c(a,b,c)
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># order by能使用索引最左前缀
</span><span style="color:#75715e"></span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> a;
<span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> a,b;
<span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> a,b,c;
<span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> a <span style="color:#66d9ef">desc</span>,b <span style="color:#66d9ef">desc</span>,c <span style="color:#66d9ef">desc</span>;

<span style="color:#75715e"># 如果where使用索引的最左前缀定义为常量，则order by能使用索引
</span><span style="color:#75715e"></span><span style="color:#66d9ef">where</span> a<span style="color:#f92672">=</span>const <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> b,c;
<span style="color:#66d9ef">where</span> a<span style="color:#f92672">=</span>const <span style="color:#66d9ef">and</span> b<span style="color:#f92672">=</span>const <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> c;
<span style="color:#66d9ef">where</span> a<span style="color:#f92672">=</span>const <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> b,c;
<span style="color:#66d9ef">where</span> a<span style="color:#f92672">=</span>const <span style="color:#66d9ef">and</span> b<span style="color:#f92672">&gt;</span>const <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> b,c;

<span style="color:#75715e">#不能使用索引进行排序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> a <span style="color:#66d9ef">asc</span>,b <span style="color:#66d9ef">desc</span>,c <span style="color:#66d9ef">desc</span>; <span style="color:#75715e">/*排序不一致*/</span>
<span style="color:#66d9ef">where</span> g<span style="color:#f92672">=</span>const <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> b,c;	<span style="color:#75715e">/*丢失a索引*/</span>
<span style="color:#66d9ef">where</span> a<span style="color:#f92672">=</span>const <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> c; <span style="color:#75715e">/*丢失b索引*/</span>
<span style="color:#66d9ef">where</span> a<span style="color:#f92672">=</span>const <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> a,d; <span style="color:#75715e">/*d不是索引的一部分*/</span>
<span style="color:#66d9ef">where</span> a <span style="color:#66d9ef">in</span>(...) <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> b,c; <span style="color:#75715e">/*对于排序来说，多个相等条件也是范围查询*/</span>

</code></pre></div><p>​	GROUP BY 子句优化</p>
<p>​		group by实际上是先排序后进行分组，遵照索引建的最佳左前缀</p>
<p>​		当无法使用索引列，增大max_length_for_sort_data参数的设置、以及sort_buffer_size参数的设置</p>
<p>​		where高于having，能写在where限定的条件就不用having限定。</p>
<p><strong>慢查询日志</strong></p>
<p>​	运行时间超过long_query_time（默认10s）设置的时间，则认为是慢SQL，会被记录到慢查询日志中； 默认未开启，开启会带来一些性能影响。</p>
<p>​	查看是否开启：<code>show variables like '%slow_query_log%;'</code></p>
<p>​	如何开启：<code>set global slow_query_log=1;</code>  和其他系统变量一样不能跨重启；想要永久生效需要修改配置文件。</p>
<p>​	查看long_query_time的值：<code>show variables like '%long_query_time%'; </code></p>
<p>​	设置long_query_time的值：<code>set global long_query_time=3;</code></p>
<p>​	查询当前有多少慢SQL:<code>show global status like '%Slow_queries%';</code></p>
<p>​	配置文件中配置参考如下：</p>
<blockquote>
<p>slow_query_log=1</p>
<p>slow_query_log_file=/var/lib/mysql/xxxx-slow.log</p>
<p>long_query_time=3</p>
<p>log_output=FIFE</p>
</blockquote>
<p>​	使用mysqldumpslow工具分析</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#75715e"># 得到返回记录集最多的10个sql</span>
mysqldumpslow <span style="color:#f92672">-</span>s r <span style="color:#f92672">-</span>t <span style="color:#ae81ff">10</span> <span style="color:#e6db74">/var/</span>lib<span style="color:#e6db74">/mysql/xxxx</span><span style="color:#f92672">-</span>slow<span style="color:#f92672">.</span>log
<span style="color:#75715e"># 得到访问次数最多的10个sql</span>
mysqldupmslow <span style="color:#f92672">-</span>s c <span style="color:#f92672">-</span>t <span style="color:#ae81ff">10</span> <span style="color:#e6db74">/var/</span>lib<span style="color:#e6db74">/mysql/xxxx</span><span style="color:#f92672">-</span>slow<span style="color:#f92672">.</span>log
<span style="color:#75715e"># 得到按照时间排序的前10条里面含有左连接的查询语句</span>
mysqldumpslow <span style="color:#f92672">-</span>s t <span style="color:#f92672">-</span>t <span style="color:#ae81ff">10</span> <span style="color:#f92672">-</span>g <span style="color:#e6db74">&#34;left join&#34;</span> <span style="color:#e6db74">/var/</span>lib<span style="color:#e6db74">/mysql/xxxx</span><span style="color:#f92672">-</span>slow<span style="color:#f92672">.</span>log
<span style="color:#75715e"># 建议结合|more使用，防止出现爆屏情况</span>
mysqldumpslow <span style="color:#f92672">-</span>s r <span style="color:#f92672">-</span>t <span style="color:#ae81ff">10</span> <span style="color:#e6db74">/var/</span>lib<span style="color:#e6db74">/mysql/xxxx</span><span style="color:#f92672">-</span>slow<span style="color:#f92672">.</span>log<span style="color:#f92672">|</span>more
<span style="color:#75715e"># 常用参数说明：</span>
	s:是按照何种方式排序
	c:访问次数
	l:锁定时间
	r:返回记录
	t:查询时间
	al:平均锁定时间
	ar:平均返回记录
	at:平均查询时间
	t:返回前面多少条的数据
	g:后面搭配一个正则匹配模式<span style="color:#960050;background-color:#1e0010">，</span>大小写不敏感
</code></pre></div><p><strong>show Profile</strong></p>
<p>作用：用来分析当前会话中语句执行的资源消耗情况，用于SQL调优的测量</p>
<p>查看是否支持：<code>show variables like 'profiling';</code></p>
<p>开启：<code>set profiling=on;</code></p>
<p>查看结果：<code>show profiles;</code></p>
<p>诊断SQL：<code>show profile cpu,block io for query 上一步的queryid;</code></p>
<p>相关type：</p>
<blockquote>
<p>ALL 		&ndash;显示所有的开销信息</p>
<p>BLOCK IO		&ndash;显示块IO相关开销</p>
<p>CONTEXT SWITCHES		&ndash;上下文切换相关开销</p>
<p>CPU		&ndash;显示CPU相关开销信息</p>
<p>IPC		&ndash;显示发送和接收相关开销信息</p>
<p>MEMORY		&ndash;显示内存相关开销信息</p>
<p>PAGE FAULTS		&ndash;显示页面错误相关开销信息</p>
<p>SOURCE		&ndash;显示和source_function,Source_file,Source_line相关的开销信息</p>
<p>SWAPS		&ndash;显示交换次数相关的开销信息</p>
</blockquote>
<p>相关结论：</p>
<blockquote>
<p>converting HEAP to MyISAM 查询结果太大，内存不够用会往磁盘上搬</p>
<p>Creating tmp table 创建临时表：拷贝数据到临时表，用完再删除</p>
<p>Copying to tmp table on disk 把内存中临时表复制到磁盘，危险！！！</p>
<p>locked</p>
</blockquote>
<p><strong>全局查询日志</strong></p>
<p>注意：不要在生成上开启此日志</p>
<p>启用方式一：</p>
<p>在配置文件中设置</p>
<blockquote>
<p>#开启</p>
<p>general_log=1</p>
<p>#记录日志文件的路径</p>
<p>general_log_file=/path/logfile</p>
<p>#输出格式</p>
<p>log_output=FILE</p>
</blockquote>
<p>启用方式二：</p>
<p>开启：<code>set global general_log=1;</code> <code>set global log_output='TABLE';</code></p>
<p>开启后，会记录到mysql库的general_log表中；可以查看<code>select * from mysql.general_log；</code></p>
<h2 id="锁机制">锁机制</h2>
<p>对数据库操作类型分为：读锁、写锁</p>
<p>​	读锁：也叫共享锁，对同一份数据，多个读操作可以同时进行而不会互相影响。</p>
<p>​	写锁：也叫排它锁，在写操作没有完成前，会阻断其他写锁和读锁。</p>
<p>对数据操作的粒度分为：表锁、行锁、页锁</p>
<p>​	表锁：偏向MyISAM存储引擎，开销小，加锁快；无死锁；锁定粒度大，发生锁冲突的概率高，并发度低。</p>
<p>​	行锁：偏向InnoDB存储引擎，开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率低，并发度高。</p>
<h3 id="表锁">表锁</h3>
<p>查看哪些表加了锁：<code>show open tables;</code></p>
<p>手动加表锁：<code>lock table 表名 read(write), 表名2 read(write),其他;</code></p>
<p>释放表锁：<code>unlock tables;</code></p>
<p><strong>分析表锁定</strong></p>
<p>​	<code>show status like 'table%';</code> 通过命令可以得到两个变量</p>
<p>​	Table_locks_immediate:产生表锁定的次数</p>
<p>​	Table_locks_waited:出现表锁争用而发生等待的次数。数值高表示争用情况严重。</p>
<p><strong>表read锁的操作</strong></p>
<table>
<thead>
<tr>
<th>当前session</th>
<th>其他session</th>
</tr>
</thead>
<tbody>
<tr>
<td>获得表A的read锁</td>
<td>连接终端</td>
</tr>
<tr>
<td>可以查询表A的记录</td>
<td>可以查询表A的记录</td>
</tr>
<tr>
<td>不能查询其他没锁定表的记录</td>
<td>可以查询或更新其他表的记录</td>
</tr>
<tr>
<td>插入或更新锁定表会提示错误</td>
<td>插入或更新锁定表会一直等待获得锁</td>
</tr>
<tr>
<td>释放锁</td>
<td>获取锁，插入成功</td>
</tr>
</tbody>
</table>
<p>表write锁的操作</p>
<table>
<thead>
<tr>
<th>当前session</th>
<th>其他session</th>
</tr>
</thead>
<tbody>
<tr>
<td>获得表A的write锁</td>
<td>连接终端</td>
</tr>
<tr>
<td>可以查询、更新、插入表A的记录</td>
<td>无法对表A进行查询，被阻塞，需要等待锁被释放</td>
</tr>
<tr>
<td>不能查询其他没锁定表的记录</td>
<td>可以查询其他没有锁定表的记录</td>
</tr>
<tr>
<td>释放锁</td>
<td>获得锁，查询成功</td>
</tr>
</tbody>
</table>
<p><strong>总结：</strong></p>
<p>MyISAM表的读锁，不会阻塞其他进程对同一表的读请求，会阻塞其他进程对同一表的写请求；只有当读锁释放后，才会执行其他进程的写操作。</p>
<p>MyISAM表的写锁，会阻塞其他进程对同一表的读和写请求，只有当写锁释放后，才会执行其他进程的读写操作。</p>
<p>MyIsam的读写锁调度是写优先，不适合做写为主表的引擎，写锁后，其他线程不能操作，造成永久阻塞。</p>
<h3 id="行锁">行锁</h3>
<p>由于InnoDB支持事务并采用了行锁；为了满足事务的ACID属性，并发事务可能会带来更新丢失、脏读、不可重复读、幻读等问题。</p>
<p><strong>行锁定操作</strong></p>
<table>
<thead>
<tr>
<th>session1</th>
<th>session2</th>
</tr>
</thead>
<tbody>
<tr>
<td>开启事务</td>
<td>开启事务</td>
</tr>
<tr>
<td>更新但不提交</td>
<td>更新被阻塞，等待中</td>
</tr>
<tr>
<td>提交更新</td>
<td>解除阻塞，正常更新</td>
</tr>
</tbody>
</table>
<p>注意：索引失效行锁变表锁；</p>
<p><strong>间隙锁</strong></p>
<p>检索条件使用的是范围检索，而不是相等条件检索数据，并请求共享锁或排它锁时，InnoDB会给符合条件的已有数据记录的索引项加锁；对于键值条件在条件范围内但并不存在的记录，叫做“间隙（GAP）”。</p>
<p><strong>锁定一行</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">#锁定一行
</span><span style="color:#75715e"># session1操作
</span><span style="color:#75715e">#begin;
</span><span style="color:#75715e">#select * from test where a=1 for update;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#session2操作
</span><span style="color:#75715e">#update test set b=&#39;xxx&#39; where a=1;
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># 在session1 没有commit之前，session的这个操作会阻塞
</span></code></pre></div><p><strong>分析行锁定</strong></p>
<p>通过<code>show status like 'innodb_row_lock%';</code> 可以分析系统上的行锁的争夺情况</p>
<p>Innodb_row_lock_current_waits：当前正在等待锁定的数量；</p>
<p><strong>Innodb_row_lock_time</strong>：从系统启动到现在锁定总时间长度；</p>
<p><strong>Innodb_row_lock_time_avg</strong>：每次等待所花平均时间；</p>
<p>Innodb_row_lock_time_max：从系统启动到现在等待最长一次所花时间；</p>
<p><strong>Innodb_row_lock_waits</strong>：系统启动后到现在总共等待的次数；</p>
<p><strong>优化建议：</strong></p>
<p>1、尽可能所有数据检索通过索引，避免无索引行锁升级为表锁</p>
<p>2、合理设计索引，尽量缩小锁的范围</p>
<p>3、尽可能减少检索条件，避免间隙锁</p>
<p>4、尽量控制事务大小，减少锁定资源量和时间长度</p>
<p>5、尽可能低级别事务隔离</p>
<h2 id="主从复制">主从复制</h2>
<p>复制的基本原理：</p>
<p>slave从master读取binlog进行数据同步。</p>
<p>​	1、master将改变记录到二进制日志（binary log）。这些过程叫做二进制日志时间，binary log events;</p>
<p>​	2、slave将master的binary log events拷贝到他的中继日志（relay log）</p>
<p>​	3、slave重做中继日志中的事件，将改变应用的到自己的数据库中，mysql复制是异步的且串行化的</p>
<p>复制的基本原则：</p>
<p>​	1、每个slave只有一个master</p>
<p>​	2、每个slave只能有一个唯一的服务器ID</p>
<p>​	3、每个master可以有多个slave</p>
<p>存在问题：延时</p>
<p>一主一从常见配置：</p>
<p>​	1、mysql版本一致且后台以服务运行</p>
<p>​	2、主从都配置在[mysqld]结点下，都是小写</p>
<p>​	3、主机修改配置文件：</p>
<p>​		3.1[必须] 主服务器唯一ID：server-id=1;</p>
<p>​		3.2 [必须] 启用二进制日志：<code>log-bin=mysql安装路径/data/mysqlbin</code></p>
<p>​		3.3 [可选] 启用错误日志：<code>log-err=mysql安装路径/data/mysqlerr</code></p>
<p>​		3.4 [可选] 根目录：<code>basedir='mysql安装路径'</code></p>
<p>​		3.5 [可选] 临时目录： <code>tempdir=&quot;mysql安装路径&quot;</code></p>
<p>​		3.6 [可选] 数据目录： <code>datadir=&quot;mysql安装路径/Data&quot;</code></p>
<p>​		3.7 read-only=0：主机，读写都可以</p>
<p>​		3.8 [可选] 设置不要复制的数据库：<code>binlog-ignore-db=不需要复制的数据库名字</code></p>
<p>​		3.9 [可选] 设置需要复制的数据库：<code>binlog-do-db=需要复制的主数据库名字</code></p>
<p>​	4、从机修改配置文件</p>
<p>​		4.1 [必须] 从服务器唯一ID</p>
<p>​		4.2 [可选] 启用二进制日志</p>
<p>​	5、修改过配置文件，主从机都需要重启mysql服务</p>
<p>​	6、主从机都关闭防火墙</p>
<p>​	7、在主机上建立账号并授权slave</p>
<p>​		7.1 授权<code>GRANT REPLICATION SLAVE ON *.* TO 'zhangsan'@'从机器数据库IP' IDENTIFIED BY '123456';</code> 刷新权限<code>flush privileges;</code></p>
<p>​		7.2 查询master的状态;<code>show master status;</code> 记录下File和Position的值。在8.1的时候要用到</p>
<p>​		7.3 为防止主服务器状态值变化，不再操作主服务器MYSQL。</p>
<p>​	8、在从机上配置需要复制的主机</p>
<p>​		8.1  设置<code>CHANGE MASTER TO MASTER_HOST='主机IP',MASTER_USER='zhangsan',MASTER_PASSWORD='123456',MASTER_LOG_FILE='FILE名字',MASTER_LOG_POS=Position数字;</code></p>
<p>​		8.2 启动从服务器复制功能：<code>start slave;</code></p>
<p>​		8.3 查看状态：<code>show slave status\G</code>；如果Slave_IO_Running:yes 和 Slave_SQL_Running:yes 则表示主从配置成功。</p>
<p>​	9、停止从服务复制功能：<code>stop slave;</code></p>
<h2 id="参考文献">参考文献</h2>
<blockquote>
<p><a href="https://www.bilibili.com/video/BV12b411K7Zu">https://www.bilibili.com/video/BV12b411K7Zu</a></p>
</blockquote>

        </div>

        


        

<div class="post-archive">
    <h2>相关文章</h2>
    <ul class="listing">
        
        <li><a href="/post/GolangGMP/">Golang GMP学习笔记</a></li>
        
        <li><a href="/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/">计算机网络基础学习笔记</a></li>
        
        <li><a href="/post/GolangGC/">Golang 中GC回收机制学习笔记</a></li>
        
        <li><a href="/post/%E5%88%A9%E7%94%A8webhook%E5%B0%86github%E4%B8%8A%E7%9A%84%E5%8D%9A%E5%AE%A2%E5%90%8C%E6%AD%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%B0%E5%BD%95/">利用webhook将github上的博客同步到阿里云服务器记录</a></li>
        
        <li><a href="/about/">About</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/DB' target="_blank">DB</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    
    

</div>

                    <footer id="footer">
    <div class="container">
        &copy; 2023 <a href="https://kevinbin123.github.io/">abin の 成长之路 By abin</a>.本站博客未经授权禁止转载.
		<br>
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="http://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>
		       
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
<style type="text/css">
div.highlight {
    position: relative;
    margin: 1em 0px;
}

.copy-code {
    display: none;
    position: absolute;
    top: 4px;
    right: 4px;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(78, 78, 78, 0.8);
    border-radius: var(--radius);
    padding: 0 5px;
    font: inherit;
    user-select: none;
    cursor: pointer;
    border: 0;
    --radius: 8px;
}

div.highlight:hover .copy-code,pre:hover .copy-code {
    display: block;
}

</style>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/bootstrap.min.js'></script>

    <script src='/js/post_category.1.js'></script>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://kevinbin123.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://kevinbin123.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>

    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://kevinbin123.github.io/post/%E7%AE%80%E5%8D%95%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/" title="简单分布式系统" target="_blank">简单分布式系统</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/fyne%E6%A1%88%E4%BE%8B%E4%B9%8B%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/" title="Fyne案例之音乐播放器" target="_blank">Fyne案例之音乐播放器</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/fyne%E6%A1%88%E4%BE%8B%E4%B9%8B%E6%8E%A5%E4%BD%8F%E4%BD%A0%E5%B0%8F%E6%B8%B8%E6%88%8F/" title="Fyne案例之接住你小游戏" target="_blank">Fyne案例之接住你小游戏</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/gin&#43;vue2%E5%8D%9A%E5%AE%A2%E7%AC%94%E8%AE%B0%E5%89%8D%E7%AB%AF/" title="Gin&#43;vue2博客笔记（前端）" target="_blank">Gin&#43;vue2博客笔记（前端）</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/gin&#43;vue2%E5%8D%9A%E5%AE%A2%E7%AC%94%E8%AE%B0%E5%90%8E%E7%AB%AF/" title="Gin&#43;vue2博客笔记（后端）" target="_blank">Gin&#43;vue2博客笔记（后端）</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/PWA%E7%AC%94%E8%AE%B0/" title="PWA笔记" target="_blank">PWA笔记</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/Golang%E6%A1%88%E4%BE%8B-zinx%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Golang案例 Zinx轻量级服务器框架学习笔记" target="_blank">Golang案例 Zinx轻量级服务器框架学习笔记</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/Golang%E5%B0%8F%E6%A1%88%E4%BE%8B-%E7%88%AC%E5%8F%96%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1/" title="Golang小案例 爬取豆瓣电影" target="_blank">Golang小案例 爬取豆瓣电影</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/go-micro%E6%A1%88%E4%BE%8B/" title="Go Micro案例" target="_blank">Go Micro案例</a>
    </li>
    
    <li>
        <a href="https://kevinbin123.github.io/post/go-micro%E7%AC%94%E8%AE%B0/" title="Go Micro笔记" target="_blank">Go Micro笔记</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://kevinbin123.github.io/categories/DB/">DB (2)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/Golang/">Golang (19)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/JavaScript/">JavaScript (1)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/Network/">Network (1)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/container/">container (1)</a></li>
    
    <li><a href="https://kevinbin123.github.io/categories/other/">other (5)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://kevinbin123.github.io/tags/DB/">DB</a>
    
    <a href="https://kevinbin123.github.io/tags/Golang/">Golang</a>
    
    <a href="https://kevinbin123.github.io/tags/JavaScript/">JavaScript</a>
    
    <a href="https://kevinbin123.github.io/tags/Network/">Network</a>
    
    <a href="https://kevinbin123.github.io/tags/container/">container</a>
    
    <a href="https://kevinbin123.github.io/tags/other/">other</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.liwenzhou.com/" title="go语言学习之路">李文周的博客</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://kevinbin123.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>